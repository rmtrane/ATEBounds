<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Bounds using Multiple IVs in Bivariate Data • ACEBounds</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Bounds using Multiple IVs in Bivariate Data">
<meta property="og:description" content="Obtaining bounds on the ATE using bivariate data with multiple IVs.">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">ACEBounds</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/ACEBounds.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li class="divider">
    <li class="dropdown-header">Exploration of Bounds</li>
    <li>
      <a href="../articles/bounds_from_bivariate.html">Bounds using Bivariate Data</a>
    </li>
    <li>
      <a href="../articles/bounds_from_bivariate_multiple_IVs.html">Bounds using Multiple IVs in Bivariate Data</a>
    </li>
    <li>
      <a href="../articles/bounds_from_trivariate.html">Utilize bivariate data in trivariate bounds</a>
    </li>
    <li class="divider">
    <li class="dropdown-header">How-To's</li>
    <li>
      <a href="../articles/polymake_example.html">Polymake Example</a>
    </li>
    <li>
      <a href="../articles/get_bounds.html">How to use the `get_bounds` function</a>
    </li>
    <li>
      <a href="../articles/example_analysis.html">Example Analysis of Data from the IEU GWAS Database</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/rmtrane/ACEBounds/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="bounds_from_bivariate_multiple_IVs_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Bounds using Multiple IVs in Bivariate Data</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/rmtrane/ACEBounds/blob/master/vignettes/bounds_from_bivariate_multiple_IVs.Rmd"><code>vignettes/bounds_from_bivariate_multiple_IVs.Rmd</code></a></small>
      <div class="hidden name"><code>bounds_from_bivariate_multiple_IVs.Rmd</code></div>

    </div>

    
    
<div id="introduction" class="section level2">
<h2 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h2>
<p>The purpose of this document is to illustrate the impact of utilizing multiple IVs to construct bounds on <span class="math inline">\(\alpha\)</span>. When a data set with all variables is not available, but we have to rely on multiple data sets to get observations of <span class="math inline">\((X,Z)\)</span> and <span class="math inline">\((Y,Z)\)</span>, obtained bounds tend to be significantly less informative. It can be shown that if the effect of the IV is monotone on both <span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span>, the strength of the IV on <span class="math inline">\(X\)</span> (here defined as <span class="math inline">\(P(X = 1 | Z = k) - P(X = 1 | Z = 0)\)</span>) has to be at least <span class="math inline">\(0.5\)</span> for the width of the bounds to be guaranteed to be less than <span class="math inline">\(1\)</span>, something which is always the case when obtaining bounds through trivariate data.</p>
<p>A natural question to ask is if we can make up for this lack of information by utilizing multiple IVs.</p>
</div>
<div id="the-model" class="section level2">
<h2 class="hasAnchor">
<a href="#the-model" class="anchor"></a>The model</h2>
<p>We will investigate this through the following model, which is often used in mendelian randomization (MR) analyses:</p>
<p><span class="math display">\[\begin{aligned}
\text{logit}(P(X = 1 | Z_1 = z_1, ..., Z_n = z_n)) &amp;= \beta_0 + \sum_i \beta_i z_i \\
\text{logit}(P(Y = 1 | X = x)) &amp;= \gamma_0 + \gamma_1 x
\end{aligned}\]</span></p>
<p>Here, <span class="math inline">\(Y \in \{0,1\}, X \in \{0,1\}\)</span>, and <span class="math inline">\(Z_i \in \{0, 1, 2\}\)</span>. The function <code><a href="../reference/marginals_from_logit.html">marginals_from_logit()</a></code> calculates the value of <span class="math inline">\(P(X = 1 | Z_j = z)\)</span> for all <span class="math inline">\(j\)</span>, <span class="math inline">\(z\)</span>. For more info, see <code><a href="../reference/marginals_from_logit.html">?marginals_from_logit</a></code>.</p>
</div>
<div id="constant-beta_i-beta" class="section level2">
<h2 class="hasAnchor">
<a href="#constant-beta_i-beta" class="anchor"></a>Constant <span class="math inline">\(\beta_i = \beta\)</span>
</h2>
<p>First, we will consider the example where <span class="math inline">\(\beta_1 = \beta_2 = ... = \beta_n = \beta\)</span>. We will consider scenarios for every combination of <span class="math inline">\(\beta_0 = -2, \beta \in \{0.1, 0.3, 1, 3\}, \gamma_0 = -1, \gamma_1 = 1, n = \{3, 10, 20, 30, 40, 50\}\)</span>.</p>
<div id="calculate-bounds-in-different-settings" class="section level3">
<h3 class="hasAnchor">
<a href="#calculate-bounds-in-different-settings" class="anchor"></a>Calculate bounds in different settings</h3>
<p>First, create tibble with row for each combination, and add columns for <span class="math inline">\(P(Y = 1 | X = 0)\)</span> and <span class="math inline">\(P(Y = 1 | X = 1)\)</span>.</p>
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">ACEBounds</span>, <span class="kw">quietly</span> <span class="kw">=</span> <span class="fl">TRUE</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">tidyverse</span>, <span class="kw">quietly</span> <span class="kw">=</span> <span class="fl">TRUE</span>)</pre></body></html></div>
<pre><code>## ── Attaching packages ────────────────────────────────────────────────── tidyverse 1.3.0 ──</code></pre>
<pre><code>## ✓ ggplot2 3.3.2     ✓ purrr   0.3.4
## ✓ tibble  3.0.3     ✓ dplyr   1.0.1
## ✓ tidyr   1.1.1     ✓ stringr 1.4.0
## ✓ readr   1.3.1     ✓ forcats 0.5.0</code></pre>
<pre><code>## ── Conflicts ───────────────────────────────────────────────────── tidyverse_conflicts() ──
## x dplyr::filter() masks stats::filter()
## x dplyr::lag()    masks stats::lag()</code></pre>
<div class="sourceCode" id="cb5"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span>(<span class="fl">14141414</span>)

<span class="no">many_IVs</span> <span class="kw">&lt;-</span> <span class="fu">expand_grid</span>(<span class="kw">beta</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0.1</span>, <span class="fl">0.3</span>, <span class="fl">1</span>, <span class="fl">3</span>),
                        <span class="kw">n</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">3</span>, <span class="fl">10</span>, <span class="fl">50</span>),
                        <span class="kw">gamma0</span> <span class="kw">=</span> -<span class="fl">2</span>,
                        <span class="kw">gamma1</span> <span class="kw">=</span> <span class="fl">0.2</span>) <span class="kw">%&gt;%</span>
  <span class="fu">rowwise</span>() <span class="kw">%&gt;%</span>
  <span class="fu">mutate</span>(<span class="kw">`P(X = 1 | Z)`</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="fu"><a href="../reference/marginals_from_logit.html">marginals_from_logit</a></span>(<span class="kw">b0</span> <span class="kw">=</span> <span class="fl">1</span>/<span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span>(<span class="no">n</span>),
                                                    <span class="kw">b</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="no">beta</span>, <span class="no">n</span>),
                                                    <span class="kw">p.z</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0.25</span>, <span class="fl">0.5</span>, <span class="fl">0.25</span>)), <span class="no">n</span>)))) <span class="kw">%&gt;%</span>
  <span class="fu">ungroup</span>() <span class="kw">%&gt;%</span>
  <span class="fu">mutate</span>(<span class="kw">`P(Y = 1 | X = 0)`</span> <span class="kw">=</span> <span class="fl">1</span>/(<span class="fl">1</span>+<span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span>(-<span class="no">gamma0</span>)),
         <span class="kw">`P(Y = 1 | X = 1)`</span> <span class="kw">=</span> <span class="fl">1</span>/(<span class="fl">1</span>+<span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span>(-<span class="no">gamma0</span> - <span class="no">gamma1</span>)),
         <span class="kw">ACE</span> <span class="kw">=</span> <span class="no">`P(Y = 1 | X = 1)`</span> - <span class="no">`P(Y = 1 | X = 0)`</span>)</pre></body></html></div>
<p>Next, we add columns for <span class="math inline">\(P(Y = 1 | Z = z), z = 0,1,2\)</span>, and calculate bounds both without any monotonicity assumptions, and where we assume the effect of <span class="math inline">\(Z\)</span> on <span class="math inline">\(X\)</span> is monotonically increasing.</p>
<div class="sourceCode" id="cb6"><html><body><pre class="r"><span class="no">with_bounds</span> <span class="kw">&lt;-</span> <span class="no">many_IVs</span> <span class="kw">%&gt;%</span>
  <span class="fu">unnest</span>(<span class="no">`P(X = 1 | Z)`</span>) <span class="kw">%&gt;%</span>
  <span class="fu">mutate</span>(<span class="kw">`P(Y = 1 | Z_j = 0)`</span> <span class="kw">=</span> <span class="no">`P(Y = 1 | X = 1)`</span>*<span class="no">`P(X = 1 | Z_j = 0)`</span> +
           <span class="no">`P(Y = 1 | X = 0)`</span>*(<span class="fl">1</span>-<span class="no">`P(X = 1 | Z_j = 0)`</span>),
         <span class="kw">`P(Y = 1 | Z_j = 1)`</span> <span class="kw">=</span> <span class="no">`P(Y = 1 | X = 1)`</span>*<span class="no">`P(X = 1 | Z_j = 1)`</span> +
           <span class="no">`P(Y = 1 | X = 0)`</span>*(<span class="fl">1</span>-<span class="no">`P(X = 1 | Z_j = 1)`</span>),
         <span class="kw">`P(Y = 1 | Z_j = 2)`</span> <span class="kw">=</span> <span class="no">`P(Y = 1 | X = 1)`</span>*<span class="no">`P(X = 1 | Z_j = 2)`</span> +
           <span class="no">`P(Y = 1 | X = 0)`</span>*(<span class="fl">1</span>-<span class="no">`P(X = 1 | Z_j = 2)`</span>)) <span class="kw">%&gt;%</span>
  <span class="fu">rowwise</span>() <span class="kw">%&gt;%</span>
  <span class="fu">mutate</span>(<span class="kw">gammas</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="no">`P(Y = 1 | Z_j = 0)`</span>, <span class="no">`P(Y = 1 | Z_j = 1)`</span>, <span class="no">`P(Y = 1 | Z_j = 2)`</span>)),
         <span class="kw">thetas</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="no">`P(X = 1 | Z_j = 0)`</span>, <span class="no">`P(X = 1 | Z_j = 1)`</span>, <span class="no">`P(X = 1 | Z_j = 2)`</span>)),
         <span class="kw">bounds</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="fu"><a href="../reference/get_bounds.html">get_bounds</a></span>(<span class="kw">gammas</span> <span class="kw">=</span> <span class="no">gammas</span>,
                                  <span class="kw">thetas</span> <span class="kw">=</span> <span class="no">thetas</span>,
                                  <span class="kw">warning</span> <span class="kw">=</span> <span class="fl">FALSE</span>,
                                  <span class="kw">stop</span> <span class="kw">=</span> <span class="fl">FALSE</span>)),
         <span class="kw">mono_bounds</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="fu"><a href="../reference/get_bounds.html">get_bounds</a></span>(<span class="kw">gammas</span> <span class="kw">=</span> <span class="no">gammas</span>,
                                       <span class="kw">thetas</span> <span class="kw">=</span> <span class="no">thetas</span>,
                                       <span class="kw">stop</span> <span class="kw">=</span> <span class="fl">FALSE</span>,
                                       <span class="kw">warning</span> <span class="kw">=</span> <span class="fl">FALSE</span>,
                                       <span class="kw">x_mono</span> <span class="kw">=</span> <span class="fl">TRUE</span>)))

<span class="no">with_bounds</span> <span class="kw">%&gt;%</span>
  <span class="fu">mutate</span>(<span class="kw">constraints</span> <span class="kw">=</span> <span class="no">bounds</span>$<span class="no">constraints_violated</span>,
         <span class="kw">mono_constraints</span> <span class="kw">=</span> <span class="no">mono_bounds</span>$<span class="no">constraints_violated</span>) <span class="kw">%&gt;%</span>
  <span class="fu">group_by</span>(<span class="no">n</span>, <span class="no">beta</span>) <span class="kw">%&gt;%</span>
  <span class="fu">summarize</span>(<span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>(<span class="no">constraints</span>))</pre></body></html></div>
<pre><code>## `summarise()` regrouping output by 'n' (override with `.groups` argument)</code></pre>
<pre><code>## # A tibble: 12 x 3
## # Groups:   n [3]
##        n  beta `sum(constraints)`
##    &lt;dbl&gt; &lt;dbl&gt;              &lt;int&gt;
##  1     3   0.1                  0
##  2     3   0.3                  0
##  3     3   1                    0
##  4     3   3                    0
##  5    10   0.1                  0
##  6    10   0.3                  0
##  7    10   1                    0
##  8    10   3                    0
##  9    50   0.1                  0
## 10    50   0.3                  0
## 11    50   1                    0
## 12    50   3                    0</code></pre>
</div>
<div id="plots" class="section level3">
<h3 class="hasAnchor">
<a href="#plots" class="anchor"></a>Plots</h3>
<p>When all coefficients are identical, probabilities <span class="math inline">\(P(X = 1 | Z_j = z)\)</span> are identical for all IVs. Therefore, we collapse the tibble to only have one row per set of parameters. For each set of parameters, we have lower and upper bounds (both with and without the monotonicity assumption), and we also calculate the strength of <span class="math inline">\(Z\)</span> on <span class="math inline">\(X\)</span>, i.e. <span class="math inline">\(P(X = 1 | Z_j = 2) - P(X = 1 | Z_j = 0)\)</span>.</p>
<div class="sourceCode" id="cb9"><html><body><pre class="r"><span class="no">for_plots</span> <span class="kw">&lt;-</span> <span class="no">with_bounds</span> <span class="kw">%&gt;%</span>
  <span class="fu">mutate</span>(<span class="kw">interval</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="no">bounds</span>$<span class="no">interval</span>),
         <span class="kw">constraints_violated</span> <span class="kw">=</span> <span class="no">bounds</span>$<span class="no">constraints_violated</span>,
         <span class="kw">mono_interval</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="no">mono_bounds</span>$<span class="no">interval</span>),
         <span class="kw">mono_constraints_violated</span> <span class="kw">=</span> <span class="no">mono_bounds</span>$<span class="no">constraints_violated</span>) <span class="kw">%&gt;%</span>
  <span class="fu">ungroup</span>() <span class="kw">%&gt;%</span>
  <span class="fu">mutate</span>(<span class="kw">strength</span> <span class="kw">=</span> <span class="no">`P(X = 1 | Z_j = 2)`</span> - <span class="no">`P(X = 1 | Z_j = 0)`</span>) <span class="kw">%&gt;%</span>
  <span class="fu">select</span>(-<span class="fu">contains</span>(<span class="st">"P("</span>)) <span class="kw">%&gt;%</span>
  <span class="fu">unnest_wider</span>(<span class="no">mono_interval</span>) <span class="kw">%&gt;%</span>
  <span class="fu">rename</span>(<span class="kw">mono_upper</span> <span class="kw">=</span> <span class="no">upper</span>,
         <span class="kw">mono_lower</span> <span class="kw">=</span> <span class="no">lower</span>) <span class="kw">%&gt;%</span>
  <span class="fu">unnest_wider</span>(<span class="no">interval</span>) <span class="kw">%&gt;%</span>
  <span class="fu">group_by</span>(<span class="no">beta</span>, <span class="no">n</span>, <span class="no">ACE</span>) <span class="kw">%&gt;%</span>
  <span class="fu">summarize</span>(<span class="kw">lower</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span>(<span class="no">lower</span>),
            <span class="kw">upper</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span>(<span class="no">upper</span>),
            <span class="kw">mono_lower</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span>(<span class="no">mono_lower</span>),
            <span class="kw">mono_upper</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span>(<span class="no">mono_upper</span>),
            <span class="kw">strength</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span>(<span class="no">strength</span>))</pre></body></html></div>
<pre><code>## `summarise()` regrouping output by 'beta', 'n' (override with `.groups` argument)</code></pre>
<div class="sourceCode" id="cb11"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span>(<span class="no">for_plots</span>, <span class="kw">n</span> <span class="kw">=</span> <span class="fl">24</span>)</pre></body></html></div>
<pre><code>## # A tibble: 12 x 8
## # Groups:   beta, n [12]
##     beta     n    ACE  lower upper mono_lower mono_upper    strength
##    &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;      &lt;dbl&gt;      &lt;dbl&gt;       &lt;dbl&gt;
##  1   0.1     3 0.0226 -0.819 0.410     -0.818      0.410 0.0414     
##  2   0.1    10 0.0226 -0.906 0.335     -0.905      0.335 0.0333     
##  3   0.1    50 0.0226 -0.864 0.148     -0.864      0.148 0.00130    
##  4   0.3     3 0.0226 -0.897 0.287     -0.895      0.287 0.0912     
##  5   0.3    10 0.0226 -0.890 0.173     -0.890      0.173 0.0238     
##  6   0.3    50 0.0226 -0.858 0.142     -0.858      0.142 0.000000485
##  7   1       3 0.0226 -0.875 0.158     -0.873      0.158 0.0831     
##  8   1      10 0.0226 -0.858 0.142     -0.858      0.142 0.000659   
##  9   1      50 0.0226 -0.858 0.142     -0.858      0.142 0          
## 10   3       3 0.0226 -0.858 0.142     -0.858      0.142 0.0297     
## 11   3      10 0.0226 -0.858 0.142     -0.858      0.142 0.00000539 
## 12   3      50 0.0226 -0.858 0.142     -0.858      0.142 0</code></pre>
<p>The following figure shows the bounds for each setting.</p>
<div class="sourceCode" id="cb13"><html><body><pre class="r"><span class="no">bounds_vs_nIVs</span> <span class="kw">&lt;-</span> <span class="no">for_plots</span> <span class="kw">%&gt;%</span>
  <span class="fu">select</span>(<span class="no">n</span>, <span class="fu">contains</span>(<span class="st">"lower"</span>), <span class="fu">contains</span>(<span class="st">"upper"</span>), <span class="no">beta</span>, <span class="no">strength</span>, <span class="no">ACE</span>) <span class="kw">%&gt;%</span>
  <span class="fu">pivot_longer</span>(<span class="kw">cols</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fu">contains</span>(<span class="st">"lower"</span>), <span class="fu">contains</span>(<span class="st">"upper"</span>))) <span class="kw">%&gt;%</span>
  <span class="fu">separate</span>(<span class="no">name</span>, <span class="kw">into</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"assumption"</span>, <span class="st">"bound"</span>), <span class="kw">sep</span> <span class="kw">=</span> <span class="st">"_"</span>, <span class="kw">fill</span> <span class="kw">=</span> <span class="st">"left"</span>) <span class="kw">%&gt;%</span>
  <span class="fu">mutate</span>(<span class="kw">assumption</span> <span class="kw">=</span> <span class="fu">if_else</span>(<span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span>(<span class="no">assumption</span>), <span class="st">"none"</span>, <span class="no">assumption</span>)) <span class="kw">%&gt;%</span>
  <span class="fu">pivot_wider</span>(<span class="kw">names_from</span> <span class="kw">=</span> <span class="no">bound</span>, <span class="kw">values_from</span> <span class="kw">=</span> <span class="no">value</span>) <span class="kw">%&gt;%</span>
  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">n</span>)) +
    <span class="fu">geom_hline</span>(<span class="fu">aes</span>(<span class="kw">yintercept</span> <span class="kw">=</span> <span class="no">ACE</span>, <span class="kw">color</span> <span class="kw">=</span> <span class="st">"ATE"</span>)) +
    <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="kw">ymin</span> <span class="kw">=</span> <span class="no">lower</span>, <span class="kw">ymax</span> <span class="kw">=</span> <span class="no">upper</span>)) +
    <span class="fu">facet_grid</span>(<span class="no">assumption</span> ~ <span class="no">beta</span>) +
    <span class="fu">labs</span>(<span class="kw">title</span> <span class="kw">=</span> <span class="st">"Bounds vs. number of IVs"</span>,
         <span class="kw">subtitle</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span>(<span class="st">"All coefficients equal, and "</span>, <span class="no">beta</span>[<span class="fl">0</span>], <span class="st">"= 1/"</span>, <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span>(<span class="no">n</span>))))

<span class="no">bounds_vs_nIVs</span></pre></body></html></div>
<p><img src="bounds_from_bivariate_multiple_IVs_files/figure-html/unnamed-chunk-4-1.png" width="700"></p>
<p>Next, we show the same intervals, but plotted against strength rather than number of IVs.</p>
<div class="sourceCode" id="cb14"><html><body><pre class="r"><span class="no">bounds_vs_strength</span> <span class="kw">&lt;-</span> <span class="no">for_plots</span> <span class="kw">%&gt;%</span>
  <span class="fu">select</span>(<span class="no">n</span>, <span class="fu">contains</span>(<span class="st">"lower"</span>), <span class="fu">contains</span>(<span class="st">"upper"</span>), <span class="no">beta</span>, <span class="no">strength</span>, <span class="no">ACE</span>) <span class="kw">%&gt;%</span>
  <span class="fu">pivot_longer</span>(<span class="kw">cols</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fu">contains</span>(<span class="st">"lower"</span>), <span class="fu">contains</span>(<span class="st">"upper"</span>))) <span class="kw">%&gt;%</span>
  <span class="fu">separate</span>(<span class="no">name</span>, <span class="kw">into</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"assumption"</span>, <span class="st">"bound"</span>), <span class="kw">sep</span> <span class="kw">=</span> <span class="st">"_"</span>, <span class="kw">fill</span> <span class="kw">=</span> <span class="st">"left"</span>) <span class="kw">%&gt;%</span>
  <span class="fu">mutate</span>(<span class="kw">assumption</span> <span class="kw">=</span> <span class="fu">if_else</span>(<span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span>(<span class="no">assumption</span>), <span class="st">""</span>, <span class="no">assumption</span>),
         <span class="kw">n</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span>(<span class="no">n</span>)) <span class="kw">%&gt;%</span>
  <span class="fu">pivot_wider</span>(<span class="kw">names_from</span> <span class="kw">=</span> <span class="no">bound</span>, <span class="kw">values_from</span> <span class="kw">=</span> <span class="no">value</span>) <span class="kw">%&gt;%</span>
  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">strength</span>)) +
    <span class="fu">geom_hline</span>(<span class="fu">aes</span>(<span class="kw">yintercept</span> <span class="kw">=</span> <span class="no">ACE</span>, <span class="kw">color</span> <span class="kw">=</span> <span class="st">"ATE"</span>)) +
    <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="kw">ymin</span> <span class="kw">=</span> <span class="no">lower</span>, <span class="kw">ymax</span> <span class="kw">=</span> <span class="no">upper</span>, <span class="kw">color</span> <span class="kw">=</span> <span class="no">n</span>)) +
    <span class="fu">facet_grid</span>(<span class="no">assumption</span> ~ <span class="no">beta</span>,
               <span class="kw">scales</span> <span class="kw">=</span> <span class="st">"free"</span>) +
    <span class="fu">labs</span>(<span class="kw">title</span> <span class="kw">=</span> <span class="st">"Bounds vs. strength"</span>,
         <span class="kw">subtitle</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span>(<span class="st">"All coefficients equal, and "</span>, <span class="no">beta</span>[<span class="fl">0</span>], <span class="st">"= 1/"</span>, <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span>(<span class="no">n</span>))))

<span class="no">bounds_vs_strength</span></pre></body></html></div>
<p><img src="bounds_from_bivariate_multiple_IVs_files/figure-html/unnamed-chunk-5-1.png" width="700"></p>
<p>For the paper, we exclude the row where monotonicity is assumed.</p>
<div class="sourceCode" id="cb15"><html><body><pre class="r"><span class="no">bounds_vs_strength_paper</span> <span class="kw">&lt;-</span> <span class="no">for_plots</span> <span class="kw">%&gt;%</span>
  <span class="fu">select</span>(<span class="no">n</span>, <span class="no">lower</span>, <span class="no">upper</span>, <span class="no">beta</span>, <span class="no">strength</span>, <span class="no">ACE</span>) <span class="kw">%&gt;%</span>
  <span class="fu">mutate</span>(<span class="kw">n</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span>(<span class="st">"n ="</span>, <span class="no">n</span>)) <span class="kw">%&gt;%</span>
  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">strength</span>)) +
    <span class="fu">geom_hline</span>(<span class="fu">aes</span>(<span class="kw">yintercept</span> <span class="kw">=</span> <span class="no">ACE</span>, <span class="kw">color</span> <span class="kw">=</span> <span class="st">"ATE"</span>)) +
    <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="kw">ymin</span> <span class="kw">=</span> <span class="no">lower</span>, <span class="kw">ymax</span> <span class="kw">=</span> <span class="no">upper</span>, <span class="kw">color</span> <span class="kw">=</span> <span class="no">n</span>)) +
    <span class="fu">scale_x_continuous</span>(<span class="kw">limits</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0</span>, <span class="fl">0.1</span>)) +
    <span class="fu">scale_y_continuous</span>(<span class="kw">limits</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(-<span class="fl">1</span>,<span class="fl">1</span>)) +
    <span class="fu">scale_color_manual</span>(<span class="st">""</span>, <span class="kw">values</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"red"</span>, <span class="kw pkg">ggthemes</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/ggthemes/man/colorblind.html">colorblind_pal</a></span>()(<span class="fl">4</span>)[-<span class="fl">1</span>]),
                       <span class="kw">breaks</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"ATE"</span>, <span class="st">"n = 3"</span>, <span class="st">"n = 10"</span>, <span class="st">"n = 50"</span>)) +
    <span class="fu">facet_grid</span>(<span class="no">.</span> ~ <span class="no">beta</span>,
               <span class="kw">scales</span> <span class="kw">=</span> <span class="st">"free"</span>,
               <span class="kw">labeller</span> <span class="kw">=</span> <span class="fu">label_bquote</span>(<span class="kw">cols</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span>(<span class="no">beta</span>[<span class="no">j</span>], <span class="st">" = "</span>, <span class="fu">.</span>(<span class="no">beta</span>)))) +
    <span class="fu">labs</span>(<span class="kw">title</span> <span class="kw">=</span> <span class="st">"Bounds vs. strength"</span>,
         <span class="kw">subtitle</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span>(<span class="st">"All coefficients equal, and "</span>, <span class="no">beta</span>[<span class="fl">0</span>], <span class="st">"= 1/"</span>, <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span>(<span class="no">n</span>)))) +
    <span class="fu">theme_bw</span>() +
    <span class="fu">theme</span>(<span class="kw">axis.text.x</span> <span class="kw">=</span> <span class="fu">element_text</span>(<span class="kw">angle</span> <span class="kw">=</span> <span class="fl">45</span>, <span class="kw">hjust</span> <span class="kw">=</span> <span class="fl">1</span>),
          <span class="kw">legend.position</span> <span class="kw">=</span> <span class="st">"bottom"</span>)

<span class="no">bounds_vs_strength_paper</span></pre></body></html></div>
<p><img src="bounds_from_bivariate_multiple_IVs_files/figure-html/unnamed-chunk-6-1.png" width="700"></p>
<p>Relationship between number of IVs and the strength of the IVs.</p>
<div class="sourceCode" id="cb16"><html><body><pre class="r"><span class="no">strength_vs_nIVs</span> <span class="kw">&lt;-</span> <span class="fu">ggplot</span>(<span class="no">for_plots</span>,
       <span class="fu">aes</span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">n</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="no">strength</span>)) +
  <span class="fu">geom_point</span>() +
  <span class="fu">facet_grid</span>(~<span class="no">beta</span>, <span class="kw">scales</span> <span class="kw">=</span> <span class="st">"free"</span>) +
  <span class="fu">labs</span>(<span class="kw">title</span> <span class="kw">=</span> <span class="st">"Number of IVs vs. strength"</span>,
       <span class="kw">subtitle</span> <span class="kw">=</span> <span class="st">"All coefficients equal"</span>)

<span class="no">strength_vs_nIVs</span></pre></body></html></div>
<p><img src="bounds_from_bivariate_multiple_IVs_files/figure-html/unnamed-chunk-7-1.png" width="700"></p>
</div>
</div>
<div id="random-coefficients" class="section level2">
<h2 class="hasAnchor">
<a href="#random-coefficients" class="anchor"></a>Random Coefficients</h2>
<p>Since all intervals are the same for all IVs when all <span class="math inline">\(\beta_i\)</span>’s are equal, little information is gained by having multiple IVs in this case. Let us see what happen when the IVs have varying coefficients. Here, we let <span class="math inline">\(\beta_i \sim \text{Uniform}(0,3)\)</span>.</p>
</div>
<div id="calculate-bounds-in-different-settings-1" class="section level2">
<h2 class="hasAnchor">
<a href="#calculate-bounds-in-different-settings-1" class="anchor"></a>Calculate bounds in different settings</h2>
<p>The following is the same as previously, except coefficients are now drawn from a uniform distribution, and the intercept is <span class="math inline">\(1/\sqrt{n}\)</span>, where <span class="math inline">\(n\)</span> is the number of IVs included.</p>
<div class="sourceCode" id="cb17"><html><body><pre class="r"><span class="no">varying_betas</span> <span class="kw">&lt;-</span> <span class="fu">expand_grid</span>(<span class="kw">n</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">3</span>, <span class="fl">10</span>, <span class="fl">50</span>),
                             <span class="kw">gamma0</span> <span class="kw">=</span> -<span class="fl">2</span>,
                             <span class="kw">gamma1</span> <span class="kw">=</span> <span class="fl">0.2</span>) <span class="kw">%&gt;%</span>
  <span class="fu">rowwise</span>() <span class="kw">%&gt;%</span>
  <span class="fu">mutate</span>(<span class="kw">betas</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span>(<span class="kw">n</span> <span class="kw">=</span> <span class="no">n</span>, <span class="kw">min</span> <span class="kw">=</span> <span class="fl">0</span>, <span class="kw">max</span> <span class="kw">=</span> <span class="fl">1</span>/<span class="no">n</span>)),
         <span class="kw">`P(X = 1 | Z)`</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="fu"><a href="../reference/marginals_from_logit.html">marginals_from_logit</a></span>(<span class="kw">b0</span> <span class="kw">=</span> <span class="fl">1</span>/<span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span>(<span class="no">n</span>), <span class="kw">b</span> <span class="kw">=</span> <span class="no">betas</span>,
                                                    <span class="kw">p.z</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0.25</span>, <span class="fl">0.50</span>, <span class="fl">0.25</span>)), <span class="no">n</span>)))) <span class="kw">%&gt;%</span>
  <span class="fu">ungroup</span>() <span class="kw">%&gt;%</span>
  <span class="fu">mutate</span>(<span class="kw">`P(Y = 1 | X = 0)`</span> <span class="kw">=</span> <span class="fl">1</span>/(<span class="fl">1</span>+<span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span>(-<span class="no">gamma0</span>)),
         <span class="kw">`P(Y = 1 | X = 1)`</span> <span class="kw">=</span> <span class="fl">1</span>/(<span class="fl">1</span>+<span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span>(-<span class="no">gamma0</span> - <span class="no">gamma1</span>)),
         <span class="kw">ACE</span> <span class="kw">=</span> <span class="no">`P(Y = 1 | X = 1)`</span> - <span class="no">`P(Y = 1 | X = 0)`</span>)</pre></body></html></div>
<pre><code>## You'll run out of memory. Switching to MCMC approx...</code></pre>
<div class="sourceCode" id="cb19"><html><body><pre class="r"><span class="no">varying_betas_with_bounds</span> <span class="kw">&lt;-</span> <span class="no">varying_betas</span> <span class="kw">%&gt;%</span>
  <span class="fu">unnest</span>(<span class="kw">cols</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="no">betas</span>, <span class="no">`P(X = 1 | Z)`</span>)) <span class="kw">%&gt;%</span>
  <span class="fu">mutate</span>(<span class="kw">`P(Y = 1 | Z_j = 0)`</span> <span class="kw">=</span> <span class="no">`P(Y = 1 | X = 1)`</span>*<span class="no">`P(X = 1 | Z_j = 0)`</span> +
           <span class="no">`P(Y = 1 | X = 0)`</span>*(<span class="fl">1</span>-<span class="no">`P(X = 1 | Z_j = 0)`</span>),
         <span class="kw">`P(Y = 1 | Z_j = 1)`</span> <span class="kw">=</span> <span class="no">`P(Y = 1 | X = 1)`</span>*<span class="no">`P(X = 1 | Z_j = 1)`</span> +
           <span class="no">`P(Y = 1 | X = 0)`</span>*(<span class="fl">1</span>-<span class="no">`P(X = 1 | Z_j = 1)`</span>),
         <span class="kw">`P(Y = 1 | Z_j = 2)`</span> <span class="kw">=</span> <span class="no">`P(Y = 1 | X = 1)`</span>*<span class="no">`P(X = 1 | Z_j = 2)`</span> +
           <span class="no">`P(Y = 1 | X = 0)`</span>*(<span class="fl">1</span>-<span class="no">`P(X = 1 | Z_j = 2)`</span>),
         <span class="kw">strength</span> <span class="kw">=</span> <span class="no">`P(X = 1 | Z_j = 2)`</span> - <span class="no">`P(X = 1 | Z_j = 0)`</span>) <span class="kw">%&gt;%</span>
  <span class="fu">rowwise</span>() <span class="kw">%&gt;%</span>
  <span class="fu">mutate</span>(
    <span class="kw">gammas</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="no">`P(Y = 1 | Z_j = 0)`</span>, <span class="no">`P(Y = 1 | Z_j = 1)`</span>, <span class="no">`P(Y = 1 | Z_j = 2)`</span>)),
    <span class="kw">thetas</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="no">`P(X = 1 | Z_j = 0)`</span>, <span class="no">`P(X = 1 | Z_j = 1)`</span>, <span class="no">`P(X = 1 | Z_j = 2)`</span>)),
    <span class="kw">bounds</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="fu"><a href="../reference/get_bounds.html">get_bounds</a></span>(<span class="kw">gammas</span> <span class="kw">=</span> <span class="no">gammas</span>,
                             <span class="kw">thetas</span> <span class="kw">=</span> <span class="no">thetas</span>,
                             <span class="kw">stop</span> <span class="kw">=</span> <span class="fl">FALSE</span>,
                             <span class="kw">warning</span> <span class="kw">=</span> <span class="fl">FALSE</span>)),
    <span class="kw">mono_bounds</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="fu"><a href="../reference/get_bounds.html">get_bounds</a></span>(<span class="kw">gammas</span> <span class="kw">=</span> <span class="no">gammas</span>,
                                  <span class="kw">thetas</span> <span class="kw">=</span> <span class="no">thetas</span>,
                                  <span class="kw">stop</span> <span class="kw">=</span> <span class="fl">FALSE</span>,
                                  <span class="kw">warning</span> <span class="kw">=</span> <span class="fl">FALSE</span>,
                                  <span class="kw">x_mono</span> <span class="kw">=</span> <span class="fl">TRUE</span>))
  )

<span class="co"># DT::datatable(</span>
<span class="co">#   varying_betas_with_bounds,</span>
<span class="co">#   options = list(scrollX = TRUE,</span>
<span class="co">#                  scrollY = 300,</span>
<span class="co">#                  dom = "t"),</span>
<span class="co">#   rownames = FALSE</span>
<span class="co"># )</span></pre></body></html></div>
<div id="plots-1" class="section level3">
<h3 class="hasAnchor">
<a href="#plots-1" class="anchor"></a>Plots</h3>
<p>Since coefficients vary, we do not reproduce the first plot presented above, but instead go straight to bounds vs. strength. What’s interesting to observe here is that the bounds are monotonically shrinking as the strength increases. We know this to be the case in theory when <em>everything else is equal</em>.</p>
<div class="sourceCode" id="cb20"><html><body><pre class="r"><span class="no">varying_betas_for_plots</span> <span class="kw">&lt;-</span> <span class="no">varying_betas_with_bounds</span> <span class="kw">%&gt;%</span>
  <span class="fu">rowwise</span>() <span class="kw">%&gt;%</span>
  <span class="fu">mutate</span>(<span class="kw">interval</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="no">bounds</span>$<span class="no">interval</span>),
         <span class="kw">mono_interval</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="no">mono_bounds</span>$<span class="no">interval</span>)) <span class="kw">%&gt;%</span>
  <span class="fu">ungroup</span>() <span class="kw">%&gt;%</span>
  <span class="fu">select</span>(-<span class="fu">contains</span>(<span class="st">"P("</span>)) <span class="kw">%&gt;%</span>
  <span class="fu">unnest_wider</span>(<span class="no">mono_interval</span>) <span class="kw">%&gt;%</span>
  <span class="fu">rename</span>(<span class="kw">mono_upper</span> <span class="kw">=</span> <span class="no">upper</span>,
         <span class="kw">mono_lower</span> <span class="kw">=</span> <span class="no">lower</span>) <span class="kw">%&gt;%</span>
  <span class="fu">unnest_wider</span>(<span class="no">interval</span>) <span class="kw">%&gt;%</span>
  <span class="fu">ungroup</span>()

<span class="no">varying_betas_bounds_vs_strength_no_mono</span> <span class="kw">&lt;-</span> <span class="no">varying_betas_for_plots</span> <span class="kw">%&gt;%</span>
  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">strength</span>)) +
    <span class="fu">geom_hline</span>(<span class="fu">aes</span>(<span class="kw">yintercept</span> <span class="kw">=</span> <span class="no">ACE</span>, <span class="kw">color</span> <span class="kw">=</span> <span class="st">"ATE"</span>)) +
    <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="kw">ymin</span> <span class="kw">=</span> <span class="no">lower</span>, <span class="kw">ymax</span> <span class="kw">=</span> <span class="no">upper</span>)) +
    <span class="fu">scale_x_continuous</span>(<span class="kw">limits</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0</span>, <span class="fl">0.12</span>),
                       <span class="kw">breaks</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0</span>, <span class="fl">0.02</span>, <span class="fl">0.04</span>, <span class="fl">0.06</span>, <span class="fl">0.08</span>, <span class="fl">0.10</span>, <span class="fl">0.12</span>)) +
    <span class="fu">scale_y_continuous</span>(<span class="kw">limits</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(-<span class="fl">1</span>,<span class="fl">1</span>)) +
    <span class="fu">facet_grid</span>( ~ <span class="no">n</span>,
               <span class="kw">labeller</span> <span class="kw">=</span> <span class="kw">function</span>(<span class="no">...</span>) <span class="fu">label_both</span>(<span class="no">...</span>, <span class="kw">sep</span> <span class="kw">=</span> <span class="st">" = "</span>)) +
    <span class="fu">labs</span>(<span class="kw">title</span> <span class="kw">=</span> <span class="st">"Bounds vs. strength"</span>,
         <span class="kw">subtitle</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span>(<span class="st">"Coefficients "</span>, <span class="no">beta</span>[<span class="no">i</span>], <span class="st">" ~ Unif(0, 1/n) and "</span>,
                                     <span class="no">beta</span>[<span class="fl">0</span>], <span class="st">"= 1/"</span>, <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span>(<span class="no">n</span>), <span class="st">"."</span>, <span class="kw">sep</span> <span class="kw">=</span> <span class="st">""</span>)),
         <span class="kw">color</span> <span class="kw">=</span> <span class="st">""</span>) +
    <span class="fu">theme_bw</span>() +
    <span class="fu">theme</span>(<span class="kw">axis.text.x</span> <span class="kw">=</span> <span class="fu">element_text</span>(<span class="kw">angle</span> <span class="kw">=</span> <span class="fl">45</span>, <span class="kw">hjust</span> <span class="kw">=</span> <span class="fl">1</span>),
          <span class="kw">legend.position</span> <span class="kw">=</span> <span class="st">"bottom"</span>)

<span class="no">varying_betas_bounds_vs_strength_no_mono</span></pre></body></html></div>
<p><img src="bounds_from_bivariate_multiple_IVs_files/figure-html/unnamed-chunk-9-1.png" width="700"></p>
<p>Here is the strength of each IV against the corresponding coefficient. We see that increasing the coefficient by a certain amount leads to much smaller increase in strength when the total number of IVs included is larger. This makes sense, since when we include more variables in our model, <span class="math inline">\(P(X = 1 | Z_1,...,Z_n)\)</span> will increase, and eventually be practically one.</p>
<div class="sourceCode" id="cb21"><html><body><pre class="r"><span class="no">varying_betas_coefs_vs_strength</span> <span class="kw">&lt;-</span> <span class="fu">ggplot</span>(<span class="no">varying_betas_for_plots</span>,
       <span class="fu">aes</span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">betas</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="no">strength</span>)) +
  <span class="fu">geom_point</span>() +
  <span class="fu">facet_grid</span>(~<span class="no">n</span>, <span class="kw">scales</span> <span class="kw">=</span> <span class="st">"free"</span>)  +
  <span class="fu">labs</span>(<span class="kw">title</span> <span class="kw">=</span> <span class="st">"Coefficients vs. Strength"</span>,
       <span class="kw">subtitle</span> <span class="kw">=</span> <span class="st">"Coefficients Unif(0,3)"</span>)

<span class="no">varying_betas_coefs_vs_strength</span></pre></body></html></div>
<p><img src="bounds_from_bivariate_multiple_IVs_files/figure-html/unnamed-chunk-10-1.png" width="700"></p>
</div>
<div id="intersections" class="section level3">
<h3 class="hasAnchor">
<a href="#intersections" class="anchor"></a>Intersections</h3>
<p>The main question here is “what happens if we have many IVs, and combine the information to obtain bounds?” One way of doing that is by taking intersections of multiple bounds. It turns out that the information we obtain from doing so is practically equivalent to simply using the strongest IV. This is the case since the bounds are monotonically shrinking.</p>
<p>The plot below illustrates this by showing the width of the intersections plotted against the smallest width of the bounds going into that intersection.</p>
<div class="sourceCode" id="cb22"><html><body><pre class="r"><span class="no">varying_betas_intersection_vs_best</span> <span class="kw">&lt;-</span> <span class="no">varying_betas_for_plots</span> <span class="kw">%&gt;%</span>
  <span class="fu">group_by</span>(<span class="kw">n</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span>(<span class="no">n</span>)) <span class="kw">%&gt;%</span>
  <span class="fu">summarize</span>(<span class="kw">int_lower</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span>(<span class="no">lower</span>),
            <span class="kw">int_upper</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span>(<span class="no">upper</span>),
            <span class="kw">best_width</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span>(<span class="no">upper</span> - <span class="no">lower</span>),
            <span class="kw">int_width</span> <span class="kw">=</span> <span class="no">int_upper</span> - <span class="no">int_lower</span>) <span class="kw">%&gt;%</span>
  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">best_width</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="no">int_width</span>, <span class="kw">color</span> <span class="kw">=</span> <span class="no">n</span>)) +
    <span class="fu">geom_point</span>() +
    <span class="fu">geom_abline</span>() +
    <span class="fu">labs</span>(<span class="kw">title</span> <span class="kw">=</span> <span class="st">"Intersection Width vs. Min width"</span>,
         <span class="kw">subtitle</span> <span class="kw">=</span> <span class="st">"Coefficients Unif(0,3)"</span>)</pre></body></html></div>
<pre><code>## `summarise()` ungrouping output (override with `.groups` argument)</code></pre>
<div class="sourceCode" id="cb24"><html><body><pre class="r"><span class="no">varying_betas_intersection_vs_best</span></pre></body></html></div>
<p><img src="bounds_from_bivariate_multiple_IVs_files/figure-html/unnamed-chunk-11-1.png" width="700"></p>
<p>For good measure, here are the values plotted above including the intersection bounds, and the set of bounds resulting in the smallest width.</p>
<div class="sourceCode" id="cb25"><html><body><pre class="r"><span class="no">varying_betas_for_plots</span> <span class="kw">%&gt;%</span>
  <span class="fu">group_by</span>(<span class="kw">n</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span>(<span class="no">n</span>)) <span class="kw">%&gt;%</span>
  <span class="fu">summarize</span>(<span class="kw">int_lower</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span>(<span class="no">lower</span>),
            <span class="kw">int_upper</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span>(<span class="no">upper</span>),
            <span class="kw">best_width_lower</span> <span class="kw">=</span> <span class="no">lower</span>[<span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span>(<span class="no">upper</span> - <span class="no">lower</span> <span class="kw">==</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span>(<span class="no">upper</span> - <span class="no">lower</span>))],
            <span class="kw">best_width_upper</span> <span class="kw">=</span> <span class="no">upper</span>[<span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span>(<span class="no">upper</span> - <span class="no">lower</span> <span class="kw">==</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span>(<span class="no">upper</span> - <span class="no">lower</span>))],
            <span class="kw">best_width</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span>(<span class="no">upper</span> - <span class="no">lower</span>),
            <span class="kw">int_width</span> <span class="kw">=</span> <span class="no">int_upper</span> - <span class="no">int_lower</span>)</pre></body></html></div>
<pre><code>## `summarise()` ungrouping output (override with `.groups` argument)</code></pre>
<pre><code>## # A tibble: 3 x 7
##   n     int_lower int_upper best_width_lower best_width_upper best_width
##   &lt;fct&gt;     &lt;dbl&gt;     &lt;dbl&gt;            &lt;dbl&gt;            &lt;dbl&gt;      &lt;dbl&gt;
## 1 3        -0.803     0.393           -0.803            0.393       1.20
## 2 10       -0.830     0.408           -0.830            0.408       1.24
## 3 50       -0.786     0.473           -0.786            0.473       1.26
## # … with 1 more variable: int_width &lt;dbl&gt;</code></pre>
</div>
</div>
<div id="save-plots" class="section level1">
<h1 class="hasAnchor">
<a href="#save-plots" class="anchor"></a>Save plots</h1>
<div class="sourceCode" id="cb28"><html><body><pre class="r"><span class="fu">ggsave</span>(
  <span class="kw">filename</span> <span class="kw">=</span> <span class="kw pkg">here</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/here/man/here.html">here</a></span>(<span class="st">"figures"</span>, <span class="st">"bounds_vs_nIVs.png"</span>),
  <span class="kw">plot</span> <span class="kw">=</span> <span class="no">bounds_vs_nIVs</span>,
  <span class="kw">dpi</span> <span class="kw">=</span> <span class="fl">300</span>
)</pre></body></html></div>
<pre><code>## Saving 7.29 x 4.51 in image</code></pre>
<div class="sourceCode" id="cb30"><html><body><pre class="r"><span class="fu">ggsave</span>(
  <span class="kw">filename</span> <span class="kw">=</span> <span class="kw pkg">here</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/here/man/here.html">here</a></span>(<span class="st">"figures"</span>, <span class="st">"bounds_vs_strength.png"</span>),
  <span class="kw">plot</span> <span class="kw">=</span> <span class="no">bounds_vs_strength</span>,
  <span class="kw">dpi</span> <span class="kw">=</span> <span class="fl">300</span>
)</pre></body></html></div>
<pre><code>## Saving 7.29 x 4.51 in image</code></pre>
<div class="sourceCode" id="cb32"><html><body><pre class="r"><span class="fu">ggsave</span>(
  <span class="kw">filename</span> <span class="kw">=</span> <span class="kw pkg">here</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/here/man/here.html">here</a></span>(<span class="st">"figures"</span>, <span class="st">"bounds_vs_strength_paper.png"</span>),
  <span class="kw">plot</span> <span class="kw">=</span> <span class="no">bounds_vs_strength_paper</span>,
  <span class="kw">width</span> <span class="kw">=</span> <span class="fl">7</span>, <span class="kw">height</span> <span class="kw">=</span> <span class="fl">4</span>, <span class="kw">dpi</span> <span class="kw">=</span> <span class="fl">300</span>
)

<span class="fu">ggsave</span>(
  <span class="kw">filename</span> <span class="kw">=</span> <span class="kw pkg">here</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/here/man/here.html">here</a></span>(<span class="st">"figures"</span>, <span class="st">"strength_vs_nIVs.png"</span>),
  <span class="kw">plot</span> <span class="kw">=</span> <span class="no">strength_vs_nIVs</span>,
  <span class="kw">dpi</span> <span class="kw">=</span> <span class="fl">300</span>
)</pre></body></html></div>
<pre><code>## Saving 7.29 x 4.51 in image</code></pre>
<div class="sourceCode" id="cb34"><html><body><pre class="r"><span class="co"># ggsave(</span>
<span class="co">#   filename = here::here("figures", "varying_betas_bounds_vs_strength.png"),</span>
<span class="co">#   plot = varying_betas_bounds_vs_strength,</span>
<span class="co">#   dpi = 300</span>
<span class="co"># )</span>

<span class="fu">ggsave</span>(
  <span class="kw">filename</span> <span class="kw">=</span> <span class="kw pkg">here</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/here/man/here.html">here</a></span>(<span class="st">"figures"</span>, <span class="st">"varying_betas_bounds_vs_strength_no_mono.png"</span>),
  <span class="kw">plot</span> <span class="kw">=</span> <span class="no">varying_betas_bounds_vs_strength_no_mono</span>,
  <span class="kw">width</span> <span class="kw">=</span> <span class="fl">7</span>, <span class="kw">height</span> <span class="kw">=</span> <span class="fl">4</span>, <span class="kw">dpi</span> <span class="kw">=</span> <span class="fl">300</span>
)


<span class="fu">ggsave</span>(
  <span class="kw">filename</span> <span class="kw">=</span> <span class="kw pkg">here</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/here/man/here.html">here</a></span>(<span class="st">"figures"</span>, <span class="st">"varying_betas_coefs_vs_strength.png"</span>),
  <span class="kw">plot</span> <span class="kw">=</span> <span class="no">varying_betas_coefs_vs_strength</span>,
  <span class="kw">dpi</span> <span class="kw">=</span> <span class="fl">300</span>
)</pre></body></html></div>
<pre><code>## Saving 7.29 x 4.51 in image</code></pre>
<div class="sourceCode" id="cb36"><html><body><pre class="r"><span class="fu">ggsave</span>(
  <span class="kw">filename</span> <span class="kw">=</span> <span class="kw pkg">here</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/here/man/here.html">here</a></span>(<span class="st">"figures"</span>, <span class="st">"varying_betas_intersection_vs_best.png"</span>),
  <span class="kw">plot</span> <span class="kw">=</span> <span class="no">varying_betas_intersection_vs_best</span>,
  <span class="kw">dpi</span> <span class="kw">=</span> <span class="fl">300</span>
)</pre></body></html></div>
<pre><code>## Saving 7.29 x 4.51 in image</code></pre>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Ralph Møller Trane.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
