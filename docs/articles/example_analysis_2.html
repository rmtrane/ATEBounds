<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Example Analysis of Data from the IEU GWAS Database • ACEBounds</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Example Analysis of Data from the IEU GWAS Database">
<meta property="og:description" content="Step-by-step example of a MR analysis using the methods discussed in our paper on data obtained from the IEU GWAS Database.
">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">ACEBounds</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/ACEBounds.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li class="divider">
    <li class="dropdown-header">Exploration of Bounds</li>
    <li>
      <a href="../articles/bounds_from_bivariate.html">Bounds using Bivariate Data</a>
    </li>
    <li>
      <a href="../articles/bounds_from_bivariate_multiple_IVs.html">Bounds using Multiple IVs in Bivariate Data</a>
    </li>
    <li>
      <a href="../articles/bounds_from_trivariate.html">Utilize bivariate data in trivariate bounds</a>
    </li>
    <li class="divider">
    <li class="dropdown-header">How-To's</li>
    <li>
      <a href="../articles/polymake_example.html">Polymake Example</a>
    </li>
    <li>
      <a href="../articles/get_bounds.html">How to use the `get_bounds` function</a>
    </li>
    <li>
      <a href="../articles/example_analysis.html">Example Analysis of Data from the IEU GWAS Database</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/rmtrane/ACEBounds/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="example_analysis_2_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Example Analysis of Data from the IEU GWAS Database</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/rmtrane/ACEBounds/blob/master/vignettes/example_analysis_2.Rmd"><code>vignettes/example_analysis_2.Rmd</code></a></small>
      <div class="hidden name"><code>example_analysis_2.Rmd</code></div>

    </div>

    
    
<div id="example-analysis" class="section level2">
<h2 class="hasAnchor">
<a href="#example-analysis" class="anchor"></a>Example Analysis</h2>
<p>Here, we will use smoking as exposure, and depression as outcome (both as binary).</p>
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">TwoSampleMR</span>)</pre></body></html></div>
<pre><code>## TwoSampleMR version 0.5.4 
## [&gt;] All datasets re-instated
## [&gt;] New: Option to use non-European LD reference panels for clumping etc
## [&gt;] See news(package='TwoSampleMR') and https://gwas.mrcieu.ac.uk for latest information</code></pre>
<pre><code>## 
## Warning:
## You are running an old version of the TwoSampleMR package.
## This version:   0.5.4
## Latest version: 0.5.5
## Please consider updating using devtools::install_github('MRCIEU/TwoSampleMR')</code></pre>
<div class="sourceCode" id="cb4"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">tidyverse</span>)</pre></body></html></div>
<pre><code>## ── Attaching packages ────────────────────────────────────────────────────── tidyverse 1.3.0 ──</code></pre>
<pre><code>## ✓ ggplot2 3.3.2     ✓ purrr   0.3.4
## ✓ tibble  3.0.3     ✓ dplyr   1.0.1
## ✓ tidyr   1.1.1     ✓ stringr 1.4.0
## ✓ readr   1.3.1     ✓ forcats 0.5.0</code></pre>
<pre><code>## ── Conflicts ───────────────────────────────────────────────────────── tidyverse_conflicts() ──
## x dplyr::filter() masks stats::filter()
## x dplyr::lag()    masks stats::lag()</code></pre>
<div class="sourceCode" id="cb8"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">magrittr</span>)</pre></body></html></div>
<pre><code>## 
## Attaching package: 'magrittr'</code></pre>
<pre><code>## The following object is masked from 'package:purrr':
## 
##     set_names</code></pre>
<pre><code>## The following object is masked from 'package:tidyr':
## 
##     extract</code></pre>
<div class="sourceCode" id="cb12"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">ACEBounds</span>)

<span class="no">run_mono</span> <span class="kw">&lt;-</span> <span class="fl">FALSE</span></pre></body></html></div>
<p>Using the <code>TwoSampleMR</code> package, we get the data from the online database. First, we get a <code>tibble</code> with all available outcomes.</p>
<div class="sourceCode" id="cb13"><html><body><pre class="r"><span class="no">ao</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/TwoSampleMR/man/available_outcomes.html">available_outcomes</a></span>()</pre></body></html></div>
<pre><code>## API: public: http://gwas-api.mrcieu.ac.uk/</code></pre>
<p>From this, we identify an experiment. The ID is saved to the object <code>exposure_id</code>, and information about the study is saved to the <code>exposure_experiment</code> object.</p>
<div class="sourceCode" id="cb15"><html><body><pre class="r"><span class="no">exposure_id</span> <span class="kw">&lt;-</span> <span class="st">"ukb-d-20116_0"</span>
<span class="no">exposure_experiment</span> <span class="kw">&lt;-</span> <span class="no">ao</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(<span class="no">id</span> <span class="kw">==</span> <span class="no">exposure_id</span>)</pre></body></html></div>
<p>Next, we obtain potential instruments for the exposure variable.</p>
<div class="sourceCode" id="cb16"><html><body><pre class="r"><span class="no">exposure_dat</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/TwoSampleMR/man/extract_instruments.html">extract_instruments</a></span>(<span class="no">exposure_id</span>)</pre></body></html></div>
<p>Similarly, we obtain outcome data: identify an appropriate study, save the ID to <code>outcome_id</code> and information to <code>outcome_experiment</code>.</p>
<div class="sourceCode" id="cb17"><html><body><pre class="r"><span class="no">outcome_id</span> <span class="kw">&lt;-</span> <span class="st">"ukb-d-20544_11"</span> <span class="co"># Depression</span>
<span class="no">outcome_id</span> <span class="kw">&lt;-</span> <span class="st">"bbj-a-133"</span> <span class="co"># "ieu-a-966" # Lung Cancer</span>
<span class="no">outcome_experiment</span> <span class="kw">&lt;-</span> <span class="no">ao</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(<span class="no">id</span> <span class="kw">==</span> <span class="no">outcome_id</span>)</pre></body></html></div>
<p>Finally, we extract data from the study.</p>
<div class="sourceCode" id="cb18"><html><body><pre class="r"><span class="no">outcome_dat</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/TwoSampleMR/man/extract_outcome_data.html">extract_outcome_data</a></span>(<span class="kw">snps</span> <span class="kw">=</span> <span class="no">exposure_dat</span>$<span class="no">SNP</span>, <span class="kw">outcomes</span> <span class="kw">=</span> <span class="no">outcome_id</span>)</pre></body></html></div>
<pre><code>## Extracting data for 84 SNP(s) from 1 GWAS(s)</code></pre>
<pre><code>## Finding proxies for 11 SNPs in outcome bbj-a-133</code></pre>
<pre><code>## Extracting data for 11 SNP(s) from 1 GWAS(s)</code></pre>
<p>Data is then harmonized.</p>
<div class="sourceCode" id="cb22"><html><body><pre class="r"><span class="no">dat</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/TwoSampleMR/man/harmonise_data.html">harmonise_data</a></span>(<span class="no">exposure_dat</span>, <span class="no">outcome_dat</span>) <span class="kw">%&gt;%</span> <span class="fu">as_tibble</span>()</pre></body></html></div>
<pre><code>## Harmonising Smoking status: Never || id:ukb-d-20116_0 (ukb-d-20116_0) and Lung cancer || id:bbj-a-133 (bbj-a-133)</code></pre>
<pre><code>## Removing the following SNPs for being palindromic with intermediate allele frequencies:
## rs11693702, rs1492546, rs2240294, rs264974, rs568599</code></pre>
<p>Since the results reported to the database do not include <span class="math inline">\(P(Y = 1 | Z = z)\)</span> and <span class="math inline">\(P(X = 1 | Z = z)\)</span>, we need to reconstruct those. To do so, we first need to find <span class="math inline">\(P(Y = 1)\)</span> and <span class="math inline">\(P(X = 1)\)</span>:</p>
<div class="sourceCode" id="cb25"><html><body><pre class="r"><span class="no">pop_probs</span> <span class="kw">&lt;-</span> <span class="fu">tibble</span>(<span class="kw">regression</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"outcome"</span>, <span class="st">"exposure"</span>),
                    <span class="kw">p_outcome</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="no">outcome_experiment</span>  <span class="kw">%$%</span> { <span class="no">ncase</span> / (<span class="no">ncase</span> + <span class="no">ncontrol</span>) },
                                  <span class="no">exposure_experiment</span> <span class="kw">%$%</span> { <span class="no">ncase</span> / (<span class="no">ncase</span> + <span class="no">ncontrol</span>) }))</pre></body></html></div>
<p>The following helper function takes finds the intercept in logistic regression that ensures the marginal probabilities <span class="math inline">\(P(Y = 1)\)</span> and <span class="math inline">\(P(X = 1)\)</span> match what’s observed.</p>
<div class="sourceCode" id="cb26"><html><body><pre class="r"><span class="no">find_intercept</span> <span class="kw">&lt;-</span> <span class="kw">function</span>(<span class="no">beta1</span>, <span class="no">p_outcome</span>, <span class="no">pz</span>, <span class="no">interval</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(-<span class="fl">5</span>, <span class="fl">5</span>), <span class="no">zs</span> <span class="kw">=</span> <span class="fl">0</span>:<span class="fl">2</span>){
  <span class="fu"><a href="https://rdrr.io/r/stats/uniroot.html">uniroot</a></span>(<span class="kw">f</span> <span class="kw">=</span> <span class="kw">function</span>(<span class="no">beta0</span>) <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>((<span class="fl">1</span>+<span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span>(-<span class="no">beta0</span>-<span class="no">beta1</span>*<span class="no">zs</span>))^(-<span class="fl">1</span>) * <span class="no">pz</span>) - <span class="no">p_outcome</span>,
          <span class="kw">interval</span> <span class="kw">=</span> <span class="no">interval</span>)
}</pre></body></html></div>
<p>Next, we need <span class="math inline">\(P(Z = z)\)</span>. These can be found from the allele frequencies. Since we have data on <span class="math inline">\(Z\)</span> from two separate sources, and the allele frequencies vary ever so slightly between the two, we use a weighted average of the allele frequencies as our final estimates. With these estimated allele frequencies, we can find <span class="math inline">\(P(Z = z)\)</span>.</p>
<div class="sourceCode" id="cb27"><html><body><pre class="r"><span class="no">prep_for_bounds</span> <span class="kw">&lt;-</span> <span class="no">dat</span> <span class="kw">%&gt;%</span>
  <span class="fu">rowwise</span>() <span class="kw">%&gt;%</span>
  <span class="fu">mutate</span>(<span class="kw">samplesize.exposure</span> <span class="kw">=</span> <span class="fu">if_else</span>(<span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span>(<span class="no">samplesize.exposure</span>),
                                       <span class="no">exposure_experiment</span>$<span class="no">ncase</span> + <span class="no">exposure_experiment</span>$<span class="no">ncontrol</span>,
                                       <span class="fu"><a href="https://rdrr.io/r/base/integer.html">as.integer</a></span>(<span class="no">samplesize.exposure</span>)),
         <span class="kw">samplesize.outcome</span> <span class="kw">=</span> <span class="fu">if_else</span>(<span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span>(<span class="no">samplesize.outcome</span>),
                                      <span class="no">outcome_experiment</span>$<span class="no">ncase</span> + <span class="no">outcome_experiment</span>$<span class="no">ncontrol</span>,
                                      <span class="fu"><a href="https://rdrr.io/r/base/integer.html">as.integer</a></span>(<span class="no">samplesize.outcome</span>)),
         <span class="kw">ave_eaf</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/weighted.mean.html">weighted.mean</a></span>(<span class="kw">x</span> <span class="kw">=</span> <span class="fu">c_across</span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="no">eaf.exposure</span>, <span class="no">eaf.outcome</span>)),
                                 <span class="kw">w</span> <span class="kw">=</span> <span class="fu">c_across</span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="no">samplesize.exposure</span>, <span class="no">samplesize.outcome</span>)))) <span class="kw">%&gt;%</span>
  <span class="fu">select</span>(<span class="no">SNP</span>, <span class="fu">contains</span>(<span class="st">"beta"</span>), <span class="no">ave_eaf</span>) <span class="kw">%&gt;%</span>
  <span class="fu">pivot_longer</span>(<span class="fu">contains</span>(<span class="st">"beta"</span>)) <span class="kw">%&gt;%</span>
  <span class="fu">separate</span>(<span class="no">name</span>, <span class="kw">into</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"variable"</span>, <span class="st">"regression"</span>), <span class="kw">sep</span> <span class="kw">=</span> <span class="st">"\\."</span>) <span class="kw">%&gt;%</span>
  <span class="fu">pivot_wider</span>(<span class="kw">names_from</span> <span class="kw">=</span> <span class="no">variable</span>, <span class="kw">values_from</span> <span class="kw">=</span> <span class="no">value</span>) <span class="kw">%&gt;%</span>
  <span class="fu">mutate</span>(<span class="kw">`P(Z = 2)`</span> <span class="kw">=</span> (<span class="fl">1</span> - <span class="no">ave_eaf</span>)^<span class="fl">2</span>,
         <span class="kw">`P(Z = 1)`</span> <span class="kw">=</span> <span class="fl">2</span>*<span class="no">ave_eaf</span>*(<span class="fl">1</span> - <span class="no">ave_eaf</span>),
         <span class="kw">`P(Z = 0)`</span> <span class="kw">=</span> <span class="no">ave_eaf</span>^<span class="fl">2</span>)</pre></body></html></div>
<p>We add the values of <span class="math inline">\(P(X = 1)\)</span> and <span class="math inline">\(P(Y = 1)\)</span> to the tibble, and can now use the helper function defined above to find the intercepts that matches with the marginals.</p>
<div class="sourceCode" id="cb28"><html><body><pre class="r"><span class="no">prep_for_bounds_w_intercept</span> <span class="kw">&lt;-</span> <span class="no">prep_for_bounds</span> <span class="kw">%&gt;%</span>
  <span class="fu">left_join</span>(<span class="no">pop_probs</span>) <span class="kw">%&gt;%</span>
  <span class="fu">rowwise</span>() <span class="kw">%&gt;%</span>
  <span class="fu">mutate</span>(<span class="kw">find_intercept</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="fu">find_intercept</span>(<span class="kw">beta1</span> <span class="kw">=</span> <span class="no">beta</span>,
                                              <span class="kw">p_outcome</span> <span class="kw">=</span> <span class="no">p_outcome</span>,
                                              <span class="kw">pz</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="no">`P(Z = 0)`</span>, <span class="no">`P(Z = 1)`</span>, <span class="no">`P(Z = 2)`</span>),
                                              <span class="kw">interval</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(-<span class="fl">7</span>,<span class="fl">7</span>))),
         <span class="kw">beta0</span> <span class="kw">=</span> <span class="no">find_intercept</span>$<span class="no">root</span>,
         <span class="kw">`thetas/gammas`</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="fl">1</span>/(<span class="fl">1</span>+<span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span>(-<span class="no">beta0</span> - <span class="fl">0</span>:<span class="fl">2</span>*<span class="no">beta</span>))))</pre></body></html></div>
<pre><code>## Joining, by = "regression"</code></pre>
<p>Finally, we calculate the bounds (both with and without assuming monotonicity of <span class="math inline">\(P(X = 1 | Z = z)\)</span>) using the <code><a href="../reference/get_bounds.html">get_bounds()</a></code> function.</p>
<div class="sourceCode" id="cb30"><html><body><pre class="r"><span class="no">bounds</span> <span class="kw">&lt;-</span> <span class="no">prep_for_bounds_w_intercept</span> <span class="kw">%&gt;%</span>
  <span class="fu">select</span>(-<span class="no">find_intercept</span>, -<span class="no">beta0</span>, -<span class="no">beta</span>, -<span class="no">p_outcome</span>, -<span class="no">ave_eaf</span>) <span class="kw">%&gt;%</span>
  <span class="fu">mutate</span>(<span class="kw">regression</span> <span class="kw">=</span> <span class="fu">if_else</span>(<span class="no">regression</span> <span class="kw">==</span> <span class="st">"outcome"</span>, <span class="st">"gammas"</span>, <span class="st">"thetas"</span>)) <span class="kw">%&gt;%</span>
  <span class="fu">pivot_wider</span>(<span class="kw">names_from</span> <span class="kw">=</span> <span class="no">regression</span>, <span class="kw">values_from</span> <span class="kw">=</span> <span class="no">`thetas/gammas`</span>) <span class="kw">%&gt;%</span>
  <span class="fu">rowwise</span>() <span class="kw">%&gt;%</span>
  <span class="fu">mutate</span>(<span class="kw">bivariate_bounds</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="fu"><a href="../reference/get_bounds.html">get_bounds</a></span>(<span class="kw">thetas</span> <span class="kw">=</span> <span class="no">thetas</span>, <span class="kw">gammas</span> <span class="kw">=</span> <span class="no">gammas</span>,
                                            <span class="kw">stop</span> <span class="kw">=</span> <span class="fl">FALSE</span>, <span class="kw">warning</span> <span class="kw">=</span> <span class="fl">FALSE</span>)),
         <span class="kw">interval</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="no">bivariate_bounds</span>$<span class="no">interval</span>),
         <span class="kw">constraints_violated</span> <span class="kw">=</span> <span class="no">bivariate_bounds</span>$<span class="no">constraints_violated</span>,
         <span class="kw">bivariate_bounds_mono</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="fu"><a href="../reference/get_bounds.html">get_bounds</a></span>(<span class="kw">thetas</span> <span class="kw">=</span> <span class="no">thetas</span>, <span class="kw">gammas</span> <span class="kw">=</span> <span class="no">gammas</span>,
                                                 <span class="kw">stop</span> <span class="kw">=</span> <span class="fl">FALSE</span>, <span class="kw">warning</span> <span class="kw">=</span> <span class="fl">FALSE</span>,
                                                  <span class="kw">x_mono</span> <span class="kw">=</span> <span class="fl">TRUE</span>)),
         <span class="kw">interval_mono</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="no">bivariate_bounds_mono</span>$<span class="no">interval</span>),
         <span class="kw">constraints_violated_mono</span> <span class="kw">=</span> <span class="no">bivariate_bounds_mono</span>$<span class="no">constraints_violated</span>) <span class="kw">%&gt;%</span>
  <span class="fu">ungroup</span>() <span class="kw">%&gt;%</span>
  <span class="fu">unnest_wider</span>(<span class="kw">col</span> <span class="kw">=</span> <span class="no">interval_mono</span>) <span class="kw">%&gt;%</span>
  <span class="fu">rename</span>(<span class="kw">upper_mono</span> <span class="kw">=</span> <span class="no">upper</span>, <span class="kw">lower_mono</span> <span class="kw">=</span> <span class="no">lower</span>) <span class="kw">%&gt;%</span>
  <span class="fu">unnest_wider</span>(<span class="no">interval</span>)</pre></body></html></div>
<p>The bivariate bounds obtained from the 77 SNPs are shown on the following plot. As can be seen, none of the bounds provide much information at all, and all intervals are rather wide.</p>
<div class="sourceCode" id="cb31"><html><body><pre class="r"><span class="no">all_bivariate_bounds</span> <span class="kw">&lt;-</span> <span class="no">bounds</span> <span class="kw">%&gt;%</span>
  <span class="fu">arrange</span>(<span class="no">lower</span>) <span class="kw">%&gt;%</span>
  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">SNP</span>)) +
    <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="kw">ymax</span> <span class="kw">=</span> <span class="no">upper</span>, <span class="kw">ymin</span> <span class="kw">=</span> <span class="no">lower</span>)) +
    <span class="fu">theme_bw</span>() +
    <span class="fu">theme</span>(<span class="kw">axis.text.x</span> <span class="kw">=</span> <span class="fu">element_text</span>(<span class="kw">angle</span> <span class="kw">=</span> <span class="fl">45</span>, <span class="kw">hjust</span> <span class="kw">=</span> <span class="fl">1</span>)) +
    <span class="fu">labs</span>(<span class="kw">title</span> <span class="kw">=</span> <span class="st">"Bivariate bounds"</span>,
         <span class="kw">subtitle</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="st">"Exposure Experiment id: "</span>, <span class="no">exposure_id</span>, <span class="st">". "</span>,
                           <span class="st">"Outcome Experiment id: "</span>, <span class="no">outcome_id</span>, <span class="st">"."</span>))

<span class="no">all_bivariate_bounds</span></pre></body></html></div>
<p><img src="example_analysis_2_files/figure-html/unnamed-chunk-13-1.png" width="700"></p>
</div>
<div id="random-sampling-of-potential-joint-distributions" class="section level2">
<h2 class="hasAnchor">
<a href="#random-sampling-of-potential-joint-distributions" class="anchor"></a>Random Sampling of Potential Joint Distributions</h2>
<p>To try to squeeze more information out of the data at hand, we try to randomly sample distributions <span class="math inline">\(P(Y = y, X = x | Z = z)\)</span> that match the marginals we have, and don’t violate the IV model.</p>
<p>Using the function <code><a href="../reference/potential_covs.html">potential_covs()</a></code>, we get constraints on the values of <span class="math inline">\(\text{Cov}(X,Y | Z = z)\)</span>. Feeding these constraints to <code><a href="../reference/sample_joint_probs.html">sample_joint_probs()</a></code>, we sample <span class="math inline">\(500\)</span> joint distributions for each SNP.</p>
<div class="sourceCode" id="cb32"><html><body><pre class="r"><span class="no">filename</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="st">"samples_of_joints_"</span>, <span class="no">exposure_id</span>, <span class="st">"_"</span>, <span class="no">outcome_id</span>, <span class="st">".Rds"</span>)

<span class="kw">if</span>(<span class="fu"><a href="https://rdrr.io/r/base/files.html">file.exists</a></span>(<span class="kw pkg">here</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/here/man/here.html">here</a></span>(<span class="st">"vignettes_data/example_analyses"</span>, <span class="no">filename</span>))){
  <span class="no">samples_of_joints</span> <span class="kw">&lt;-</span> <span class="fu">read_rds</span>(<span class="kw pkg">here</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/here/man/here.html">here</a></span>(<span class="st">"vignettes_data/example_analyses"</span>, <span class="no">filename</span>))
} <span class="kw">else</span> {
  <span class="no">samples_of_joints</span> <span class="kw">&lt;-</span> <span class="no">bounds</span> <span class="kw">%&gt;%</span>
    <span class="fu">rowwise</span>() <span class="kw">%&gt;%</span>
    <span class="fu">mutate</span>(<span class="kw">pot_covs</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="fu"><a href="../reference/potential_covs.html">potential_covs</a></span>(<span class="kw">thetas</span> <span class="kw">=</span> <span class="no">thetas</span>, <span class="kw">gammas</span> <span class="kw">=</span> <span class="no">gammas</span>)),
           <span class="kw">sample_joint</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="fu"><a href="../reference/sample_joint_probs.html">sample_joint_probs</a></span>(<span class="no">pot_covs</span>, <span class="kw">n</span> <span class="kw">=</span> <span class="fl">500</span>, <span class="kw">return_bounds</span> <span class="kw">=</span> <span class="fl">TRUE</span>)))

  <span class="fu">write_rds</span>(<span class="no">samples_of_joints</span>, <span class="kw pkg">here</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/here/man/here.html">here</a></span>(<span class="st">"vignettes_data/example_analyses"</span>, <span class="no">filename</span>))
}</pre></body></html></div>
<p>We do some expanding to expose the bounds from these joint distributions.</p>
<div class="sourceCode" id="cb33"><html><body><pre class="r"><span class="no">trivariate_bounds</span> <span class="kw">&lt;-</span> <span class="no">samples_of_joints</span> <span class="kw">%&gt;%</span>
  <span class="fu">ungroup</span>() <span class="kw">%&gt;%</span>
  <span class="fu">select</span>(<span class="no">SNP</span>, <span class="kw">bivariate_lower</span> <span class="kw">=</span> <span class="no">lower</span>, <span class="kw">bivariate_upper</span> <span class="kw">=</span> <span class="no">upper</span>, <span class="no">sample_joint</span>) <span class="kw">%&gt;%</span>
  <span class="fu">unnest</span>(<span class="no">sample_joint</span>) <span class="kw">%&gt;%</span>
  <span class="fu">unnest</span>(<span class="no">joint</span>) <span class="kw">%&gt;%</span>
  <span class="fu">unnest_wider</span>(<span class="no">bounds</span>) <span class="kw">%&gt;%</span>
  <span class="fu">mutate</span>(<span class="kw">contains_zero</span> <span class="kw">=</span> <span class="no">lower</span> <span class="kw">&lt;</span> <span class="fl">0</span> <span class="kw">&amp;</span> <span class="no">upper</span> <span class="kw">&gt;</span> <span class="fl">0</span>)</pre></body></html></div>
<p>The plot below shows all bounds obtained from sampled joint distributions along with the original bivariate bounds. In this particular example, having a dataset with observations of <span class="math inline">\((X,Y,Z)\)</span> would not provide much more information. There seems to be essentially no setting where the IV model holds, the marginals we observe are correct, AND the joint distribution would allow to determine direction of the ACE.</p>
<div class="sourceCode" id="cb34"><html><body><pre class="r"><span class="no">individual_SNPs_plot</span> <span class="kw">&lt;-</span> <span class="no">trivariate_bounds</span> <span class="kw">%&gt;%</span>
  <span class="fu">group_by</span>(<span class="no">SNP</span>) <span class="kw">%&gt;%</span>
  <span class="fu">arrange</span>(<span class="no">lower</span>) <span class="kw">%&gt;%</span>
  <span class="fu">mutate</span>(<span class="kw">id</span> <span class="kw">=</span> <span class="fu">row_number</span>()) <span class="kw">%&gt;%</span>
  <span class="fu">ungroup</span>() <span class="kw">%&gt;%</span>
  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">id</span>)) +
    <span class="fu">geom_hline</span>(<span class="fu">aes</span>(<span class="kw">yintercept</span> <span class="kw">=</span> <span class="no">bivariate_lower</span>),
               <span class="kw">linetype</span> <span class="kw">=</span> <span class="st">"dashed"</span>) +
    <span class="fu">geom_hline</span>(<span class="fu">aes</span>(<span class="kw">yintercept</span> <span class="kw">=</span> <span class="no">bivariate_upper</span>),
               <span class="kw">linetype</span> <span class="kw">=</span> <span class="st">"dashed"</span>) +
    <span class="fu">geom_hline</span>(<span class="kw">yintercept</span> <span class="kw">=</span> <span class="fl">0</span>) +
    <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="kw">ymin</span> <span class="kw">=</span> <span class="no">lower</span>,
                      <span class="kw">ymax</span> <span class="kw">=</span> <span class="no">upper</span>,
                      <span class="kw">color</span> <span class="kw">=</span> <span class="no">contains_zero</span>)) +
    <span class="fu">facet_wrap</span>(~<span class="no">SNP</span>, <span class="kw">nrow</span> <span class="kw">=</span> <span class="fl">7</span>)

<span class="no">individual_SNPs_plot</span></pre></body></html></div>
<p><img src="example_analysis_2_files/figure-html/unnamed-chunk-16-1.png" width="1248"></p>
<p>Below is a similar plot where we assume monotonicity of <span class="math inline">\(P(X = 1 | Z = z)\)</span>. This is only done in cases where the marginals are such that the bivariate constraints are not violated.</p>
<div class="sourceCode" id="cb35"><html><body><pre class="r"><span class="no">filename_mono</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="st">"samples_of_joints_mono_"</span>, <span class="no">exposure_id</span>, <span class="st">"_"</span>, <span class="no">outcome_id</span>, <span class="st">".Rds"</span>)
<span class="kw">if</span>(<span class="fu"><a href="https://rdrr.io/r/base/files.html">file.exists</a></span>(<span class="kw pkg">here</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/here/man/here.html">here</a></span>(<span class="st">"vignettes_data/example_analyses"</span>, <span class="no">filename_mono</span>))){
  <span class="no">samples_of_joints_mono</span> <span class="kw">&lt;-</span> <span class="fu">read_rds</span>(<span class="kw pkg">here</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/here/man/here.html">here</a></span>(<span class="st">"vignettes_data/example_analyses"</span>,
                                                <span class="no">filename_mono</span>))
} <span class="kw">else</span> {
<span class="no">samples_of_joints_mono</span> <span class="kw">&lt;-</span> <span class="no">bounds</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(!<span class="no">constraints_violated_mono</span>) <span class="kw">%&gt;%</span>
  <span class="fu">mutate</span>(<span class="kw">i</span> <span class="kw">=</span> <span class="fu">row_number</span>()) <span class="kw">%&gt;%</span>
  <span class="fu">rowwise</span>() <span class="kw">%&gt;%</span>
  <span class="fu">mutate</span>(<span class="kw">pot_covs</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="fu"><a href="../reference/potential_covs.html">potential_covs</a></span>(<span class="kw">thetas</span> <span class="kw">=</span> <span class="no">thetas</span>, <span class="kw">gammas</span> <span class="kw">=</span> <span class="no">gammas</span>, <span class="kw">x_mono</span> <span class="kw">=</span> <span class="fl">TRUE</span>)),
         <span class="kw">sample_joint</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="fu"><a href="../reference/sample_joint_probs.html">sample_joint_probs</a></span>(<span class="no">pot_covs</span>, <span class="kw">n</span> <span class="kw">=</span> <span class="fl">500</span>, <span class="kw">return_bounds</span> <span class="kw">=</span> <span class="fl">TRUE</span>,
                                                <span class="kw">x_mono</span> <span class="kw">=</span> <span class="fl">TRUE</span>, <span class="kw">print_progress</span> <span class="kw">=</span> <span class="fl">FALSE</span>,
                                                <span class="kw">print_as_progress</span> <span class="kw">=</span> <span class="kw">NULL</span>)))

  <span class="fu">write_rds</span>(<span class="no">samples_of_joints_mono</span>,
            <span class="kw pkg">here</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/here/man/here.html">here</a></span>(<span class="st">"vignettes_data/example_analyses"</span>,
                       <span class="no">filename_mono</span>))
}

<span class="no">trivariate_mono_bounds</span> <span class="kw">&lt;-</span> <span class="no">samples_of_joints_mono</span> <span class="kw">%&gt;%</span>
  <span class="fu">ungroup</span>() <span class="kw">%&gt;%</span>
  <span class="fu">select</span>(<span class="no">SNP</span>, <span class="kw">bivariate_lower</span> <span class="kw">=</span> <span class="no">lower_mono</span>, <span class="kw">bivariate_upper</span> <span class="kw">=</span> <span class="no">upper_mono</span>, <span class="no">sample_joint</span>) <span class="kw">%&gt;%</span>
  <span class="fu">unnest</span>(<span class="no">sample_joint</span>) <span class="kw">%&gt;%</span>
  <span class="fu">unnest</span>(<span class="no">joint</span>) <span class="kw">%&gt;%</span>
  <span class="fu">unnest_wider</span>(<span class="no">bounds</span>) <span class="kw">%&gt;%</span>
  <span class="fu">mutate</span>(<span class="kw">contains_zero</span> <span class="kw">=</span> <span class="no">lower</span> <span class="kw">&lt;</span> <span class="fl">0</span> <span class="kw">&amp;</span> <span class="no">upper</span> <span class="kw">&gt;</span> <span class="fl">0</span>)

<span class="no">individual_SNPs_mono_plot</span> <span class="kw">&lt;-</span> <span class="no">trivariate_mono_bounds</span> <span class="kw">%&gt;%</span>
  <span class="fu">group_by</span>(<span class="no">SNP</span>) <span class="kw">%&gt;%</span>
  <span class="fu">arrange</span>(<span class="no">lower</span>) <span class="kw">%&gt;%</span>
  <span class="fu">mutate</span>(<span class="kw">id</span> <span class="kw">=</span> <span class="fu">row_number</span>()) <span class="kw">%&gt;%</span>
  <span class="fu">ungroup</span>() <span class="kw">%&gt;%</span>
  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">id</span>)) +
    <span class="fu">geom_hline</span>(<span class="fu">aes</span>(<span class="kw">yintercept</span> <span class="kw">=</span> <span class="no">bivariate_lower</span>),
               <span class="kw">linetype</span> <span class="kw">=</span> <span class="st">"dashed"</span>) +
    <span class="fu">geom_hline</span>(<span class="fu">aes</span>(<span class="kw">yintercept</span> <span class="kw">=</span> <span class="no">bivariate_upper</span>),
               <span class="kw">linetype</span> <span class="kw">=</span> <span class="st">"dashed"</span>) +
    <span class="fu">geom_hline</span>(<span class="kw">yintercept</span> <span class="kw">=</span> <span class="fl">0</span>) +
    <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="kw">ymin</span> <span class="kw">=</span> <span class="no">lower</span>,
                      <span class="kw">ymax</span> <span class="kw">=</span> <span class="no">upper</span>,
                      <span class="kw">color</span> <span class="kw">=</span> <span class="no">contains_zero</span>)) +
    <span class="fu">facet_wrap</span>(~<span class="no">SNP</span>, <span class="kw">nrow</span> <span class="kw">=</span> <span class="fl">7</span>)

<span class="no">individual_SNPs_mono_plot</span></pre></body></html></div>
</div>
<div id="intersections-of-bounds-from-randomly-sampled-joint-distributions" class="section level2">
<h2 class="hasAnchor">
<a href="#intersections-of-bounds-from-randomly-sampled-joint-distributions" class="anchor"></a>Intersections of Bounds from Randomly Sampled Joint Distributions</h2>
<p>First, we create a tibble with all unique pairs of SNPs.</p>
<div class="sourceCode" id="cb36"><html><body><pre class="r"><span class="no">pairs_of_snps</span> <span class="kw">&lt;-</span> <span class="fu">expand_grid</span>(<span class="kw">SNP1</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span>(<span class="no">trivariate_bounds</span>$<span class="no">SNP</span>),
                             <span class="kw">SNP2</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span>(<span class="no">trivariate_bounds</span>$<span class="no">SNP</span>)) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(<span class="no">SNP1</span> <span class="kw">!=</span> <span class="no">SNP2</span>) <span class="kw">%&gt;%</span>
  <span class="fu">rowwise</span>() <span class="kw">%&gt;%</span>
  <span class="fu">summarize</span>(<span class="kw">SNPs</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/sort.html">sort</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="no">SNP1</span>, <span class="no">SNP2</span>)))) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/duplicated.html">duplicated</a></span>(<span class="no">SNPs</span>)) <span class="kw">%&gt;%</span>
  <span class="fu">mutate</span>(<span class="kw">SNPs</span> <span class="kw">=</span> <span class="fu">map</span>(<span class="no">SNPs</span>, ~<span class="fu">tibble_row</span>(<span class="kw">SNP1</span> <span class="kw">=</span> <span class="no">.x</span>[<span class="fl">1</span>], <span class="kw">SNP2</span> <span class="kw">=</span> <span class="no">.x</span>[<span class="fl">2</span>]))) <span class="kw">%&gt;%</span>
  <span class="fu">unnest_wider</span>(<span class="no">SNPs</span>)</pre></body></html></div>
<pre><code>## `summarise()` ungrouping output (override with `.groups` argument)</code></pre>
<div class="sourceCode" id="cb38"><html><body><pre class="r"><span class="no">pairs_of_snps</span></pre></body></html></div>
<pre><code>## # A tibble: 2,926 x 2
##    SNP1       SNP2      
##    &lt;chr&gt;      &lt;chr&gt;     
##  1 rs10173733 rs10193706
##  2 rs10173733 rs10233018
##  3 rs10193706 rs10233018
##  4 rs10173733 rs10274594
##  5 rs10193706 rs10274594
##  6 rs10233018 rs10274594
##  7 rs10173733 rs1029986 
##  8 rs10193706 rs1029986 
##  9 rs10233018 rs1029986 
## 10 rs10274594 rs1029986 
## # … with 2,916 more rows</code></pre>
<p>The resulting tibble has 2926 rows, which is exactly <span class="math inline">\({77 \choose 2}\)</span>.</p>
<p>It is not feasible (and probably not even useful…) to go through all pairs, so instead we will simply look at a random sample of 9 pairs.</p>
<div class="sourceCode" id="cb40"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span>(<span class="fl">493637</span>)

<span class="no">chosen_pairs</span> <span class="kw">&lt;-</span> <span class="no">pairs_of_snps</span> <span class="kw">%&gt;%</span>
  <span class="fu">sample_n</span>(<span class="fl">9</span>)

<span class="kw pkg">pander</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/pander/man/pander.html">pander</a></span>(<span class="no">chosen_pairs</span>)</pre></body></html></div>
<table class="table">
<colgroup>
<col width="18%">
<col width="18%">
</colgroup>
<thead><tr class="header">
<th align="center">SNP1</th>
<th align="center">SNP2</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">rs60745548</td>
<td align="center">rs772921</td>
</tr>
<tr class="even">
<td align="center">rs1899896</td>
<td align="center">rs6828849</td>
</tr>
<tr class="odd">
<td align="center">rs1561195</td>
<td align="center">rs1899896</td>
</tr>
<tr class="even">
<td align="center">rs11127913</td>
<td align="center">rs12886628</td>
</tr>
<tr class="odd">
<td align="center">rs13100688</td>
<td align="center">rs9381917</td>
</tr>
<tr class="even">
<td align="center">rs523528</td>
<td align="center">rs7948789</td>
</tr>
<tr class="odd">
<td align="center">rs12487411</td>
<td align="center">rs2675609</td>
</tr>
<tr class="even">
<td align="center">rs55921136</td>
<td align="center">rs772921</td>
</tr>
<tr class="odd">
<td align="center">rs10905461</td>
<td align="center">rs72678864</td>
</tr>
</tbody>
</table>
<p>We simply reuse the joint distributions and bounds found previously noting that this imposes the assumption that the distributions of <span class="math inline">\((X,Y|Z_1)\)</span> and <span class="math inline">\((X,Y|Z_2)\)</span> are independent of each other.</p>
<div class="sourceCode" id="cb41"><html><body><pre class="r"><span class="no">both_bounds</span> <span class="kw">&lt;-</span> <span class="no">chosen_pairs</span> <span class="kw">%&gt;%</span>
  <span class="fu">rowwise</span>() <span class="kw">%&gt;%</span>
  <span class="fu">mutate</span>(
    <span class="kw">SNP1_bounds</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(
      <span class="no">trivariate_bounds</span> <span class="kw">%&gt;%</span>
        <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(<span class="no">SNP</span> <span class="kw">==</span> <span class="no">SNP1</span>) <span class="kw">%&gt;%</span>
        <span class="fu">select</span>(<span class="kw">SNP1_bivariate_lower</span> <span class="kw">=</span> <span class="no">bivariate_lower</span>, <span class="kw">SNP1_bivariate_upper</span> <span class="kw">=</span> <span class="no">bivariate_upper</span>,
               <span class="kw">SNP1_lower</span> <span class="kw">=</span> <span class="no">lower</span>, <span class="kw">SNP1_upper</span> <span class="kw">=</span> <span class="no">upper</span>)
    ),
    <span class="kw">SNP2_bounds</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(
      <span class="no">trivariate_bounds</span> <span class="kw">%&gt;%</span>
        <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(<span class="no">SNP</span> <span class="kw">==</span> <span class="no">SNP2</span>) <span class="kw">%&gt;%</span>
        <span class="fu">select</span>(<span class="kw">SNP2_bivariate_lower</span> <span class="kw">=</span> <span class="no">bivariate_lower</span>, <span class="kw">SNP2_bivariate_upper</span> <span class="kw">=</span> <span class="no">bivariate_upper</span>,
               <span class="kw">SNP2_lower</span> <span class="kw">=</span> <span class="no">lower</span>, <span class="kw">SNP2_upper</span> <span class="kw">=</span> <span class="no">upper</span>)
    )
  ) <span class="kw">%&gt;%</span>
  <span class="fu">ungroup</span>() <span class="kw">%&gt;%</span>
  <span class="fu">unnest</span>(<span class="kw">cols</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="no">SNP1_bounds</span>, <span class="no">SNP2_bounds</span>))

<span class="no">both_bounds</span></pre></body></html></div>
<pre><code>## # A tibble: 4,500 x 10
##    SNP1  SNP2  SNP1_bivariate_… SNP1_bivariate_… SNP1_lower SNP1_upper
##    &lt;chr&gt; &lt;chr&gt;            &lt;dbl&gt;            &lt;dbl&gt;      &lt;dbl&gt;      &lt;dbl&gt;
##  1 rs60… rs77…           -0.561            0.473     -0.535      0.455
##  2 rs60… rs77…           -0.561            0.473     -0.534      0.454
##  3 rs60… rs77…           -0.561            0.473     -0.530      0.451
##  4 rs60… rs77…           -0.561            0.473     -0.534      0.446
##  5 rs60… rs77…           -0.561            0.473     -0.526      0.445
##  6 rs60… rs77…           -0.561            0.473     -0.532      0.445
##  7 rs60… rs77…           -0.561            0.473     -0.530      0.448
##  8 rs60… rs77…           -0.561            0.473     -0.533      0.445
##  9 rs60… rs77…           -0.561            0.473     -0.535      0.447
## 10 rs60… rs77…           -0.561            0.473     -0.538      0.440
## # … with 4,490 more rows, and 4 more variables: SNP2_bivariate_lower &lt;dbl&gt;,
## #   SNP2_bivariate_upper &lt;dbl&gt;, SNP2_lower &lt;dbl&gt;, SNP2_upper &lt;dbl&gt;</code></pre>
<p>Finally, we construct intersection bounds.</p>
<div class="sourceCode" id="cb43"><html><body><pre class="r"><span class="no">intersection_bounds</span> <span class="kw">&lt;-</span> <span class="no">both_bounds</span> <span class="kw">%&gt;%</span>
  <span class="fu">rowwise</span>() <span class="kw">%&gt;%</span>
  <span class="fu">mutate</span>(<span class="kw">intersection_lower</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span>(<span class="no">SNP1_lower</span>, <span class="no">SNP2_lower</span>),
         <span class="kw">intersection_upper</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span>(<span class="no">SNP1_upper</span>, <span class="no">SNP2_upper</span>),
         <span class="kw">bivariate_intersection_lower</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span>(<span class="no">SNP1_bivariate_lower</span>, <span class="no">SNP2_bivariate_lower</span>),
         <span class="kw">bivariate_intersection_upper</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span>(<span class="no">SNP1_bivariate_upper</span>, <span class="no">SNP2_bivariate_upper</span>),
         ) <span class="kw">%&gt;%</span>
  <span class="fu">ungroup</span>() <span class="kw">%&gt;%</span>
  <span class="fu">mutate</span>(<span class="kw">contains_zero</span> <span class="kw">=</span> <span class="no">intersection_lower</span> <span class="kw">&lt;</span> <span class="fl">0</span> <span class="kw">&amp;</span> <span class="no">intersection_upper</span> <span class="kw">&gt;</span> <span class="fl">0</span>)</pre></body></html></div>
<p>A plot to display them.</p>
<div class="sourceCode" id="cb44"><html><body><pre class="r"><span class="no">intersection_bounds_plot</span> <span class="kw">&lt;-</span> <span class="no">intersection_bounds</span> <span class="kw">%&gt;%</span>
  <span class="fu">group_by</span>(<span class="no">SNP1</span>, <span class="no">SNP2</span>) <span class="kw">%&gt;%</span>
  <span class="fu">arrange</span>(<span class="no">intersection_lower</span>) <span class="kw">%&gt;%</span>
  <span class="fu">mutate</span>(<span class="kw">i</span> <span class="kw">=</span> <span class="fu">row_number</span>()) <span class="kw">%&gt;%</span>
  <span class="fu">ungroup</span>() <span class="kw">%&gt;%</span>
  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">i</span>)) +
    <span class="fu">geom_hline</span>(<span class="fu">aes</span>(<span class="kw">yintercept</span> <span class="kw">=</span> <span class="no">bivariate_intersection_lower</span>),
               <span class="kw">linetype</span> <span class="kw">=</span> <span class="st">"dashed"</span>) +
    <span class="fu">geom_hline</span>(<span class="fu">aes</span>(<span class="kw">yintercept</span> <span class="kw">=</span> <span class="no">bivariate_intersection_upper</span>),
               <span class="kw">linetype</span> <span class="kw">=</span> <span class="st">"dashed"</span>) +
    <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="kw">ymin</span> <span class="kw">=</span> <span class="no">intersection_lower</span>,
                      <span class="kw">ymax</span> <span class="kw">=</span> <span class="no">intersection_upper</span>,
                      <span class="kw">color</span> <span class="kw">=</span> <span class="no">contains_zero</span>),
                  <span class="kw">alpha</span> <span class="kw">=</span> <span class="fl">0.7</span>) +
    <span class="fu">geom_hline</span>(<span class="kw">yintercept</span> <span class="kw">=</span> <span class="fl">0</span>) +
    <span class="fu">facet_wrap</span>(~<span class="no">SNP1</span> + <span class="no">SNP2</span>,
               <span class="kw">labeller</span> <span class="kw">=</span> <span class="no">label_both</span>) +
    <span class="fu">theme_bw</span>()

<span class="no">intersection_bounds_plot</span></pre></body></html></div>
<p><img src="example_analysis_2_files/figure-html/unnamed-chunk-22-1.png" width="960"></p>
</div>
<div id="save-plots" class="section level2">
<h2 class="hasAnchor">
<a href="#save-plots" class="anchor"></a>Save Plots</h2>
<p>Save plots for later use.</p>
<div class="sourceCode" id="cb45"><html><body><pre class="r"><span class="fu">ggsave</span>(
  <span class="kw">plot</span> <span class="kw">=</span> <span class="no">all_bivariate_bounds</span>,
  <span class="kw">filename</span> <span class="kw">=</span> <span class="kw pkg">here</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/here/man/here.html">here</a></span>(<span class="st">"figures/example_analyses"</span>,
                        <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="st">"all_bivaraite_bounds_"</span>, <span class="no">exposure_id</span>, <span class="st">"_"</span>, <span class="no">outcome_id</span>,<span class="st">".png"</span>))
)</pre></body></html></div>
<pre><code>## Saving 7.29 x 4.51 in image</code></pre>
<div class="sourceCode" id="cb47"><html><body><pre class="r"><span class="fu">ggsave</span>(
  <span class="kw">plot</span> <span class="kw">=</span> <span class="no">individual_SNPs_plot</span>,
  <span class="kw">filename</span> <span class="kw">=</span> <span class="kw pkg">here</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/here/man/here.html">here</a></span>(<span class="st">"figures/example_analyses"</span>,
                        <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="st">"individual_SNPs_plot"</span>, <span class="no">exposure_id</span>, <span class="st">"_"</span>, <span class="no">outcome_id</span>,<span class="st">".png"</span>)),
  <span class="kw">height</span> <span class="kw">=</span> <span class="fl">10</span>, <span class="kw">width</span> <span class="kw">=</span> <span class="fl">14</span>
)


<span class="kw">if</span>(<span class="no">run_mono</span>){
  <span class="fu">ggsave</span>(
    <span class="kw">plot</span> <span class="kw">=</span> <span class="no">individual_SNPs_mono_plot</span>,
    <span class="kw">filename</span> <span class="kw">=</span> <span class="kw pkg">here</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/here/man/here.html">here</a></span>(<span class="st">"figures/example_analyses"</span>,
                          <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="st">"individual_SNPs_mono_plot.png"</span>, <span class="no">exposure_id</span>, <span class="st">"_"</span>, <span class="no">outcome_id</span>,<span class="st">".png"</span>)),
    <span class="kw">height</span> <span class="kw">=</span> <span class="fl">10</span>, <span class="kw">width</span> <span class="kw">=</span> <span class="fl">14</span>
  )
}
<span class="fu">ggsave</span>(
  <span class="kw">plot</span> <span class="kw">=</span> <span class="no">intersection_bounds_plot</span>,
  <span class="kw">filename</span> <span class="kw">=</span> <span class="kw pkg">here</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/here/man/here.html">here</a></span>(<span class="st">"figures/example_analyses"</span>,
                        <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="st">"intersection_bounds_plot.png"</span>, <span class="no">exposure_id</span>, <span class="st">"_"</span>, <span class="no">outcome_id</span>,<span class="st">".png"</span>)),
  <span class="kw">height</span> <span class="kw">=</span> <span class="fl">14</span>, <span class="kw">width</span> <span class="kw">=</span> <span class="fl">10</span>
)</pre></body></html></div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Ralph Møller Trane.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
