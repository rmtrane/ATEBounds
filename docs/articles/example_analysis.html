<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Example Analysis of Data from the IEU GWAS Database • Bounds in Two-Sample Mendelian Randomization With Summary Statistics</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Example Analysis of Data from the IEU GWAS Database">
<meta property="og:description" content="Step-by-step example of a MR analysis using the methods discussed in our paper on data obtained from the IEU GWAS Database.
">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">Bounds in Two-Sample Mendelian Randomization With Summary Statistics</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/ATEBounds.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li class="divider">
    <li class="dropdown-header">Exploration of Bounds</li>
    <li>
      <a href="../articles/bounds_from_bivariate.html">Bounds using Two-Sample Data</a>
    </li>
    <li>
      <a href="../articles/bounds_from_trivariate.html">Utilize two-sample data two get potential one-sample bounds</a>
    </li>
    <li class="divider">
    <li class="dropdown-header">"Power" analysis</li>
    <li>
      <a href="../articles/power_sims.html">"Power" Simulations</a>
    </li>
    <li>
      <a href="../articles/power_sims_figures.html">"Power" Figures</a>
    </li>
    <li class="divider">
    <li class="dropdown-header">Two-Sample Bounds using Multiple Instruments</li>
    <li>
      <a href="../articles/multiple_IVs_sims.html">Multiple IVs: Simulations</a>
    </li>
    <li>
      <a href="../articles/multiple_IVs_figures.html">Multiple IVs: Figures</a>
    </li>
    <li class="divider">
    <li class="dropdown-header">Example Analysis using `TwoSampleMR`</li>
    <li>
      <a href="../articles/example_analysis.html">Example Analysis of Data from the IEU GWAS Database</a>
    </li>
    <li class="divider">
    <li class="dropdown-header">Other</li>
    <li>
      <a href="../articles/polymake_example.html">Polymake Example</a>
    </li>
    <li>
      <a href="../articles/get_bounds.html">How to use the `get_bounds` function</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/rmtrane/ATEBounds/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="example_analysis_files/header-attrs-2.6/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Example Analysis of Data from the IEU GWAS Database</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/rmtrane/ATEBounds/blob/master/vignettes/example_analysis.Rmd"><code>vignettes/example_analysis.Rmd</code></a></small>
      <div class="hidden name"><code>example_analysis.Rmd</code></div>

    </div>

    
    
<p>Here, we will demonstrate how to use bivariate data sources (in particular, the MR-Base database) to bound the average treatment effect, and gain insights into what such bounds would look like if a trivariate data set was available.</p>
<div id="effect-of-smoking-on-lung-cancer" class="section level1">
<h1 class="hasAnchor">
<a href="#effect-of-smoking-on-lung-cancer" class="anchor"></a>Effect of Smoking on Lung Cancer</h1>
<p>Our first example will use smoking as exposure, and lung cancer as outcome (both as binary).</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">TwoSampleMR</span><span class="op">)</span></code></pre></div>
<pre><code>## TwoSampleMR version 0.5.5 
## [&gt;] New: Option to use non-European LD reference panels for clumping etc
## [&gt;] Some studies temporarily quarantined to verify effect allele
## [&gt;] See news(package='TwoSampleMR') and https://gwas.mrcieu.ac.uk for further details</code></pre>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span></code></pre></div>
<pre><code>## ── Attaching packages ─────────────────────────────────────── tidyverse 1.3.0 ──</code></pre>
<pre><code>## ✓ ggplot2 3.3.3     ✓ purrr   0.3.4
## ✓ tibble  3.0.6     ✓ dplyr   1.0.3
## ✓ tidyr   1.1.2     ✓ stringr 1.4.0
## ✓ readr   1.4.0     ✓ forcats 0.5.1</code></pre>
<pre><code>## ── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
## x dplyr::filter() masks stats::filter()
## x dplyr::lag()    masks stats::lag()</code></pre>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://magrittr.tidyverse.org">magrittr</a></span><span class="op">)</span></code></pre></div>
<pre><code>## 
## Attaching package: 'magrittr'</code></pre>
<pre><code>## The following object is masked from 'package:purrr':
## 
##     set_names</code></pre>
<pre><code>## The following object is masked from 'package:tidyr':
## 
##     extract</code></pre>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/rmtrane/ATEBounds">ATEBounds</a></span><span class="op">)</span>


<span class="fu">theme_set</span><span class="op">(</span><span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div id="collect-data" class="section level2">
<h2 class="hasAnchor">
<a href="#collect-data" class="anchor"></a>Collect Data</h2>
<p>Using the <code>TwoSampleMR</code> package, we get the data from the online database. First, we get a <code>tibble</code> with all available outcomes.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ao</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/TwoSampleMR/man/available_outcomes.html">available_outcomes</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code>## API: public: http://gwas-api.mrcieu.ac.uk/</code></pre>
<p>From this, we identify an experiment. We save information about the experiment to the <code>smoking_experiment</code> object.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">smoking_experiment</span> <span class="op">&lt;-</span> <span class="va">ao</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">id</span> <span class="op">==</span> <span class="st">"ukb-d-20116_0"</span><span class="op">)</span></code></pre></div>
<p>Next, we obtain potential instruments for the exposure variable.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">smoking_instruments</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/TwoSampleMR/man/extract_instruments.html">extract_instruments</a></span><span class="op">(</span><span class="va">smoking_experiment</span><span class="op">$</span><span class="va">id</span><span class="op">)</span></code></pre></div>
<p>Similarly, we obtain outcome data: identify an appropriate study with data on lung cancer, and create an object with the information available about that study. We call this object <code>lung_cancer_experiment</code>.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">lung_cancer_experiment</span> <span class="op">&lt;-</span> <span class="va">ao</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">id</span> <span class="op">==</span> <span class="st">"ukb-d-40001_C349"</span><span class="op">)</span>
<span class="va">lung_cancer_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/TwoSampleMR/man/extract_outcome_data.html">extract_outcome_data</a></span><span class="op">(</span>snps <span class="op">=</span> <span class="va">smoking_instruments</span><span class="op">$</span><span class="va">SNP</span>, outcomes <span class="op">=</span> <span class="va">lung_cancer_experiment</span><span class="op">$</span><span class="va">id</span><span class="op">)</span></code></pre></div>
<pre><code>## Extracting data for 84 SNP(s) from 1 GWAS(s)</code></pre>
<p>Finally, we extract data from the study.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">smoking_lung_cancer_harmonized</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/TwoSampleMR/man/harmonise_data.html">harmonise_data</a></span><span class="op">(</span><span class="va">smoking_instruments</span>, <span class="va">lung_cancer_data</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html">as_tibble</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code>## Harmonising Smoking status: Never || id:ukb-d-20116_0 (ukb-d-20116_0) and Underlying (primary) cause of death: ICD10: C34.9 Bronchus or lung, unspecified || id:ukb-d-40001_C349 (ukb-d-40001_C349)</code></pre>
<pre><code>## Removing the following SNPs for being palindromic with intermediate allele frequencies:
## rs11693702, rs1492546, rs2240294, rs264974, rs568599</code></pre>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">smoking_lung_cancer_pop_probs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span>regression <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"outcome"</span>, <span class="st">"exposure"</span><span class="op">)</span>,
                                       p_outcome <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">lung_cancer_experiment</span>  <span class="op">%$%</span> <span class="op">{</span> <span class="va">ncase</span> <span class="op">/</span> <span class="op">(</span><span class="va">ncase</span> <span class="op">+</span> <span class="va">ncontrol</span><span class="op">)</span> <span class="op">}</span>,
                                                     <span class="va">smoking_experiment</span> <span class="op">%$%</span> <span class="op">{</span> <span class="va">ncase</span> <span class="op">/</span> <span class="op">(</span><span class="va">ncase</span> <span class="op">+</span> <span class="va">ncontrol</span><span class="op">)</span> <span class="op">}</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>The following helper function takes finds the intercept in logistic regression that ensures the marginal probabilities <span class="math inline">\(P(Y = 1)\)</span> and <span class="math inline">\(P(X = 1)\)</span> match what’s observed given the marginal distributions of the dependendt (i.e. either smoking or lung cancer) and the IV (SNPs).</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">find_intercept</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">beta1</span>, <span class="va">p_outcome</span>, <span class="va">pz</span>, <span class="va">interval</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">5</span>, <span class="fl">5</span><span class="op">)</span>, <span class="va">zs</span> <span class="op">=</span> <span class="fl">0</span><span class="op">:</span><span class="fl">2</span><span class="op">)</span><span class="op">{</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/uniroot.html">uniroot</a></span><span class="op">(</span>f <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">beta0</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="op">(</span><span class="fl">1</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="op">-</span><span class="va">beta0</span><span class="op">-</span><span class="va">beta1</span><span class="op">*</span><span class="va">zs</span><span class="op">)</span><span class="op">)</span><span class="op">^</span><span class="op">(</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span> <span class="op">*</span> <span class="va">pz</span><span class="op">)</span> <span class="op">-</span> <span class="va">p_outcome</span>,
          interval <span class="op">=</span> <span class="va">interval</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<p>We have <span class="math inline">\(P(X = 1)\)</span> and <span class="math inline">\(P(Y = 1)\)</span>. We still need <span class="math inline">\(P(Z = z)\)</span>. These can be found from the allele frequencies. Since we have data on <span class="math inline">\(Z\)</span> from two separate sources, and the allele frequencies vary ever so slightly between the two, we use a weighted average of the allele frequencies as our final estimates. With these estimated allele frequencies, we can find <span class="math inline">\(P(Z = z)\)</span>.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">smoking_lung_cancer_prep_for_bounds</span> <span class="op">&lt;-</span> <span class="va">smoking_lung_cancer_harmonized</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rowwise.html">rowwise</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>samplesize.exposure <span class="op">=</span> <span class="va">smoking_experiment</span><span class="op">$</span><span class="va">ncase</span> <span class="op">+</span> <span class="va">smoking_experiment</span><span class="op">$</span><span class="va">ncontrol</span>,
         samplesize.outcome <span class="op">=</span> <span class="va">lung_cancer_experiment</span><span class="op">$</span><span class="va">ncase</span> <span class="op">+</span> <span class="va">lung_cancer_experiment</span><span class="op">$</span><span class="va">ncontrol</span>,
         ave_eaf <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/weighted.mean.html">weighted.mean</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/c_across.html">c_across</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">eaf.exposure</span>, <span class="va">eaf.outcome</span><span class="op">)</span><span class="op">)</span>,
                                 w <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/c_across.html">c_across</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">samplesize.exposure</span>, <span class="va">samplesize.outcome</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">SNP</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">contains</a></span><span class="op">(</span><span class="st">"beta"</span><span class="op">)</span>, <span class="va">ave_eaf</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">pivot_longer</span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">contains</a></span><span class="op">(</span><span class="st">"beta"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">separate</span><span class="op">(</span><span class="va">name</span>, into <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"variable"</span>, <span class="st">"regression"</span><span class="op">)</span>, sep <span class="op">=</span> <span class="st">"\\."</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">pivot_wider</span><span class="op">(</span>names_from <span class="op">=</span> <span class="va">variable</span>, values_from <span class="op">=</span> <span class="va">value</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>`P(Z = 2)` <span class="op">=</span> <span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">ave_eaf</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span>,
         `P(Z = 1)` <span class="op">=</span> <span class="fl">2</span><span class="op">*</span><span class="va">ave_eaf</span><span class="op">*</span><span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">ave_eaf</span><span class="op">)</span>,
         `P(Z = 0)` <span class="op">=</span> <span class="va">ave_eaf</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span></code></pre></div>
<p>We add the values of <span class="math inline">\(P(X = 1)\)</span> and <span class="math inline">\(P(Y = 1)\)</span> to the tibble, and can now use the helper function defined above to find the intercepts that matches with the marginals.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">smoking_lung_cancer_w_intercept</span> <span class="op">&lt;-</span> <span class="va">smoking_lung_cancer_prep_for_bounds</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">smoking_lung_cancer_pop_probs</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rowwise.html">rowwise</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>find_intercept <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="fu">find_intercept</span><span class="op">(</span>beta1 <span class="op">=</span> <span class="va">beta</span>,
                                              p_outcome <span class="op">=</span> <span class="va">p_outcome</span>,
                                              pz <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">`P(Z = 0)`</span>, <span class="va">`P(Z = 1)`</span>, <span class="va">`P(Z = 2)`</span><span class="op">)</span>,
                                              interval <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">7</span>,<span class="fl">7</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,
         beta0 <span class="op">=</span> <span class="va">find_intercept</span><span class="op">$</span><span class="va">root</span>,
         `thetas/gammas` <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="op">(</span><span class="fl">1</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="op">-</span><span class="va">beta0</span> <span class="op">-</span> <span class="fl">0</span><span class="op">:</span><span class="fl">2</span><span class="op">*</span><span class="va">beta</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## Joining, by = "regression"</code></pre>
</div>
<div id="summaries-of-marginal-distributions" class="section level2">
<h2 class="hasAnchor">
<a href="#summaries-of-marginal-distributions" class="anchor"></a>Summaries of Marginal Distributions</h2>
<p>We get the summary statistics, save them to a file for later, and create a few figures.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">summaries_for_plots</span> <span class="op">&lt;-</span> <span class="va">smoking_lung_cancer_w_intercept</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">SNP</span>, <span class="va">regression</span>, <span class="va">beta</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">starts_with</a></span><span class="op">(</span><span class="st">"P(Z ="</span><span class="op">)</span>, <span class="va">p_outcome</span>, <span class="va">beta0</span>, <span class="va">`thetas/gammas`</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>`thetas/gammas` <span class="op">=</span> <span class="fu">map</span><span class="op">(</span><span class="va">`thetas/gammas`</span>, <span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/stats/setNames.html">setNames</a></span><span class="op">(</span><span class="va">.x</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"xy_given_z0"</span>, <span class="st">"xy_given_z1"</span>, <span class="st">"xy_given_z2"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">unnest_wider</span><span class="op">(</span><span class="va">`thetas/gammas`</span><span class="op">)</span>

<span class="fu">write_csv</span><span class="op">(</span>
  <span class="va">summaries_for_plots</span>,
  <span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="st">"vignettes_data/summary_stats_smoking_on_lung_cancer.csv"</span><span class="op">)</span>
<span class="op">)</span></code></pre></div>
<p>First, a histogram of the marginal distributions of the SNPs.</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="op">(</span><span class="va">marginal_Z</span> <span class="op">&lt;-</span> <span class="va">summaries_for_plots</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">regression</span> <span class="op">==</span> <span class="st">"exposure"</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">pivot_longer</span><span class="op">(</span>cols <span class="op">=</span> <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">starts_with</a></span><span class="op">(</span><span class="st">"P(Z ="</span><span class="op">)</span>,
               names_to <span class="op">=</span> <span class="st">"z"</span>, values_to <span class="op">=</span> <span class="st">"p"</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">p</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">geom_histogram</span><span class="op">(</span>boundary <span class="op">=</span> <span class="fl">0</span>, binwidth <span class="op">=</span> <span class="fl">0.05</span>, 
                   color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">facet_grid</span><span class="op">(</span><span class="op">~</span> <span class="va">z</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://rdrr.io/r/graphics/plot.window.html">xlim</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
    <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="example_analysis_files/figure-html/unnamed-chunk-12-1.png" width="700"></p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">ggsave</span><span class="op">(</span>
  plot <span class="op">=</span> <span class="va">marginal_Z</span>,
  filename <span class="op">=</span> <span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="st">"figures"</span>, 
                        <span class="st">"tiff/example_analyses"</span>,
                        <span class="st">"smoking_lung_cancer_marginal_Z.tiff"</span><span class="op">)</span>,
  dpi <span class="op">=</span> <span class="fl">300</span>, width <span class="op">=</span> <span class="fl">6.5</span>, height <span class="op">=</span> <span class="fl">2</span>
<span class="op">)</span>


<span class="fu">ggsave</span><span class="op">(</span>
  plot <span class="op">=</span> <span class="va">marginal_Z</span>,
  filename <span class="op">=</span> <span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="st">"figures"</span>, 
                        <span class="st">"png/example_analyses"</span>,
                        <span class="st">"smoking_lung_cancer_marginal_Z.png"</span><span class="op">)</span>,
  dpi <span class="op">=</span> <span class="fl">300</span>, width <span class="op">=</span> <span class="fl">6.5</span>, height <span class="op">=</span> <span class="fl">2</span>
<span class="op">)</span></code></pre></div>
<p>Next, coefficients. Here, we see histograms of the values of <span class="math inline">\(\beta_0\)</span> (intercepts inferred) and <span class="math inline">\(\beta_1\)</span> (coefficients reported) for both logistic regressions of SNPs on exposure and outcome. We notice a gap around <span class="math inline">\(0\)</span> for <span class="math inline">\(\beta_1\)</span> in the logistic regression of the SNPs on the exposure. This is as expected, since we only want SNPs that are associated with the exposure, which means we restrict ourselves to SNPs with coefficients significantly different from <span class="math inline">\(0\)</span>.</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="op">(</span><span class="va">lung_cancer_coefficients</span> <span class="op">&lt;-</span> <span class="va">summaries_for_plots</span> <span class="op">%&gt;%</span> 
  <span class="fu">pivot_longer</span><span class="op">(</span>cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">beta</span>, <span class="va">beta0</span><span class="op">)</span>,
               names_to <span class="op">=</span> <span class="st">"coef"</span>, values_to <span class="op">=</span> <span class="st">"value"</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>real_coefs <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when</a></span><span class="op">(</span><span class="va">coef</span> <span class="op">==</span> <span class="st">"beta"</span> <span class="op">&amp;</span> <span class="va">regression</span> <span class="op">==</span> <span class="st">"exposure"</span> <span class="op">~</span> <span class="st">"beta[1]"</span>, 
                                <span class="va">coef</span> <span class="op">==</span> <span class="st">"beta0"</span> <span class="op">&amp;</span> <span class="va">regression</span> <span class="op">==</span> <span class="st">"exposure"</span> <span class="op">~</span> <span class="st">"beta[0]"</span>,
                                <span class="va">coef</span> <span class="op">==</span> <span class="st">"beta"</span> <span class="op">&amp;</span> <span class="va">regression</span> <span class="op">==</span> <span class="st">"outcome"</span> <span class="op">~</span> <span class="st">"gamma[1]"</span>, 
                                <span class="va">coef</span> <span class="op">==</span> <span class="st">"beta0"</span> <span class="op">&amp;</span> <span class="va">regression</span> <span class="op">==</span> <span class="st">"outcome"</span> <span class="op">~</span> <span class="st">"gamma[0]"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">geom_histogram</span><span class="op">(</span>boundary <span class="op">=</span> <span class="fl">0</span>, binwidth <span class="op">=</span> <span class="fl">0.001</span>, 
                   color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">facet_wrap</span><span class="op">(</span><span class="op">~</span> <span class="va">real_coefs</span>,
               scales <span class="op">=</span> <span class="st">"free"</span>,
               labeller <span class="op">=</span> <span class="va">label_parsed</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="example_analysis_files/figure-html/unnamed-chunk-13-1.png" width="700"></p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">ggsave</span><span class="op">(</span>
  plot <span class="op">=</span> <span class="va">lung_cancer_coefficients</span>,
  filename <span class="op">=</span> <span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="st">"figures"</span>, 
                        <span class="st">"tiff/example_analyses"</span>,
                        <span class="st">"smoking_lung_cancer_coefficients.tiff"</span><span class="op">)</span>,
  dpi <span class="op">=</span> <span class="fl">300</span>, width <span class="op">=</span> <span class="fl">5</span>, height <span class="op">=</span> <span class="fl">3</span>
<span class="op">)</span>

<span class="fu">ggsave</span><span class="op">(</span>
  plot <span class="op">=</span> <span class="va">lung_cancer_coefficients</span>,
  filename <span class="op">=</span> <span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="st">"figures"</span>, 
                        <span class="st">"png/example_analyses"</span>,
                        <span class="st">"smoking_lung_cancer_coefficients.png"</span><span class="op">)</span>,
  dpi <span class="op">=</span> <span class="fl">300</span>, width <span class="op">=</span> <span class="fl">5</span>, height <span class="op">=</span> <span class="fl">3</span>
<span class="op">)</span></code></pre></div>
<p>Finally, we have the marginal conditionals <span class="math inline">\(P(X = 1 | Z = z), z = 0,1,2\)</span> and <span class="math inline">\(P(Y = 1 | Z = z), z = 0,1,2\)</span>. We notice that the location of the histograms are about the same for the three levels of <span class="math inline">\(Z\)</span>, which is the reason for all the SNPs being very weak instruments.</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="op">(</span><span class="va">marginal_conditionals</span> <span class="op">&lt;-</span> <span class="va">summaries_for_plots</span> <span class="op">%&gt;%</span> 
  <span class="fu">pivot_longer</span><span class="op">(</span>cols <span class="op">=</span> <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">starts_with</a></span><span class="op">(</span><span class="st">"xy_given_z"</span><span class="op">)</span>,
               names_to <span class="op">=</span> <span class="st">"vars"</span>, values_to <span class="op">=</span> <span class="st">"p"</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>regression <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html">if_else</a></span><span class="op">(</span><span class="va">regression</span> <span class="op">==</span> <span class="st">"exposure"</span>,
                              <span class="st">"P(X = 1 | Z = z)"</span>, <span class="st">"P(Y = 1 | Z = z)"</span><span class="op">)</span>,
         vars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"z ="</span>, <span class="fu">str_extract</span><span class="op">(</span><span class="va">vars</span>, <span class="st">"[0-2]"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">p</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
    <span class="fu">geom_histogram</span><span class="op">(</span>bins <span class="op">=</span> <span class="fl">20</span>, boundary <span class="op">=</span> <span class="fl">0.2</span>, 
                   color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span> <span class="op">+</span> 
    <span class="fu">facet_grid</span><span class="op">(</span><span class="va">vars</span> <span class="op">~</span> <span class="va">regression</span>,
               scales <span class="op">=</span> <span class="st">"free"</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="example_analysis_files/figure-html/unnamed-chunk-14-1.png" width="700"></p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">ggsave</span><span class="op">(</span>
  plot <span class="op">=</span> <span class="va">marginal_conditionals</span>,
  filename <span class="op">=</span> <span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="st">"figures"</span>,
                        <span class="st">"tiff/example_analyses"</span>,
                        <span class="st">"smoking_lung_cancer_marginal_conditionals.tiff"</span><span class="op">)</span>,
  dpi <span class="op">=</span> <span class="fl">300</span>, width <span class="op">=</span> <span class="fl">5</span>, height <span class="op">=</span> <span class="fl">3</span>
<span class="op">)</span>
<span class="fu">ggsave</span><span class="op">(</span>
  plot <span class="op">=</span> <span class="va">marginal_conditionals</span>,
  filename <span class="op">=</span> <span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="st">"figures"</span>,
                        <span class="st">"png/example_analyses"</span>,
                        <span class="st">"smoking_lung_cancer_marginal_conditionals.png"</span><span class="op">)</span>,
  dpi <span class="op">=</span> <span class="fl">300</span>, width <span class="op">=</span> <span class="fl">5</span>, height <span class="op">=</span> <span class="fl">3</span>
<span class="op">)</span></code></pre></div>
</div>
<div id="bound-ate-using-the-bivariate-data" class="section level2">
<h2 class="hasAnchor">
<a href="#bound-ate-using-the-bivariate-data" class="anchor"></a>Bound ATE using the bivariate data</h2>
<p>Now, we calculate the bounds (both with and without assuming monotonicity of <span class="math inline">\(P(X = 1 | Z = z)\)</span>) using the <code><a href="../reference/get_bounds.html">get_bounds()</a></code> function.</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">smoking_lung_cancer_bounds</span> <span class="op">&lt;-</span> <span class="va">smoking_lung_cancer_w_intercept</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">find_intercept</span>, <span class="op">-</span><span class="va">beta0</span>, <span class="op">-</span><span class="va">beta</span>, <span class="op">-</span><span class="va">p_outcome</span>, <span class="op">-</span><span class="va">ave_eaf</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>regression <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html">if_else</a></span><span class="op">(</span><span class="va">regression</span> <span class="op">==</span> <span class="st">"outcome"</span>, <span class="st">"gammas"</span>, <span class="st">"thetas"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">pivot_wider</span><span class="op">(</span>names_from <span class="op">=</span> <span class="va">regression</span>, values_from <span class="op">=</span> <span class="va">`thetas/gammas`</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rowwise.html">rowwise</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>bivariate_bounds <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="fu"><a href="../reference/get_bounds.html">get_bounds</a></span><span class="op">(</span>thetas <span class="op">=</span> <span class="va">thetas</span>, gammas <span class="op">=</span> <span class="va">gammas</span>, 
                                            stop <span class="op">=</span> <span class="cn">FALSE</span>, warning <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span>,
         interval <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">bivariate_bounds</span><span class="op">$</span><span class="va">interval</span><span class="op">)</span>,
         constraints_violated <span class="op">=</span> <span class="va">bivariate_bounds</span><span class="op">$</span><span class="va">constraints_violated</span>, 
         bivariate_bounds_mono <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="fu"><a href="../reference/get_bounds.html">get_bounds</a></span><span class="op">(</span>thetas <span class="op">=</span> <span class="va">thetas</span>, gammas <span class="op">=</span> <span class="va">gammas</span>, 
                                                 stop <span class="op">=</span> <span class="cn">FALSE</span>, warning <span class="op">=</span> <span class="cn">FALSE</span>,
                                                 x_mono <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span>,
         interval_mono <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">bivariate_bounds_mono</span><span class="op">$</span><span class="va">interval</span><span class="op">)</span>,
         constraints_violated_mono <span class="op">=</span> <span class="va">bivariate_bounds_mono</span><span class="op">$</span><span class="va">constraints_violated</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">unnest_wider</span><span class="op">(</span>col <span class="op">=</span> <span class="va">interval_mono</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span><span class="op">(</span>upper_mono <span class="op">=</span> <span class="va">upper</span>, lower_mono <span class="op">=</span> <span class="va">lower</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">unnest_wider</span><span class="op">(</span><span class="va">interval</span><span class="op">)</span></code></pre></div>
<p>The bivariate bounds obtained from the 84 SNPs are shown on the following plot. As can be seen, none of the bounds provide much information at all, and all intervals are rather wide.</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">smoking_lung_cancer_bivariate_bounds</span> <span class="op">&lt;-</span> <span class="va">smoking_lung_cancer_bounds</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="va">lower</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>y <span class="op">=</span> <span class="va">SNP</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">geom_errorbar</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>xmax <span class="op">=</span> <span class="va">upper</span>, xmin <span class="op">=</span> <span class="va">lower</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">facet_wrap</span><span class="op">(</span><span class="op">~</span> <span class="va">lower</span> <span class="op">&lt;</span> <span class="fu"><a href="https://rdrr.io/r/stats/median.html">median</a></span><span class="op">(</span><span class="va">lower</span><span class="op">)</span>,
               ncol <span class="op">=</span> <span class="fl">2</span>, scales <span class="op">=</span> <span class="st">"free_y"</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">theme</span><span class="op">(</span>strip.text <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,
          strip.background <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
    <span class="fu">labs</span><span class="op">(</span>
      y <span class="op">=</span> <span class="st">""</span>,
      x <span class="op">=</span> <span class="st">"ATE"</span>
    <span class="op">)</span> <span class="op">+</span>
    <span class="fu">lims</span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span>

<span class="va">smoking_lung_cancer_bivariate_bounds</span> <span class="op">+</span>
      <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Bivariate bounds"</span>,
         subtitle <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"Exposure: Smoking (id: "</span>, <span class="va">smoking_experiment</span><span class="op">$</span><span class="va">id</span>, <span class="st">"). "</span>,
                           <span class="st">"Outcome: Lung Cancer (id: "</span>, <span class="va">lung_cancer_experiment</span><span class="op">$</span><span class="va">id</span>, <span class="st">")."</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="example_analysis_files/figure-html/unnamed-chunk-16-1.png" width="700"></p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">ggsave</span><span class="op">(</span>
  plot <span class="op">=</span> <span class="va">smoking_lung_cancer_bivariate_bounds</span>,
  filename <span class="op">=</span> <span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="st">"figures/tiff/example_analyses"</span>, 
                        <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"smoking_lung_cancer_bivariate_bounds_"</span>, <span class="va">smoking_experiment</span><span class="op">$</span><span class="va">id</span>, <span class="st">"_"</span>, <span class="va">lung_cancer_experiment</span><span class="op">$</span><span class="va">id</span>,<span class="st">".tiff"</span><span class="op">)</span><span class="op">)</span>,
  width <span class="op">=</span> <span class="fl">8</span>, height <span class="op">=</span> <span class="fl">10</span>, dpi <span class="op">=</span> <span class="fl">300</span>
<span class="op">)</span>
<span class="fu">ggsave</span><span class="op">(</span>
  plot <span class="op">=</span> <span class="va">smoking_lung_cancer_bivariate_bounds</span>,
  filename <span class="op">=</span> <span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="st">"figures/png/example_analyses"</span>, 
                        <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"smoking_lung_cancer_bivariate_bounds_"</span>, <span class="va">smoking_experiment</span><span class="op">$</span><span class="va">id</span>, <span class="st">"_"</span>, <span class="va">lung_cancer_experiment</span><span class="op">$</span><span class="va">id</span>,<span class="st">".png"</span><span class="op">)</span><span class="op">)</span>,
  width <span class="op">=</span> <span class="fl">8</span>, height <span class="op">=</span> <span class="fl">10</span>, dpi <span class="op">=</span> <span class="fl">300</span>
<span class="op">)</span></code></pre></div>
<p>We save a figure with just a subset of the bounds to be included in the main manuscript.</p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">smoking_SNP_subset</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">smoking_lung_cancer_bounds</span><span class="op">$</span><span class="va">SNP</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">5</span>, <span class="fl">17</span>, <span class="fl">25</span>, <span class="fl">34</span>, <span class="fl">52</span>, <span class="fl">65</span>, <span class="fl">78</span><span class="op">)</span><span class="op">]</span>

<span class="va">smoking_lung_cancer_bivariate_bounds_subset</span> <span class="op">&lt;-</span> <span class="va">smoking_lung_cancer_bounds</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">SNP</span> <span class="op">%in%</span> <span class="va">smoking_SNP_subset</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="va">lower</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>y <span class="op">=</span> <span class="va">SNP</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">geom_errorbar</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>xmax <span class="op">=</span> <span class="va">upper</span>, xmin <span class="op">=</span> <span class="va">lower</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">theme</span><span class="op">(</span>strip.text <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,
          strip.background <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
    <span class="fu">labs</span><span class="op">(</span>
      y <span class="op">=</span> <span class="st">""</span>,
      x <span class="op">=</span> <span class="st">"ATE"</span>
    <span class="op">)</span> <span class="op">+</span>
    <span class="fu">lims</span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span>

<span class="fu">ggsave</span><span class="op">(</span>
  plot <span class="op">=</span> <span class="va">smoking_lung_cancer_bivariate_bounds_subset</span>,
  filename <span class="op">=</span> <span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="st">"figures/tiff/example_analyses"</span>, 
                        <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"smoking_lung_cancer_bivariate_bounds_subset_"</span>, <span class="va">smoking_experiment</span><span class="op">$</span><span class="va">id</span>, <span class="st">"_"</span>, <span class="va">lung_cancer_experiment</span><span class="op">$</span><span class="va">id</span>,<span class="st">".tiff"</span><span class="op">)</span><span class="op">)</span>,
  width <span class="op">=</span> <span class="fl">4</span>, height <span class="op">=</span> <span class="fl">4</span>, dpi <span class="op">=</span> <span class="fl">300</span>
<span class="op">)</span>

<span class="fu">ggsave</span><span class="op">(</span>
  plot <span class="op">=</span> <span class="va">smoking_lung_cancer_bivariate_bounds_subset</span>,
  filename <span class="op">=</span> <span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="st">"figures/png/example_analyses"</span>, 
                        <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"smoking_lung_cancer_bivariate_bounds_subset_"</span>, <span class="va">smoking_experiment</span><span class="op">$</span><span class="va">id</span>, <span class="st">"_"</span>, <span class="va">lung_cancer_experiment</span><span class="op">$</span><span class="va">id</span>,<span class="st">".png"</span><span class="op">)</span><span class="op">)</span>,
  width <span class="op">=</span> <span class="fl">4</span>, height <span class="op">=</span> <span class="fl">4</span>, dpi <span class="op">=</span> <span class="fl">300</span>
<span class="op">)</span></code></pre></div>
<p>That all the bounds are rather wide is no surprise – all the IVs are rather weak, as can be seen on the histogram of the strengths below.</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">strength_histogram</span> <span class="op">&lt;-</span> <span class="va">smoking_lung_cancer_bounds</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rowwise.html">rowwise</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>strength <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/outer.html">outer</a></span><span class="op">(</span><span class="va">thetas</span>, <span class="va">thetas</span>, <span class="va">`-`</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">strength</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
    <span class="fu">geom_histogram</span><span class="op">(</span>color <span class="op">=</span> <span class="st">"black"</span>, binwidth <span class="op">=</span> <span class="fl">0.001</span>, boundary <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">+</span> 
    <span class="fu">scale_x_continuous</span><span class="op">(</span>limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.012</span><span class="op">)</span>, 
                       breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.012</span>, by <span class="op">=</span> <span class="fl">0.002</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Strength"</span>, y <span class="op">=</span> <span class="st">"Count"</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span>

<span class="va">strength_histogram</span> <span class="op">+</span>
  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Strength of IVs on Smoking"</span><span class="op">)</span></code></pre></div>
<p><img src="example_analysis_files/figure-html/unnamed-chunk-18-1.png" width="700"></p>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">ggsave</span><span class="op">(</span>
  plot <span class="op">=</span> <span class="va">strength_histogram</span>,
  filename <span class="op">=</span> <span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="st">"figures/png/example_analyses"</span>,
                        <span class="st">"strength_histogram.png"</span><span class="op">)</span>,
  dpi <span class="op">=</span> <span class="fl">300</span>, width <span class="op">=</span> <span class="fl">8</span>, height <span class="op">=</span> <span class="fl">4</span>
<span class="op">)</span>

<span class="fu">ggsave</span><span class="op">(</span>
  plot <span class="op">=</span> <span class="va">strength_histogram</span>,
  filename <span class="op">=</span> <span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="st">"figures/tiff/example_analyses"</span>,
                        <span class="st">"strength_histogram.tiff"</span><span class="op">)</span>,
  dpi <span class="op">=</span> <span class="fl">300</span>, width <span class="op">=</span> <span class="fl">8</span>, height <span class="op">=</span> <span class="fl">4</span>
<span class="op">)</span></code></pre></div>
</div>
<div id="random-sampling-of-potential-joint-distributions" class="section level2">
<h2 class="hasAnchor">
<a href="#random-sampling-of-potential-joint-distributions" class="anchor"></a>Random Sampling of Potential Joint Distributions</h2>
<p>To try to squeeze more information out of the data at hand, we try to randomly sample distributions <span class="math inline">\(P(Y = y, X = x | Z = z)\)</span> that match the marginals we have, and don’t violate the IV model.</p>
<p>Using the function <code><a href="../reference/potential_covs.html">potential_covs()</a></code>, we get constraints on the values of <span class="math inline">\(\text{Cov}(X,Y | Z = z)\)</span>. Feeding these constraints to <code><a href="../reference/sample_joint_probs.html">sample_joint_probs()</a></code>, we sample <span class="math inline">\(500\)</span> joint distributions for each SNP. (Note: we save the results to a file so we can recompile this document much more efficiently.)</p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">smoking_lung_cancer_filename</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"samples_of_joints_"</span>, <span class="va">smoking_experiment</span><span class="op">$</span><span class="va">id</span>, <span class="st">"_"</span>, <span class="va">lung_cancer_experiment</span><span class="op">$</span><span class="va">id</span>, <span class="st">".Rds"</span><span class="op">)</span>

<span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/files.html">file.exists</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="st">"vignettes_data/example_analyses"</span>, <span class="va">smoking_lung_cancer_filename</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
  <span class="va">smoking_lung_cancer_samples_of_joints</span> <span class="op">&lt;-</span> <span class="fu">read_rds</span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="st">"vignettes_data/example_analyses"</span>, <span class="va">smoking_lung_cancer_filename</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span> <span class="kw">else</span> <span class="op">{</span>
  <span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">7892312</span><span class="op">)</span>
  
  <span class="va">smoking_lung_cancer_samples_of_joints</span> <span class="op">&lt;-</span> <span class="va">smoking_lung_cancer_bounds</span> <span class="op">%&gt;%</span> 
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rowwise.html">rowwise</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> 
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>pot_covs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="fu"><a href="../reference/potential_covs.html">potential_covs</a></span><span class="op">(</span>thetas <span class="op">=</span> <span class="va">thetas</span>, gammas <span class="op">=</span> <span class="va">gammas</span><span class="op">)</span><span class="op">)</span>,
           sample_joint <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="fu"><a href="../reference/sample_joint_probs.html">sample_joint_probs</a></span><span class="op">(</span><span class="va">pot_covs</span>, n <span class="op">=</span> <span class="fl">500</span>, return_bounds <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
  
  <span class="fu">write_rds</span><span class="op">(</span><span class="va">smoking_lung_cancer_samples_of_joints</span>, <span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="st">"vignettes_data/example_analyses"</span>, <span class="va">smoking_lung_cancer_filename</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<p>We do some expanding to expose the bounds from these joint distributions.</p>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">smoking_lung_cancer_trivariate_bounds</span> <span class="op">&lt;-</span> <span class="va">smoking_lung_cancer_samples_of_joints</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">SNP</span>, bivariate_lower <span class="op">=</span> <span class="va">lower</span>, bivariate_upper <span class="op">=</span> <span class="va">upper</span>, <span class="va">sample_joint</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">unnest</span><span class="op">(</span><span class="va">sample_joint</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">unnest</span><span class="op">(</span><span class="va">joint</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">unnest_wider</span><span class="op">(</span><span class="va">bounds</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>contains_zero <span class="op">=</span> <span class="va">lower</span> <span class="op">&lt;</span> <span class="fl">0</span> <span class="op">&amp;</span> <span class="va">upper</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span></code></pre></div>
<p>The plot below shows all bounds obtained from sampled joint distributions along with the original bivariate bounds. In this particular example, having a dataset with observations of <span class="math inline">\((X,Y,Z)\)</span> would not provide much more information. There seems to be essentially no setting where the IV model holds, the marginals we observe are correct, AND the joint distribution would allow to determine direction of the ATE.</p>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">smoking_lung_cancer_individual_SNPs_plot</span> <span class="op">&lt;-</span> <span class="va">smoking_lung_cancer_trivariate_bounds</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">SNP</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="va">lower</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>id <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/ranking.html">row_number</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>y <span class="op">=</span> <span class="va">id</span>, color <span class="op">=</span> <span class="va">contains_zero</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">geom_vline</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>xintercept <span class="op">=</span> <span class="va">bivariate_lower</span><span class="op">)</span>,
               linetype <span class="op">=</span> <span class="st">"dashed"</span><span class="op">)</span> <span class="op">+</span>  
    <span class="fu">geom_vline</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>xintercept <span class="op">=</span> <span class="va">bivariate_upper</span><span class="op">)</span>,
               linetype <span class="op">=</span> <span class="st">"dashed"</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">geom_vline</span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">geom_errorbar</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>xmin <span class="op">=</span> <span class="va">lower</span>,
                      xmax <span class="op">=</span> <span class="va">upper</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">geom_point</span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">0</span>, y <span class="op">=</span> <span class="fl">10</span>,
                                 contains_zero <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>,
               <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span><span class="op">)</span>,
               alpha <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">scale_color_manual</span><span class="op">(</span><span class="st">""</span>,
                       values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"grey50"</span>, <span class="st">"red4"</span><span class="op">)</span>,
                       labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Overlaps Zero"</span>, <span class="st">"Does not Overlap Zero"</span><span class="op">)</span>,
                       breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"TRUE"</span>, <span class="st">"FALSE"</span><span class="op">)</span>,
                       drop <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">lims</span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">labs</span><span class="op">(</span>
        x <span class="op">=</span> <span class="st">"ATE"</span>, y <span class="op">=</span> <span class="st">""</span>
    <span class="op">)</span> <span class="op">+</span>
    <span class="fu">coord_fixed</span><span class="op">(</span>ratio <span class="op">=</span> <span class="fl">1</span><span class="op">/</span><span class="fl">350</span><span class="op">)</span> <span class="op">+</span> 
    <span class="fu">facet_wrap</span><span class="op">(</span><span class="op">~</span><span class="va">SNP</span>, ncol <span class="op">=</span> <span class="fl">12</span><span class="op">)</span> <span class="op">+</span> 
    <span class="fu">theme</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"top"</span>,
          axis.text.y <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,
          axis.ticks.y <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,
          axis.text.x <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">45</span>, hjust <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,
          axis.ticks.x <span class="op">=</span> <span class="fu">element_line</span><span class="op">(</span><span class="op">)</span><span class="op">)</span>

<span class="va">smoking_lung_cancer_individual_SNPs_plot</span> <span class="op">+</span> 
    <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Possible Trivariate Bounds from Bivariate Data"</span>,
         subtitle <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"Exposure: Smoking (id: "</span>, <span class="va">smoking_experiment</span><span class="op">$</span><span class="va">id</span>, <span class="st">"). "</span>,
                           <span class="st">"Outcome: Lung Cancer (id: "</span>, <span class="va">lung_cancer_experiment</span><span class="op">$</span><span class="va">id</span>, <span class="st">")."</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="example_analysis_files/figure-html/unnamed-chunk-21-1.png" width="768"></p>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">ggsave</span><span class="op">(</span>
  plot <span class="op">=</span> <span class="va">smoking_lung_cancer_individual_SNPs_plot</span>,
  filename <span class="op">=</span> <span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="st">"figures/tiff/example_analyses"</span>, 
                        <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"smoking_lung_cancer_individual_SNPs_plot_"</span>, <span class="va">smoking_experiment</span><span class="op">$</span><span class="va">id</span>, <span class="st">"_"</span>, <span class="va">lung_cancer_experiment</span><span class="op">$</span><span class="va">id</span>,<span class="st">".tiff"</span><span class="op">)</span><span class="op">)</span>,
  height <span class="op">=</span> <span class="fl">7</span>, width <span class="op">=</span> <span class="fl">10</span>, dpi <span class="op">=</span> <span class="fl">300</span>
<span class="op">)</span>

<span class="fu">ggsave</span><span class="op">(</span>
  plot <span class="op">=</span> <span class="va">smoking_lung_cancer_individual_SNPs_plot</span>,
  filename <span class="op">=</span> <span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="st">"figures/png/example_analyses"</span>, 
                        <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"smoking_lung_cancer_individual_SNPs_plot_"</span>, <span class="va">smoking_experiment</span><span class="op">$</span><span class="va">id</span>, <span class="st">"_"</span>, <span class="va">lung_cancer_experiment</span><span class="op">$</span><span class="va">id</span>,<span class="st">".png"</span><span class="op">)</span><span class="op">)</span>,
  height <span class="op">=</span> <span class="fl">7</span>, width <span class="op">=</span> <span class="fl">10</span>, dpi <span class="op">=</span> <span class="fl">300</span>
<span class="op">)</span></code></pre></div>
<p>Again, we save figure with only a subset of the SNPs for our manuscript:</p>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">smoking_lung_cancer_individual_SNPs_plot_subset</span> <span class="op">&lt;-</span> <span class="va">smoking_lung_cancer_trivariate_bounds</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">SNP</span> <span class="op">%in%</span> <span class="va">smoking_SNP_subset</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">SNP</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="va">lower</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>id <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/ranking.html">row_number</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>y <span class="op">=</span> <span class="va">id</span>, color <span class="op">=</span> <span class="va">contains_zero</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">geom_errorbar</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>xmin <span class="op">=</span> <span class="va">lower</span>,
                      xmax <span class="op">=</span> <span class="va">upper</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">geom_point</span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">0</span>, y <span class="op">=</span> <span class="fl">10</span>,
                                 contains_zero <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>,
               <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span><span class="op">)</span>,
               alpha <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">geom_vline</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>xintercept <span class="op">=</span> <span class="va">bivariate_lower</span><span class="op">)</span>,
               linetype <span class="op">=</span> <span class="st">"dashed"</span><span class="op">)</span> <span class="op">+</span>  
    <span class="fu">geom_vline</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>xintercept <span class="op">=</span> <span class="va">bivariate_upper</span><span class="op">)</span>,
               linetype <span class="op">=</span> <span class="st">"dashed"</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">geom_vline</span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">scale_color_manual</span><span class="op">(</span><span class="st">""</span>,
                       values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"grey50"</span>, <span class="st">"red4"</span><span class="op">)</span>,
                       labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Overlaps Zero"</span>, <span class="st">"Does not Overlap Zero"</span><span class="op">)</span>,
                       breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"TRUE"</span>, <span class="st">"FALSE"</span><span class="op">)</span>,
                       drop <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">lims</span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">labs</span><span class="op">(</span>
        x <span class="op">=</span> <span class="st">"ATE"</span>, y <span class="op">=</span> <span class="st">""</span>
    <span class="op">)</span> <span class="op">+</span>
    <span class="fu">coord_fixed</span><span class="op">(</span>ratio <span class="op">=</span> <span class="fl">1</span><span class="op">/</span><span class="fl">350</span><span class="op">)</span> <span class="op">+</span> 
    <span class="fu">facet_wrap</span><span class="op">(</span><span class="op">~</span><span class="va">SNP</span>, ncol <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">theme</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"top"</span>,
          axis.text.y <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,
          axis.ticks.y <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,
          axis.text.x <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span><span class="op">)</span>,
          axis.ticks.x <span class="op">=</span> <span class="fu">element_line</span><span class="op">(</span><span class="op">)</span><span class="op">)</span>

<span class="fu">ggsave</span><span class="op">(</span>
  plot <span class="op">=</span> <span class="va">smoking_lung_cancer_individual_SNPs_plot_subset</span>,
  filename <span class="op">=</span> <span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="st">"figures/png/example_analyses"</span>, 
                        <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"smoking_lung_cancer_individual_SNPs_plot_subset_"</span>, <span class="va">smoking_experiment</span><span class="op">$</span><span class="va">id</span>, <span class="st">"_"</span>, <span class="va">lung_cancer_experiment</span><span class="op">$</span><span class="va">id</span>,<span class="st">".png"</span><span class="op">)</span><span class="op">)</span>,
  width <span class="op">=</span> <span class="fl">4</span>, height <span class="op">=</span> <span class="fl">6</span>, dpi <span class="op">=</span> <span class="fl">300</span>
<span class="op">)</span>

<span class="fu">ggsave</span><span class="op">(</span>
  plot <span class="op">=</span> <span class="va">smoking_lung_cancer_individual_SNPs_plot_subset</span>,
  filename <span class="op">=</span> <span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="st">"figures/tiff/example_analyses"</span>, 
                        <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"smoking_lung_cancer_individual_SNPs_plot_subset_"</span>, <span class="va">smoking_experiment</span><span class="op">$</span><span class="va">id</span>, <span class="st">"_"</span>, <span class="va">lung_cancer_experiment</span><span class="op">$</span><span class="va">id</span>,<span class="st">".tiff"</span><span class="op">)</span><span class="op">)</span>,
  width <span class="op">=</span> <span class="fl">4</span>, height <span class="op">=</span> <span class="fl">6</span>, dpi <span class="op">=</span> <span class="fl">300</span>
<span class="op">)</span></code></pre></div>
<p>Below is a similar plot where we assume monotonicity of <span class="math inline">\(P(X = 1 | Z = z)\)</span>. This is only done in cases where the marginals are such that the bivariate constraints are not violated. We notice that the information in these bounds is not much different.</p>
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">smoking_lung_cancer_filename_mono</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"samples_of_joints_mono_"</span>, <span class="va">smoking_experiment</span><span class="op">$</span><span class="va">id</span>, <span class="st">"_"</span>, <span class="va">lung_cancer_experiment</span><span class="op">$</span><span class="va">id</span>, <span class="st">".Rds"</span><span class="op">)</span>

<span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/files.html">file.exists</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="st">"vignettes_data/example_analyses"</span>, <span class="va">smoking_lung_cancer_filename_mono</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
  <span class="va">smoking_lung_cancer_samples_of_joints_mono</span> <span class="op">&lt;-</span> <span class="fu">read_rds</span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="st">"vignettes_data/example_analyses"</span>,
                                                                   <span class="va">smoking_lung_cancer_filename_mono</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span> <span class="kw">else</span> <span class="op">{</span>
  <span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">6925896</span><span class="op">)</span>
  <span class="va">smoking_lung_cancer_samples_of_joints_mono</span> <span class="op">&lt;-</span> <span class="va">smoking_lung_cancer_bounds</span> <span class="op">%&gt;%</span> 
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span><span class="va">constraints_violated_mono</span><span class="op">)</span> <span class="op">%&gt;%</span> 
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>i <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/ranking.html">row_number</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rowwise.html">rowwise</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> 
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>pot_covs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="fu"><a href="../reference/potential_covs.html">potential_covs</a></span><span class="op">(</span>thetas <span class="op">=</span> <span class="va">thetas</span>, gammas <span class="op">=</span> <span class="va">gammas</span>, x_mono <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span>,
           sample_joint <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="fu"><a href="../reference/sample_joint_probs.html">sample_joint_probs</a></span><span class="op">(</span><span class="va">pot_covs</span>, n <span class="op">=</span> <span class="fl">500</span>, return_bounds <span class="op">=</span> <span class="cn">TRUE</span>,
                                                  x_mono <span class="op">=</span> <span class="cn">TRUE</span>, print_progress <span class="op">=</span> <span class="cn">FALSE</span>,
                                                  print_as_progress <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
  
  <span class="fu">write_rds</span><span class="op">(</span><span class="va">smoking_lung_cancer_samples_of_joints_mono</span>,
            <span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="st">"vignettes_data/example_analyses"</span>,
                       <span class="va">smoking_lung_cancer_filename_mono</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span>

<span class="va">smoking_lung_cancer_trivariate_mono_bounds</span> <span class="op">&lt;-</span> <span class="va">smoking_lung_cancer_samples_of_joints_mono</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">SNP</span>, bivariate_lower <span class="op">=</span> <span class="va">lower_mono</span>, bivariate_upper <span class="op">=</span> <span class="va">upper_mono</span>, <span class="va">sample_joint</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">unnest</span><span class="op">(</span><span class="va">sample_joint</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">unnest</span><span class="op">(</span><span class="va">joint</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">unnest_wider</span><span class="op">(</span><span class="va">bounds</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>contains_zero <span class="op">=</span> <span class="va">lower</span> <span class="op">&lt;</span> <span class="fl">0</span> <span class="op">&amp;</span> <span class="va">upper</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span>

<span class="va">smoking_lung_cancer_individual_SNPs_mono_plot</span> <span class="op">&lt;-</span> <span class="va">smoking_lung_cancer_trivariate_mono_bounds</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">SNP</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="va">lower</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>id <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/ranking.html">row_number</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">id</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">geom_hline</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>yintercept <span class="op">=</span> <span class="va">bivariate_lower</span><span class="op">)</span>,
               linetype <span class="op">=</span> <span class="st">"dashed"</span><span class="op">)</span> <span class="op">+</span>  
    <span class="fu">geom_hline</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>yintercept <span class="op">=</span> <span class="va">bivariate_upper</span><span class="op">)</span>,
               linetype <span class="op">=</span> <span class="st">"dashed"</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">geom_hline</span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">geom_errorbar</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>ymin <span class="op">=</span> <span class="va">lower</span>,
                      ymax <span class="op">=</span> <span class="va">upper</span>,
                      color <span class="op">=</span> <span class="va">contains_zero</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">scale_color_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"red4"</span>, <span class="st">"grey50"</span><span class="op">)</span>,
                       breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="cn">FALSE</span>, <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
    <span class="fu">lims</span><span class="op">(</span>y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
    <span class="fu">coord_fixed</span><span class="op">(</span>ratio <span class="op">=</span> <span class="fl">500</span><span class="op">/</span><span class="fl">2</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">facet_wrap</span><span class="op">(</span><span class="op">~</span><span class="va">SNP</span>, nrow <span class="op">=</span> <span class="fl">7</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Possible Trivariate Bounds from Bivariate Data assuming Monotonicity"</span>,
         subtitle <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"Exposure: Smoking (id: "</span>, <span class="va">smoking_experiment</span><span class="op">$</span><span class="va">id</span>, <span class="st">"). "</span>,
                           <span class="st">"Outcome: Lung Cancer (id: "</span>, <span class="va">lung_cancer_experiment</span><span class="op">$</span><span class="va">id</span>, <span class="st">")."</span><span class="op">)</span><span class="op">)</span>

<span class="va">smoking_lung_cancer_individual_SNPs_mono_plot</span></code></pre></div>
<p><img src="example_analysis_files/figure-html/unnamed-chunk-23-1.png" width="1248"></p>
</div>
<div id="intersections-of-bounds-from-randomly-sampled-joint-distributions" class="section level2">
<h2 class="hasAnchor">
<a href="#intersections-of-bounds-from-randomly-sampled-joint-distributions" class="anchor"></a>Intersections of Bounds from Randomly Sampled Joint Distributions</h2>
<p>First, we create a tibble with all unique pairs of SNPs.</p>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">smoking_lung_cancer_pairs_of_snps</span> <span class="op">&lt;-</span> <span class="fu">expand_grid</span><span class="op">(</span>SNP1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">smoking_lung_cancer_trivariate_bounds</span><span class="op">$</span><span class="va">SNP</span><span class="op">)</span>,
                                                 SNP2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">smoking_lung_cancer_trivariate_bounds</span><span class="op">$</span><span class="va">SNP</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">SNP1</span> <span class="op">!=</span> <span class="va">SNP2</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rowwise.html">rowwise</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span><span class="op">(</span>SNPs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sort.html">sort</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">SNP1</span>, <span class="va">SNP2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/duplicated.html">duplicated</a></span><span class="op">(</span><span class="va">SNPs</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>SNPs <span class="op">=</span> <span class="fu">map</span><span class="op">(</span><span class="va">SNPs</span>, <span class="op">~</span><span class="fu">tibble_row</span><span class="op">(</span>SNP1 <span class="op">=</span> <span class="va">.x</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, SNP2 <span class="op">=</span> <span class="va">.x</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">unnest_wider</span><span class="op">(</span><span class="va">SNPs</span><span class="op">)</span></code></pre></div>
<pre><code>## `summarise()` has ungrouped output. You can override using the `.groups` argument.</code></pre>
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">smoking_lung_cancer_pairs_of_snps</span></code></pre></div>
<pre><code>## # A tibble: 3,486 x 2
##    SNP1       SNP2      
##    &lt;chr&gt;      &lt;chr&gt;     
##  1 rs10173733 rs10193706
##  2 rs10173733 rs10233018
##  3 rs10193706 rs10233018
##  4 rs10173733 rs10274594
##  5 rs10193706 rs10274594
##  6 rs10233018 rs10274594
##  7 rs10173733 rs1029986 
##  8 rs10193706 rs1029986 
##  9 rs10233018 rs1029986 
## 10 rs10274594 rs1029986 
## # … with 3,476 more rows</code></pre>
<p>The resulting tibble has 3486 rows, which is exactly <span class="math inline">\({84 \choose 2}\)</span>.</p>
<p>It is not feasible (and probably not even useful…) to go through all pairs, so instead we will simply look at a random sample of 8 pairs.</p>
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">493637</span><span class="op">)</span>

<span class="va">smoking_lung_cancer_chosen_pairs</span> <span class="op">&lt;-</span> <span class="va">smoking_lung_cancer_pairs_of_snps</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/sample_n.html">sample_n</a></span><span class="op">(</span><span class="fl">8</span><span class="op">)</span>

<span class="fu">pander</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/pander/man/pander.html">pander</a></span><span class="op">(</span><span class="va">smoking_lung_cancer_chosen_pairs</span><span class="op">)</span></code></pre></div>
<table class="table">
<colgroup>
<col width="18%">
<col width="18%">
</colgroup>
<thead><tr class="header">
<th align="center">SNP1</th>
<th align="center">SNP2</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">rs528301</td>
<td align="center">rs7451586</td>
</tr>
<tr class="even">
<td align="center">rs17151637</td>
<td align="center">rs6265</td>
</tr>
<tr class="odd">
<td align="center">rs1549213</td>
<td align="center">rs17151637</td>
</tr>
<tr class="even">
<td align="center">rs11127913</td>
<td align="center">rs12725407</td>
</tr>
<tr class="odd">
<td align="center">rs12910916</td>
<td align="center">rs76608582</td>
</tr>
<tr class="even">
<td align="center">rs4566215</td>
<td align="center">rs7528604</td>
</tr>
<tr class="odd">
<td align="center">rs6141314</td>
<td align="center">rs883403</td>
</tr>
<tr class="even">
<td align="center">rs2867749</td>
<td align="center">rs9381917</td>
</tr>
</tbody>
</table>
<p>We simply reuse the joint distributions and bounds found previously noting that this imposes the assumption that the distributions of <span class="math inline">\((X,Y|Z_1)\)</span> and <span class="math inline">\((X,Y|Z_2)\)</span> are independent of each other.</p>
<div class="sourceCode" id="cb50"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">smoking_lung_cancer_both_bounds</span> <span class="op">&lt;-</span> <span class="va">smoking_lung_cancer_chosen_pairs</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rowwise.html">rowwise</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>
    SNP1_bounds <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
      <span class="va">smoking_lung_cancer_trivariate_bounds</span> <span class="op">%&gt;%</span> 
        <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">SNP</span> <span class="op">==</span> <span class="va">SNP1</span><span class="op">)</span> <span class="op">%&gt;%</span> 
        <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span>SNP1_bivariate_lower <span class="op">=</span> <span class="va">bivariate_lower</span>, SNP1_bivariate_upper <span class="op">=</span> <span class="va">bivariate_upper</span>, 
               SNP1_lower <span class="op">=</span> <span class="va">lower</span>, SNP1_upper <span class="op">=</span> <span class="va">upper</span><span class="op">)</span>
    <span class="op">)</span>,
    SNP2_bounds <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
      <span class="va">smoking_lung_cancer_trivariate_bounds</span> <span class="op">%&gt;%</span> 
        <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">SNP</span> <span class="op">==</span> <span class="va">SNP2</span><span class="op">)</span> <span class="op">%&gt;%</span> 
        <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span>SNP2_bivariate_lower <span class="op">=</span> <span class="va">bivariate_lower</span>, SNP2_bivariate_upper <span class="op">=</span> <span class="va">bivariate_upper</span>,
               SNP2_lower <span class="op">=</span> <span class="va">lower</span>, SNP2_upper <span class="op">=</span> <span class="va">upper</span><span class="op">)</span>
    <span class="op">)</span>
  <span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">unnest</span><span class="op">(</span>cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">SNP1_bounds</span>, <span class="va">SNP2_bounds</span><span class="op">)</span><span class="op">)</span>

<span class="va">smoking_lung_cancer_both_bounds</span></code></pre></div>
<pre><code>## # A tibble: 4,000 x 10
##    SNP1  SNP2  SNP1_bivariate_… SNP1_bivariate_… SNP1_lower SNP1_upper
##    &lt;chr&gt; &lt;chr&gt;            &lt;dbl&gt;            &lt;dbl&gt;      &lt;dbl&gt;      &lt;dbl&gt;
##  1 rs52… rs74…           -0.662            0.576     -0.468      0.405
##  2 rs52… rs74…           -0.662            0.576     -0.456      0.419
##  3 rs52… rs74…           -0.662            0.576     -0.433      0.370
##  4 rs52… rs74…           -0.662            0.576     -0.499      0.425
##  5 rs52… rs74…           -0.662            0.576     -0.461      0.358
##  6 rs52… rs74…           -0.662            0.576     -0.484      0.415
##  7 rs52… rs74…           -0.662            0.576     -0.459      0.459
##  8 rs52… rs74…           -0.662            0.576     -0.477      0.357
##  9 rs52… rs74…           -0.662            0.576     -0.504      0.396
## 10 rs52… rs74…           -0.662            0.576     -0.429      0.386
## # … with 3,990 more rows, and 4 more variables: SNP2_bivariate_lower &lt;dbl&gt;,
## #   SNP2_bivariate_upper &lt;dbl&gt;, SNP2_lower &lt;dbl&gt;, SNP2_upper &lt;dbl&gt;</code></pre>
<p>Finally, we construct intersection bounds.</p>
<div class="sourceCode" id="cb52"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">smoking_lung_cancer_intersection_bounds</span> <span class="op">&lt;-</span> <span class="va">smoking_lung_cancer_both_bounds</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rowwise.html">rowwise</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>intersection_lower <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">SNP1_lower</span>, <span class="va">SNP2_lower</span><span class="op">)</span>,
         intersection_upper <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">SNP1_upper</span>, <span class="va">SNP2_upper</span><span class="op">)</span>,
         bivariate_intersection_lower <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">SNP1_bivariate_lower</span>, <span class="va">SNP2_bivariate_lower</span><span class="op">)</span>,
         bivariate_intersection_upper <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">SNP1_bivariate_upper</span>, <span class="va">SNP2_bivariate_upper</span><span class="op">)</span>,
  <span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>contains_zero <span class="op">=</span> <span class="va">intersection_lower</span> <span class="op">&lt;</span> <span class="fl">0</span> <span class="op">&amp;</span> <span class="va">intersection_upper</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span></code></pre></div>
<p>A plot to display them.</p>
<div class="sourceCode" id="cb53"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">smoking_lung_cancer_intersection_bounds_plot</span> <span class="op">&lt;-</span> <span class="va">smoking_lung_cancer_intersection_bounds</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">SNP1</span>, <span class="va">SNP2</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="va">intersection_lower</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>i <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/ranking.html">row_number</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>y <span class="op">=</span> <span class="va">i</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
    <span class="fu">geom_vline</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>xintercept <span class="op">=</span> <span class="va">bivariate_intersection_lower</span><span class="op">)</span>,
               linetype <span class="op">=</span> <span class="st">"dashed"</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">geom_vline</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>xintercept <span class="op">=</span> <span class="va">bivariate_intersection_upper</span><span class="op">)</span>,
               linetype <span class="op">=</span> <span class="st">"dashed"</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">geom_errorbar</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>xmin <span class="op">=</span> <span class="va">intersection_lower</span>,
                      xmax <span class="op">=</span> <span class="va">intersection_upper</span>,
                      color <span class="op">=</span> <span class="va">contains_zero</span><span class="op">)</span>,
                  alpha <span class="op">=</span> <span class="fl">0.7</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">geom_point</span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">0</span>, y <span class="op">=</span> <span class="fl">10</span>,
                                 contains_zero <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>,
               <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>, color <span class="op">=</span> <span class="va">contains_zero</span><span class="op">)</span>,
               alpha <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">scale_color_manual</span><span class="op">(</span><span class="st">""</span>,
                       values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"grey50"</span>, <span class="st">"red4"</span><span class="op">)</span>,
                       labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Overlaps Zero"</span>, <span class="st">"Does not Overlap Zero"</span><span class="op">)</span>,
                       breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"TRUE"</span>, <span class="st">"FALSE"</span><span class="op">)</span>,
                       drop <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">lims</span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
    <span class="fu">coord_fixed</span><span class="op">(</span>ratio <span class="op">=</span> <span class="fl">1</span><span class="op">/</span><span class="fl">350</span><span class="op">)</span> <span class="op">+</span> 
    <span class="fu">geom_vline</span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">facet_wrap</span><span class="op">(</span><span class="op">~</span><span class="va">SNP1</span> <span class="op">+</span> <span class="va">SNP2</span>,
               nrow <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">labs</span><span class="op">(</span>
      y <span class="op">=</span> <span class="st">""</span>, x <span class="op">=</span> <span class="st">"ATE"</span>
    <span class="op">)</span> <span class="op">+</span>
    <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">theme</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"top"</span>,
          axis.text.x <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span><span class="op">)</span>,
          axis.ticks.x <span class="op">=</span> <span class="fu">element_line</span><span class="op">(</span><span class="op">)</span>,
          axis.text.y <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,
          axis.ticks.y <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span><span class="op">)</span>

<span class="fu">ggsave</span><span class="op">(</span>
  plot <span class="op">=</span> <span class="va">smoking_lung_cancer_intersection_bounds_plot</span>,
  filename <span class="op">=</span> <span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="st">"figures/tiff/example_analyses"</span>, 
                        <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"smoking_lung_cancer_intersection_bounds_plot_"</span>, <span class="va">smoking_experiment</span><span class="op">$</span><span class="va">id</span>, <span class="st">"_"</span>, <span class="va">lung_cancer_experiment</span><span class="op">$</span><span class="va">id</span>,<span class="st">".tiff"</span><span class="op">)</span><span class="op">)</span>,
  width <span class="op">=</span> <span class="fl">8</span>, height <span class="op">=</span> <span class="fl">6</span>, dpi <span class="op">=</span> <span class="fl">300</span>
<span class="op">)</span>

<span class="fu">ggsave</span><span class="op">(</span>
  plot <span class="op">=</span> <span class="va">smoking_lung_cancer_intersection_bounds_plot</span>,
  filename <span class="op">=</span> <span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="st">"figures/png/example_analyses"</span>, 
                        <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"smoking_lung_cancer_intersection_bounds_plot_"</span>, <span class="va">smoking_experiment</span><span class="op">$</span><span class="va">id</span>, <span class="st">"_"</span>, <span class="va">lung_cancer_experiment</span><span class="op">$</span><span class="va">id</span>,<span class="st">".png"</span><span class="op">)</span><span class="op">)</span>,
  width <span class="op">=</span> <span class="fl">8</span>, height <span class="op">=</span> <span class="fl">6</span>, dpi <span class="op">=</span> <span class="fl">300</span>
<span class="op">)</span>

<span class="va">smoking_lung_cancer_intersection_bounds_plot</span> <span class="op">+</span>
    <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Intersections of Possible Trivariate Bounds from Bivariate Data"</span>,
         subtitle <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"Exposure: Smoking (id: "</span>, <span class="va">smoking_experiment</span><span class="op">$</span><span class="va">id</span>, <span class="st">"). "</span>,
                           <span class="st">"Outcome: Lung Cancer (id: "</span>, <span class="va">lung_cancer_experiment</span><span class="op">$</span><span class="va">id</span>, <span class="st">")."</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="example_analysis_files/figure-html/unnamed-chunk-28-1.png" width="960"></p>
</div>
</div>
<div id="effect-of-high-cholesterol-on-heart-attack" class="section level1">
<h1 class="hasAnchor">
<a href="#effect-of-high-cholesterol-on-heart-attack" class="anchor"></a>Effect of High Cholesterol on Heart Attack</h1>
<p>Our second example will use high cholesterol as exposure, and heart attack as outcome (both as binary). The following repeat the analysis above for this pair of variables.</p>
<div id="collect-data-1" class="section level2">
<h2 class="hasAnchor">
<a href="#collect-data-1" class="anchor"></a>Collect Data</h2>
<div class="sourceCode" id="cb54"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">cholesterol_experiment</span> <span class="op">&lt;-</span> <span class="va">ao</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">id</span> <span class="op">==</span> <span class="st">"ukb-a-108"</span><span class="op">)</span> 
<span class="va">cholesterol_instruments</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/TwoSampleMR/man/extract_instruments.html">extract_instruments</a></span><span class="op">(</span><span class="va">cholesterol_experiment</span><span class="op">$</span><span class="va">id</span><span class="op">)</span>

<span class="va">heart_attack_experiment</span> <span class="op">&lt;-</span> <span class="va">ao</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">id</span> <span class="op">==</span> <span class="st">"ukb-a-434"</span><span class="op">)</span>

<span class="va">heart_attack_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/TwoSampleMR/man/extract_outcome_data.html">extract_outcome_data</a></span><span class="op">(</span>snps <span class="op">=</span> <span class="va">cholesterol_instruments</span><span class="op">$</span><span class="va">SNP</span>, outcomes <span class="op">=</span> <span class="va">heart_attack_experiment</span><span class="op">$</span><span class="va">id</span><span class="op">)</span></code></pre></div>
<pre><code>## Extracting data for 54 SNP(s) from 1 GWAS(s)</code></pre>
<div class="sourceCode" id="cb56"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">cholesterol_heart_attack_harmonized</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/TwoSampleMR/man/harmonise_data.html">harmonise_data</a></span><span class="op">(</span><span class="va">cholesterol_instruments</span>, <span class="va">heart_attack_data</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html">as_tibble</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code>## Harmonising Non-cancer illness code  self-reported: high cholesterol || id:ukb-a-108 (ukb-a-108) and Vascular/heart problems diagnosed by doctor: Heart attack || id:ukb-a-434 (ukb-a-434)</code></pre>
<pre><code>## Removing the following SNPs for being palindromic with intermediate allele frequencies:
## rs28601761, rs7213086</code></pre>
<div class="sourceCode" id="cb59"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">cholesterol_heart_attack_pop_probs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span>regression <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"outcome"</span>, <span class="st">"exposure"</span><span class="op">)</span>,
                                             p_outcome <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">cholesterol_experiment</span>  <span class="op">%$%</span> <span class="op">{</span> <span class="va">ncase</span> <span class="op">/</span> <span class="op">(</span><span class="va">ncase</span> <span class="op">+</span> <span class="va">ncontrol</span><span class="op">)</span> <span class="op">}</span>,
                                                           <span class="va">heart_attack_experiment</span> <span class="op">%$%</span> <span class="op">{</span> <span class="va">ncase</span> <span class="op">/</span> <span class="op">(</span><span class="va">ncase</span> <span class="op">+</span> <span class="va">ncontrol</span><span class="op">)</span> <span class="op">}</span><span class="op">)</span><span class="op">)</span>

<span class="va">cholesterol_heart_attack_prep_for_bounds</span> <span class="op">&lt;-</span> <span class="va">cholesterol_heart_attack_harmonized</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rowwise.html">rowwise</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>samplesize.exposure <span class="op">=</span> <span class="va">cholesterol_experiment</span><span class="op">$</span><span class="va">ncase</span> <span class="op">+</span> <span class="va">cholesterol_experiment</span><span class="op">$</span><span class="va">ncontrol</span>,
         samplesize.outcome <span class="op">=</span> <span class="va">heart_attack_experiment</span><span class="op">$</span><span class="va">ncase</span> <span class="op">+</span> <span class="va">heart_attack_experiment</span><span class="op">$</span><span class="va">ncontrol</span>,
         ave_eaf <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/weighted.mean.html">weighted.mean</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/c_across.html">c_across</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">eaf.exposure</span>, <span class="va">eaf.outcome</span><span class="op">)</span><span class="op">)</span>,
                                 w <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/c_across.html">c_across</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">samplesize.exposure</span>, <span class="va">samplesize.outcome</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">SNP</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">contains</a></span><span class="op">(</span><span class="st">"beta"</span><span class="op">)</span>, <span class="va">ave_eaf</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">pivot_longer</span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">contains</a></span><span class="op">(</span><span class="st">"beta"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">separate</span><span class="op">(</span><span class="va">name</span>, into <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"variable"</span>, <span class="st">"regression"</span><span class="op">)</span>, sep <span class="op">=</span> <span class="st">"\\."</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">pivot_wider</span><span class="op">(</span>names_from <span class="op">=</span> <span class="va">variable</span>, values_from <span class="op">=</span> <span class="va">value</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>`P(Z = 2)` <span class="op">=</span> <span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">ave_eaf</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span>,
         `P(Z = 1)` <span class="op">=</span> <span class="fl">2</span><span class="op">*</span><span class="va">ave_eaf</span><span class="op">*</span><span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">ave_eaf</span><span class="op">)</span>,
         `P(Z = 0)` <span class="op">=</span> <span class="va">ave_eaf</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span>

<span class="va">cholesterol_heart_attack_w_intercept</span> <span class="op">&lt;-</span> <span class="va">cholesterol_heart_attack_prep_for_bounds</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">cholesterol_heart_attack_pop_probs</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rowwise.html">rowwise</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>find_intercept <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="fu">find_intercept</span><span class="op">(</span>beta1 <span class="op">=</span> <span class="va">beta</span>,
                                              p_outcome <span class="op">=</span> <span class="va">p_outcome</span>,
                                              pz <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">`P(Z = 0)`</span>, <span class="va">`P(Z = 1)`</span>, <span class="va">`P(Z = 2)`</span><span class="op">)</span>,
                                              interval <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">7</span>,<span class="fl">7</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,
         beta0 <span class="op">=</span> <span class="va">find_intercept</span><span class="op">$</span><span class="va">root</span>,
         `thetas/gammas` <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="op">(</span><span class="fl">1</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="op">-</span><span class="va">beta0</span> <span class="op">-</span> <span class="fl">0</span><span class="op">:</span><span class="fl">2</span><span class="op">*</span><span class="va">beta</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## Joining, by = "regression"</code></pre>
</div>
<div id="summaries-of-marginal-distributions-1" class="section level2">
<h2 class="hasAnchor">
<a href="#summaries-of-marginal-distributions-1" class="anchor"></a>Summaries of Marginal Distributions</h2>
<div class="sourceCode" id="cb61"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">summaries_for_plots_cholesterol_HA</span> <span class="op">&lt;-</span> <span class="va">cholesterol_heart_attack_w_intercept</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">SNP</span>, <span class="va">regression</span>, <span class="va">beta</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">starts_with</a></span><span class="op">(</span><span class="st">"P(Z ="</span><span class="op">)</span>, <span class="va">p_outcome</span>, <span class="va">beta0</span>, <span class="va">`thetas/gammas`</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>`thetas/gammas` <span class="op">=</span> <span class="fu">map</span><span class="op">(</span><span class="va">`thetas/gammas`</span>, <span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/stats/setNames.html">setNames</a></span><span class="op">(</span><span class="va">.x</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"xy_given_z0"</span>, <span class="st">"xy_given_z1"</span>, <span class="st">"xy_given_z2"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">unnest_wider</span><span class="op">(</span><span class="va">`thetas/gammas`</span><span class="op">)</span>

<span class="fu">write_csv</span><span class="op">(</span>
  <span class="va">summaries_for_plots_cholesterol_HA</span>,
  <span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="st">"vignettes_data/summary_stats_cholesterol_on_heart_attack.csv"</span><span class="op">)</span>
<span class="op">)</span>

<span class="op">(</span><span class="va">marginal_Z_cholesterol_HA</span> <span class="op">&lt;-</span> <span class="va">summaries_for_plots_cholesterol_HA</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">regression</span> <span class="op">==</span> <span class="st">"exposure"</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">pivot_longer</span><span class="op">(</span>cols <span class="op">=</span> <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">starts_with</a></span><span class="op">(</span><span class="st">"P(Z ="</span><span class="op">)</span>,
               names_to <span class="op">=</span> <span class="st">"z"</span>, values_to <span class="op">=</span> <span class="st">"p"</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">p</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">geom_histogram</span><span class="op">(</span>boundary <span class="op">=</span> <span class="fl">0</span>, binwidth <span class="op">=</span> <span class="fl">0.05</span>, 
                   color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">facet_grid</span><span class="op">(</span><span class="op">~</span> <span class="va">z</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://rdrr.io/r/graphics/plot.window.html">xlim</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
    <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="example_analysis_files/figure-html/unnamed-chunk-30-1.png" width="700"></p>
<div class="sourceCode" id="cb62"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">ggsave</span><span class="op">(</span>
  plot <span class="op">=</span> <span class="va">marginal_Z_cholesterol_HA</span>,
  filename <span class="op">=</span> <span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="st">"figures/png/example_analyses"</span>, 
                        <span class="st">"cholesterol_heart_attack_marginal_Z.png"</span><span class="op">)</span>,
  dpi <span class="op">=</span> <span class="fl">300</span>, width <span class="op">=</span> <span class="fl">6.5</span>, height <span class="op">=</span> <span class="fl">2</span>
<span class="op">)</span>
<span class="fu">ggsave</span><span class="op">(</span>
  plot <span class="op">=</span> <span class="va">marginal_Z_cholesterol_HA</span>,
  filename <span class="op">=</span> <span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="st">"figures/tiff/example_analyses"</span>, 
                        <span class="st">"cholesterol_heart_attack_marginal_Z.tiff"</span><span class="op">)</span>,
  dpi <span class="op">=</span> <span class="fl">300</span>, width <span class="op">=</span> <span class="fl">6.5</span>, height <span class="op">=</span> <span class="fl">2</span>
<span class="op">)</span>

<span class="op">(</span><span class="va">heart_attack_coefficients</span> <span class="op">&lt;-</span> <span class="va">summaries_for_plots_cholesterol_HA</span> <span class="op">%&gt;%</span> 
  <span class="fu">pivot_longer</span><span class="op">(</span>cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">beta</span>, <span class="va">beta0</span><span class="op">)</span>,
               names_to <span class="op">=</span> <span class="st">"coef"</span>, values_to <span class="op">=</span> <span class="st">"value"</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>real_coefs <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when</a></span><span class="op">(</span><span class="va">coef</span> <span class="op">==</span> <span class="st">"beta"</span> <span class="op">&amp;</span> <span class="va">regression</span> <span class="op">==</span> <span class="st">"exposure"</span> <span class="op">~</span> <span class="st">"beta[1]"</span>, 
                                <span class="va">coef</span> <span class="op">==</span> <span class="st">"beta0"</span> <span class="op">&amp;</span> <span class="va">regression</span> <span class="op">==</span> <span class="st">"exposure"</span> <span class="op">~</span> <span class="st">"beta[0]"</span>,
                                <span class="va">coef</span> <span class="op">==</span> <span class="st">"beta"</span> <span class="op">&amp;</span> <span class="va">regression</span> <span class="op">==</span> <span class="st">"outcome"</span> <span class="op">~</span> <span class="st">"gamma[1]"</span>, 
                                <span class="va">coef</span> <span class="op">==</span> <span class="st">"beta0"</span> <span class="op">&amp;</span> <span class="va">regression</span> <span class="op">==</span> <span class="st">"outcome"</span> <span class="op">~</span> <span class="st">"gamma[0]"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">geom_histogram</span><span class="op">(</span>boundary <span class="op">=</span> <span class="fl">0</span>, binwidth <span class="op">=</span> <span class="fl">0.001</span>, 
                   color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">facet_wrap</span><span class="op">(</span><span class="op">~</span> <span class="va">real_coefs</span>,
               scales <span class="op">=</span> <span class="st">"free"</span>,
               labeller <span class="op">=</span> <span class="va">label_parsed</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="example_analysis_files/figure-html/unnamed-chunk-30-2.png" width="700"></p>
<div class="sourceCode" id="cb63"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">ggsave</span><span class="op">(</span>
  plot <span class="op">=</span> <span class="va">heart_attack_coefficients</span>,
  filename <span class="op">=</span> <span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="st">"figures/png/example_analyses"</span>, 
                        <span class="st">"cholesterol_heart_attack_coefficients.png"</span><span class="op">)</span>,
  dpi <span class="op">=</span> <span class="fl">300</span>, width <span class="op">=</span> <span class="fl">5</span>, height <span class="op">=</span> <span class="fl">3</span>
<span class="op">)</span>
<span class="fu">ggsave</span><span class="op">(</span>
  plot <span class="op">=</span> <span class="va">heart_attack_coefficients</span>,
  filename <span class="op">=</span> <span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="st">"figures/tiff/example_analyses"</span>, 
                        <span class="st">"cholesterol_heart_attack_coefficients.tiff"</span><span class="op">)</span>,
  dpi <span class="op">=</span> <span class="fl">300</span>, width <span class="op">=</span> <span class="fl">5</span>, height <span class="op">=</span> <span class="fl">3</span>
<span class="op">)</span>

<span class="op">(</span><span class="va">cholesterol_heart_attack_marginal_conditionals</span> <span class="op">&lt;-</span> <span class="va">summaries_for_plots_cholesterol_HA</span> <span class="op">%&gt;%</span> 
  <span class="fu">pivot_longer</span><span class="op">(</span>cols <span class="op">=</span> <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">starts_with</a></span><span class="op">(</span><span class="st">"xy_given_z"</span><span class="op">)</span>,
               names_to <span class="op">=</span> <span class="st">"vars"</span>, values_to <span class="op">=</span> <span class="st">"p"</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>regression <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html">if_else</a></span><span class="op">(</span><span class="va">regression</span> <span class="op">==</span> <span class="st">"exposure"</span>,
                              <span class="st">"P(X = 1 | Z = z)"</span>, <span class="st">"P(Y = 1 | Z = z)"</span><span class="op">)</span>,
         vars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"z ="</span>, <span class="fu">str_extract</span><span class="op">(</span><span class="va">vars</span>, <span class="st">"[0-2]"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">p</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
    <span class="fu">geom_histogram</span><span class="op">(</span>bins <span class="op">=</span> <span class="fl">20</span>, boundary <span class="op">=</span> <span class="fl">0.2</span>, 
                   color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span> <span class="op">+</span> 
    <span class="fu">facet_grid</span><span class="op">(</span><span class="va">vars</span> <span class="op">~</span> <span class="va">regression</span>,
               scales <span class="op">=</span> <span class="st">"free"</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="example_analysis_files/figure-html/unnamed-chunk-30-3.png" width="700"></p>
<div class="sourceCode" id="cb64"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">ggsave</span><span class="op">(</span>
  plot <span class="op">=</span> <span class="va">cholesterol_heart_attack_marginal_conditionals</span>,
  filename <span class="op">=</span> <span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="st">"figures/tiff/example_analyses"</span>,
                        <span class="st">"cholesterol_heart_attack_marginal_conditionals.tiff"</span><span class="op">)</span>,
  dpi <span class="op">=</span> <span class="fl">300</span>, width <span class="op">=</span> <span class="fl">5</span>, height <span class="op">=</span> <span class="fl">3</span>
<span class="op">)</span>

<span class="fu">ggsave</span><span class="op">(</span>
  plot <span class="op">=</span> <span class="va">cholesterol_heart_attack_marginal_conditionals</span>,
  filename <span class="op">=</span> <span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="st">"figures/png/example_analyses"</span>,
                        <span class="st">"cholesterol_heart_attack_marginal_conditionals.png"</span><span class="op">)</span>,
  dpi <span class="op">=</span> <span class="fl">300</span>, width <span class="op">=</span> <span class="fl">5</span>, height <span class="op">=</span> <span class="fl">3</span>
<span class="op">)</span>


<span class="va">cholesterol_heart_attack_bounds</span> <span class="op">&lt;-</span> <span class="va">cholesterol_heart_attack_w_intercept</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">find_intercept</span>, <span class="op">-</span><span class="va">beta0</span>, <span class="op">-</span><span class="va">beta</span>, <span class="op">-</span><span class="va">p_outcome</span>, <span class="op">-</span><span class="va">ave_eaf</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>regression <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html">if_else</a></span><span class="op">(</span><span class="va">regression</span> <span class="op">==</span> <span class="st">"outcome"</span>, <span class="st">"gammas"</span>, <span class="st">"thetas"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">pivot_wider</span><span class="op">(</span>names_from <span class="op">=</span> <span class="va">regression</span>, values_from <span class="op">=</span> <span class="va">`thetas/gammas`</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rowwise.html">rowwise</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>bivariate_bounds <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="fu"><a href="../reference/get_bounds.html">get_bounds</a></span><span class="op">(</span>thetas <span class="op">=</span> <span class="va">thetas</span>, gammas <span class="op">=</span> <span class="va">gammas</span>, 
                                            stop <span class="op">=</span> <span class="cn">FALSE</span>, warning <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span>,
         interval <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">bivariate_bounds</span><span class="op">$</span><span class="va">interval</span><span class="op">)</span>,
         constraints_violated <span class="op">=</span> <span class="va">bivariate_bounds</span><span class="op">$</span><span class="va">constraints_violated</span>, 
         bivariate_bounds_mono <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="fu"><a href="../reference/get_bounds.html">get_bounds</a></span><span class="op">(</span>thetas <span class="op">=</span> <span class="va">thetas</span>, gammas <span class="op">=</span> <span class="va">gammas</span>, 
                                                 stop <span class="op">=</span> <span class="cn">FALSE</span>, warning <span class="op">=</span> <span class="cn">FALSE</span>,
                                                 x_mono <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span>,
         interval_mono <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">bivariate_bounds_mono</span><span class="op">$</span><span class="va">interval</span><span class="op">)</span>,
         constraints_violated_mono <span class="op">=</span> <span class="va">bivariate_bounds_mono</span><span class="op">$</span><span class="va">constraints_violated</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">unnest_wider</span><span class="op">(</span>col <span class="op">=</span> <span class="va">interval_mono</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span><span class="op">(</span>upper_mono <span class="op">=</span> <span class="va">upper</span>, lower_mono <span class="op">=</span> <span class="va">lower</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">unnest_wider</span><span class="op">(</span><span class="va">interval</span><span class="op">)</span>

<span class="va">cholesterol_heart_attack_bivariate_bounds</span> <span class="op">&lt;-</span> <span class="va">cholesterol_heart_attack_bounds</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="va">lower</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>y <span class="op">=</span> <span class="va">SNP</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">geom_errorbar</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>xmax <span class="op">=</span> <span class="va">upper</span>, xmin <span class="op">=</span> <span class="va">lower</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">facet_wrap</span><span class="op">(</span><span class="op">~</span> <span class="va">lower</span> <span class="op">&lt;</span> <span class="fu"><a href="https://rdrr.io/r/stats/median.html">median</a></span><span class="op">(</span><span class="va">lower</span><span class="op">)</span>,
               ncol <span class="op">=</span> <span class="fl">2</span>, scales <span class="op">=</span> <span class="st">"free_y"</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">theme</span><span class="op">(</span>strip.text <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,
          strip.background <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
    <span class="fu">labs</span><span class="op">(</span>
      y <span class="op">=</span> <span class="st">""</span>,
      x <span class="op">=</span> <span class="st">"ATE"</span>
    <span class="op">)</span> <span class="op">+</span>
    <span class="fu">lims</span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span>

<span class="va">cholesterol_heart_attack_bivariate_bounds</span> <span class="op">+</span>
      <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Bivariate bounds"</span>,
         subtitle <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"Exposure: High Cholesterol (id: "</span>, <span class="va">cholesterol_experiment</span><span class="op">$</span><span class="va">id</span>, <span class="st">"). "</span>,
                           <span class="st">"Outcome: Heart Attack (id: "</span>, <span class="va">heart_attack_experiment</span><span class="op">$</span><span class="va">id</span>, <span class="st">")."</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="example_analysis_files/figure-html/unnamed-chunk-30-4.png" width="700"></p>
<div class="sourceCode" id="cb65"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">ggsave</span><span class="op">(</span>
  plot <span class="op">=</span> <span class="va">cholesterol_heart_attack_bivariate_bounds</span>,
  filename <span class="op">=</span> <span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="st">"figures/tiff/example_analyses"</span>, 
                        <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"cholesterol_heart_attack_bivariate_bounds_"</span>, <span class="va">cholesterol_experiment</span><span class="op">$</span><span class="va">id</span>, <span class="st">"_"</span>, <span class="va">heart_attack_experiment</span><span class="op">$</span><span class="va">id</span>,<span class="st">".tiff"</span><span class="op">)</span><span class="op">)</span>,
  width <span class="op">=</span> <span class="fl">8</span>, height <span class="op">=</span> <span class="fl">10</span>, dpi <span class="op">=</span> <span class="fl">300</span>
<span class="op">)</span>

<span class="fu">ggsave</span><span class="op">(</span>
  plot <span class="op">=</span> <span class="va">cholesterol_heart_attack_bivariate_bounds</span>,
  filename <span class="op">=</span> <span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="st">"figures/png/example_analyses"</span>, 
                        <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"cholesterol_heart_attack_bivariate_bounds_"</span>, <span class="va">cholesterol_experiment</span><span class="op">$</span><span class="va">id</span>, <span class="st">"_"</span>, <span class="va">heart_attack_experiment</span><span class="op">$</span><span class="va">id</span>,<span class="st">".png"</span><span class="op">)</span><span class="op">)</span>,
  width <span class="op">=</span> <span class="fl">8</span>, height <span class="op">=</span> <span class="fl">10</span>, dpi <span class="op">=</span> <span class="fl">300</span>
<span class="op">)</span>


<span class="va">cholesterol_SNP_subset</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">cholesterol_heart_attack_bounds</span><span class="op">$</span><span class="va">SNP</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">5</span>, <span class="fl">12</span>, <span class="fl">17</span>, <span class="fl">25</span>, <span class="fl">34</span>, <span class="fl">45</span>, <span class="fl">52</span><span class="op">)</span><span class="op">]</span>

<span class="va">cholesterol_heart_attack_bivariate_bounds_subset</span> <span class="op">&lt;-</span> <span class="va">cholesterol_heart_attack_bounds</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">SNP</span> <span class="op">%in%</span> <span class="va">cholesterol_SNP_subset</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="va">lower</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>y <span class="op">=</span> <span class="va">SNP</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">geom_errorbar</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>xmax <span class="op">=</span> <span class="va">upper</span>, xmin <span class="op">=</span> <span class="va">lower</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">theme</span><span class="op">(</span>strip.text <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,
          strip.background <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
    <span class="fu">labs</span><span class="op">(</span>
      y <span class="op">=</span> <span class="st">""</span>,
      x <span class="op">=</span> <span class="st">"ATE"</span>
    <span class="op">)</span> <span class="op">+</span>
    <span class="fu">lims</span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span>

<span class="fu">ggsave</span><span class="op">(</span>
  plot <span class="op">=</span> <span class="va">cholesterol_heart_attack_bivariate_bounds_subset</span>,
  filename <span class="op">=</span> <span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="st">"figures/tiff/example_analyses"</span>, 
                        <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"cholesterol_heart_attack_bivariate_bounds_subset_"</span>, <span class="va">cholesterol_experiment</span><span class="op">$</span><span class="va">id</span>, <span class="st">"_"</span>, <span class="va">heart_attack_experiment</span><span class="op">$</span><span class="va">id</span>,<span class="st">".tiff"</span><span class="op">)</span><span class="op">)</span>,
  width <span class="op">=</span> <span class="fl">4</span>, height <span class="op">=</span> <span class="fl">4</span>, dpi <span class="op">=</span> <span class="fl">300</span>
<span class="op">)</span>

<span class="fu">ggsave</span><span class="op">(</span>
  plot <span class="op">=</span> <span class="va">cholesterol_heart_attack_bivariate_bounds_subset</span>,
  filename <span class="op">=</span> <span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="st">"figures/png/example_analyses"</span>, 
                        <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"cholesterol_heart_attack_bivariate_bounds_subset_"</span>, <span class="va">cholesterol_experiment</span><span class="op">$</span><span class="va">id</span>, <span class="st">"_"</span>, <span class="va">heart_attack_experiment</span><span class="op">$</span><span class="va">id</span>,<span class="st">".png"</span><span class="op">)</span><span class="op">)</span>,
  width <span class="op">=</span> <span class="fl">4</span>, height <span class="op">=</span> <span class="fl">4</span>, dpi <span class="op">=</span> <span class="fl">300</span>
<span class="op">)</span>


<span class="va">strength_histogram_cholesterol</span> <span class="op">&lt;-</span> <span class="va">cholesterol_heart_attack_bounds</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rowwise.html">rowwise</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>strength <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/outer.html">outer</a></span><span class="op">(</span><span class="va">thetas</span>, <span class="va">thetas</span>, <span class="va">`-`</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">strength</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
    <span class="fu">geom_histogram</span><span class="op">(</span>color <span class="op">=</span> <span class="st">"black"</span>, binwidth <span class="op">=</span> <span class="fl">0.001</span>, boundary <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">+</span> 
    <span class="fu">scale_x_continuous</span><span class="op">(</span>limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.012</span><span class="op">)</span>, 
                       breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.012</span>, by <span class="op">=</span> <span class="fl">0.002</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Strength"</span>, y <span class="op">=</span> <span class="st">"Count"</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span>

<span class="va">strength_histogram_cholesterol</span> <span class="op">+</span>
  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Strength of IVs on High Cholesterol"</span><span class="op">)</span></code></pre></div>
<p><img src="example_analysis_files/figure-html/unnamed-chunk-30-5.png" width="700"></p>
<div class="sourceCode" id="cb66"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">ggsave</span><span class="op">(</span>
  plot <span class="op">=</span> <span class="va">strength_histogram_cholesterol</span>,
  filename <span class="op">=</span> <span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="st">"figures/tiff/example_analyses"</span>,
                        <span class="st">"cholesterol_heart_attack_strength_histogram.tiff"</span><span class="op">)</span>,
  dpi <span class="op">=</span> <span class="fl">300</span>, width <span class="op">=</span> <span class="fl">8</span>, height <span class="op">=</span> <span class="fl">4</span>
<span class="op">)</span>

<span class="fu">ggsave</span><span class="op">(</span>
  plot <span class="op">=</span> <span class="va">strength_histogram_cholesterol</span>,
  filename <span class="op">=</span> <span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="st">"figures/png/example_analyses"</span>,
                        <span class="st">"cholesterol_heart_attack_strength_histogram.png"</span><span class="op">)</span>,
  dpi <span class="op">=</span> <span class="fl">300</span>, width <span class="op">=</span> <span class="fl">8</span>, height <span class="op">=</span> <span class="fl">4</span>
<span class="op">)</span></code></pre></div>
</div>
<div id="random-sampling-of-potential-joint-distributions-1" class="section level2">
<h2 class="hasAnchor">
<a href="#random-sampling-of-potential-joint-distributions-1" class="anchor"></a>Random Sampling of Potential Joint Distributions</h2>
<div class="sourceCode" id="cb67"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">cholesterol_heart_attack_filename</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"samples_of_joints_"</span>, <span class="va">cholesterol_experiment</span><span class="op">$</span><span class="va">id</span>, <span class="st">"_"</span>, <span class="va">heart_attack_experiment</span><span class="op">$</span><span class="va">id</span>, <span class="st">".Rds"</span><span class="op">)</span>

<span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/files.html">file.exists</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="st">"vignettes_data/example_analyses"</span>, <span class="va">cholesterol_heart_attack_filename</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
  <span class="va">cholesterol_heart_attack_samples_of_joints</span> <span class="op">&lt;-</span> <span class="fu">read_rds</span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="st">"vignettes_data/example_analyses"</span>, <span class="va">cholesterol_heart_attack_filename</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span> <span class="kw">else</span> <span class="op">{</span>
  <span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">7892312</span><span class="op">)</span>
  
  <span class="va">cholesterol_heart_attack_samples_of_joints</span> <span class="op">&lt;-</span> <span class="va">cholesterol_heart_attack_bounds</span> <span class="op">%&gt;%</span> 
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rowwise.html">rowwise</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> 
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>pot_covs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="fu"><a href="../reference/potential_covs.html">potential_covs</a></span><span class="op">(</span>thetas <span class="op">=</span> <span class="va">thetas</span>, gammas <span class="op">=</span> <span class="va">gammas</span><span class="op">)</span><span class="op">)</span>,
           sample_joint <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="fu"><a href="../reference/sample_joint_probs.html">sample_joint_probs</a></span><span class="op">(</span><span class="va">pot_covs</span>, n <span class="op">=</span> <span class="fl">500</span>, return_bounds <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
  
  <span class="fu">write_rds</span><span class="op">(</span><span class="va">cholesterol_heart_attack_samples_of_joints</span>, <span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="st">"vignettes_data/example_analyses"</span>, <span class="va">cholesterol_heart_attack_filename</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span>

<span class="va">cholesterol_heart_attack_trivariate_bounds</span> <span class="op">&lt;-</span> <span class="va">cholesterol_heart_attack_samples_of_joints</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">SNP</span>, bivariate_lower <span class="op">=</span> <span class="va">lower</span>, bivariate_upper <span class="op">=</span> <span class="va">upper</span>, <span class="va">sample_joint</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">unnest</span><span class="op">(</span><span class="va">sample_joint</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">unnest</span><span class="op">(</span><span class="va">joint</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">unnest_wider</span><span class="op">(</span><span class="va">bounds</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>contains_zero <span class="op">=</span> <span class="va">lower</span> <span class="op">&lt;</span> <span class="fl">0</span> <span class="op">&amp;</span> <span class="va">upper</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span>

<span class="va">cholesterol_heart_attack_individual_SNPs_plot</span> <span class="op">&lt;-</span> <span class="va">cholesterol_heart_attack_trivariate_bounds</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">SNP</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="va">lower</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>id <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/ranking.html">row_number</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>y <span class="op">=</span> <span class="va">id</span>, color <span class="op">=</span> <span class="va">contains_zero</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">geom_vline</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>xintercept <span class="op">=</span> <span class="va">bivariate_lower</span><span class="op">)</span>,
               linetype <span class="op">=</span> <span class="st">"dashed"</span><span class="op">)</span> <span class="op">+</span>  
    <span class="fu">geom_vline</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>xintercept <span class="op">=</span> <span class="va">bivariate_upper</span><span class="op">)</span>,
               linetype <span class="op">=</span> <span class="st">"dashed"</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">geom_vline</span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">geom_errorbar</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>xmin <span class="op">=</span> <span class="va">lower</span>,
                      xmax <span class="op">=</span> <span class="va">upper</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">geom_point</span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">0</span>, y <span class="op">=</span> <span class="fl">10</span>,
                                 contains_zero <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>,
               <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span><span class="op">)</span>,
               alpha <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">scale_color_manual</span><span class="op">(</span><span class="st">""</span>,
                       values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"grey50"</span>, <span class="st">"red4"</span><span class="op">)</span>,
                       labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Overlaps Zero"</span>, <span class="st">"Does not Overlap Zero"</span><span class="op">)</span>,
                       breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"TRUE"</span>, <span class="st">"FALSE"</span><span class="op">)</span>,
                       drop <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">lims</span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">labs</span><span class="op">(</span>
        x <span class="op">=</span> <span class="st">"ATE"</span>, y <span class="op">=</span> <span class="st">""</span>
    <span class="op">)</span> <span class="op">+</span>
    <span class="fu">coord_fixed</span><span class="op">(</span>ratio <span class="op">=</span> <span class="fl">1</span><span class="op">/</span><span class="fl">350</span><span class="op">)</span> <span class="op">+</span> 
    <span class="fu">facet_wrap</span><span class="op">(</span><span class="op">~</span><span class="va">SNP</span>, ncol <span class="op">=</span> <span class="fl">12</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">theme</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"top"</span>,
          axis.text.y <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,
          axis.ticks.y <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,
          axis.text.x <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">45</span>, hjust <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,
          axis.ticks.x <span class="op">=</span> <span class="fu">element_line</span><span class="op">(</span><span class="op">)</span><span class="op">)</span>

<span class="va">cholesterol_heart_attack_individual_SNPs_plot</span> <span class="op">+</span> 
    <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Possible Trivariate Bounds from Bivariate Data"</span>,
         subtitle <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"Exposure: High Cholesterol (id: "</span>, <span class="va">cholesterol_experiment</span><span class="op">$</span><span class="va">id</span>, <span class="st">"). "</span>,
                           <span class="st">"Outcome: Heart Attack (id: "</span>, <span class="va">heart_attack_experiment</span><span class="op">$</span><span class="va">id</span>, <span class="st">")."</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="example_analysis_files/figure-html/unnamed-chunk-31-1.png" width="700"></p>
<div class="sourceCode" id="cb68"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">ggsave</span><span class="op">(</span>
  plot <span class="op">=</span> <span class="va">cholesterol_heart_attack_individual_SNPs_plot</span>,
  filename <span class="op">=</span> <span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="st">"figures/tiff/example_analyses"</span>, 
                        <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"cholesterol_heart_attack_individual_SNPs_plot_"</span>, <span class="va">cholesterol_experiment</span><span class="op">$</span><span class="va">id</span>, <span class="st">"_"</span>, <span class="va">heart_attack_experiment</span><span class="op">$</span><span class="va">id</span>,<span class="st">".tiff"</span><span class="op">)</span><span class="op">)</span>,
  height <span class="op">=</span> <span class="fl">5.5</span>, width <span class="op">=</span> <span class="fl">10</span>, dpi <span class="op">=</span> <span class="fl">300</span>
<span class="op">)</span>

<span class="fu">ggsave</span><span class="op">(</span>
  plot <span class="op">=</span> <span class="va">cholesterol_heart_attack_individual_SNPs_plot</span>,
  filename <span class="op">=</span> <span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="st">"figures/png/example_analyses"</span>, 
                        <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"cholesterol_heart_attack_individual_SNPs_plot_"</span>, <span class="va">cholesterol_experiment</span><span class="op">$</span><span class="va">id</span>, <span class="st">"_"</span>, <span class="va">heart_attack_experiment</span><span class="op">$</span><span class="va">id</span>,<span class="st">".png"</span><span class="op">)</span><span class="op">)</span>,
  height <span class="op">=</span> <span class="fl">5.5</span>, width <span class="op">=</span> <span class="fl">10</span>, dpi <span class="op">=</span> <span class="fl">300</span>
<span class="op">)</span>


<span class="va">cholesterol_heart_attack_individual_SNPs_plot_subset</span> <span class="op">&lt;-</span> <span class="va">cholesterol_heart_attack_trivariate_bounds</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">SNP</span> <span class="op">%in%</span> <span class="va">cholesterol_SNP_subset</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">SNP</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="va">lower</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>id <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/ranking.html">row_number</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>y <span class="op">=</span> <span class="va">id</span>, color <span class="op">=</span> <span class="va">contains_zero</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">geom_errorbar</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>xmin <span class="op">=</span> <span class="va">lower</span>,
                      xmax <span class="op">=</span> <span class="va">upper</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">geom_point</span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">0</span>, y <span class="op">=</span> <span class="fl">10</span>,
                                 contains_zero <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>,
               <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span><span class="op">)</span>,
               alpha <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">geom_vline</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>xintercept <span class="op">=</span> <span class="va">bivariate_lower</span><span class="op">)</span>,
               linetype <span class="op">=</span> <span class="st">"dashed"</span><span class="op">)</span> <span class="op">+</span>  
    <span class="fu">geom_vline</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>xintercept <span class="op">=</span> <span class="va">bivariate_upper</span><span class="op">)</span>,
               linetype <span class="op">=</span> <span class="st">"dashed"</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">geom_vline</span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">scale_color_manual</span><span class="op">(</span><span class="st">""</span>,
                       values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"grey50"</span>, <span class="st">"red4"</span><span class="op">)</span>,
                       labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Overlaps Zero"</span>, <span class="st">"Does not Overlap Zero"</span><span class="op">)</span>,
                       breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"TRUE"</span>, <span class="st">"FALSE"</span><span class="op">)</span>,
                       drop <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">lims</span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">labs</span><span class="op">(</span>
        x <span class="op">=</span> <span class="st">"ATE"</span>, y <span class="op">=</span> <span class="st">""</span>
    <span class="op">)</span> <span class="op">+</span>
    <span class="fu">coord_fixed</span><span class="op">(</span>ratio <span class="op">=</span> <span class="fl">1</span><span class="op">/</span><span class="fl">350</span><span class="op">)</span> <span class="op">+</span> 
    <span class="fu">facet_wrap</span><span class="op">(</span><span class="op">~</span><span class="va">SNP</span>, ncol <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">theme</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"top"</span>,
          axis.text.y <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,
          axis.ticks.y <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,
          axis.text.x <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span><span class="op">)</span>,
          axis.ticks.x <span class="op">=</span> <span class="fu">element_line</span><span class="op">(</span><span class="op">)</span><span class="op">)</span>

<span class="fu">ggsave</span><span class="op">(</span>
  plot <span class="op">=</span> <span class="va">cholesterol_heart_attack_individual_SNPs_plot_subset</span>,
  filename <span class="op">=</span> <span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="st">"figures/tiff/example_analyses"</span>, 
                        <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"cholesterol_heart_attack_individual_SNPs_plot_subset_"</span>, <span class="va">cholesterol_experiment</span><span class="op">$</span><span class="va">id</span>, <span class="st">"_"</span>, <span class="va">heart_attack_experiment</span><span class="op">$</span><span class="va">id</span>,<span class="st">".tiff"</span><span class="op">)</span><span class="op">)</span>,
  width <span class="op">=</span> <span class="fl">4</span>, height <span class="op">=</span> <span class="fl">6</span>, dpi <span class="op">=</span> <span class="fl">300</span>
<span class="op">)</span>

<span class="fu">ggsave</span><span class="op">(</span>
  plot <span class="op">=</span> <span class="va">cholesterol_heart_attack_individual_SNPs_plot_subset</span>,
  filename <span class="op">=</span> <span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="st">"figures/png/example_analyses"</span>, 
                        <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"cholesterol_heart_attack_individual_SNPs_plot_subset_"</span>, <span class="va">cholesterol_experiment</span><span class="op">$</span><span class="va">id</span>, <span class="st">"_"</span>, <span class="va">heart_attack_experiment</span><span class="op">$</span><span class="va">id</span>,<span class="st">".png"</span><span class="op">)</span><span class="op">)</span>,
  width <span class="op">=</span> <span class="fl">4</span>, height <span class="op">=</span> <span class="fl">6</span>, dpi <span class="op">=</span> <span class="fl">300</span>
<span class="op">)</span>


<span class="va">cholesterol_heart_attack_filename_mono</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"samples_of_joints_mono_"</span>, <span class="va">smoking_experiment</span><span class="op">$</span><span class="va">id</span>, <span class="st">"_"</span>, <span class="va">lung_cancer_experiment</span><span class="op">$</span><span class="va">id</span>, <span class="st">".Rds"</span><span class="op">)</span>

<span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/files.html">file.exists</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="st">"vignettes_data/example_analyses"</span>, <span class="va">cholesterol_heart_attack_filename_mono</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
  <span class="va">cholesterol_heart_attack_samples_of_joints_mono</span> <span class="op">&lt;-</span> <span class="fu">read_rds</span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="st">"vignettes_data/example_analyses"</span>,
                                                                   <span class="va">cholesterol_heart_attack_filename_mono</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span> <span class="kw">else</span> <span class="op">{</span>
  <span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">6925896</span><span class="op">)</span>
  <span class="va">cholesterol_heart_attack_samples_of_joints_mono</span> <span class="op">&lt;-</span> <span class="va">cholesterol_heart_attack_bounds</span> <span class="op">%&gt;%</span> 
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span><span class="va">constraints_violated_mono</span><span class="op">)</span> <span class="op">%&gt;%</span> 
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>i <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/ranking.html">row_number</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rowwise.html">rowwise</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> 
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>pot_covs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="fu"><a href="../reference/potential_covs.html">potential_covs</a></span><span class="op">(</span>thetas <span class="op">=</span> <span class="va">thetas</span>, gammas <span class="op">=</span> <span class="va">gammas</span>, x_mono <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span>,
           sample_joint <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="fu"><a href="../reference/sample_joint_probs.html">sample_joint_probs</a></span><span class="op">(</span><span class="va">pot_covs</span>, n <span class="op">=</span> <span class="fl">500</span>, return_bounds <span class="op">=</span> <span class="cn">TRUE</span>,
                                                  x_mono <span class="op">=</span> <span class="cn">TRUE</span>, print_progress <span class="op">=</span> <span class="cn">FALSE</span>,
                                                  print_as_progress <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
  
  <span class="fu">write_rds</span><span class="op">(</span><span class="va">cholesterol_heart_attack_samples_of_joints_mono</span>,
            <span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="st">"vignettes_data/example_analyses"</span>,
                       <span class="va">cholesterol_heart_attack_filename_mono</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span>

<span class="va">cholesterol_heart_attack_trivariate_mono_bounds</span> <span class="op">&lt;-</span> <span class="va">cholesterol_heart_attack_samples_of_joints_mono</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">SNP</span>, bivariate_lower <span class="op">=</span> <span class="va">lower_mono</span>, bivariate_upper <span class="op">=</span> <span class="va">upper_mono</span>, <span class="va">sample_joint</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">unnest</span><span class="op">(</span><span class="va">sample_joint</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">unnest</span><span class="op">(</span><span class="va">joint</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">unnest_wider</span><span class="op">(</span><span class="va">bounds</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>contains_zero <span class="op">=</span> <span class="va">lower</span> <span class="op">&lt;</span> <span class="fl">0</span> <span class="op">&amp;</span> <span class="va">upper</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span>

<span class="va">cholesterol_heart_attack_individual_SNPs_mono_plot</span> <span class="op">&lt;-</span> <span class="va">cholesterol_heart_attack_trivariate_mono_bounds</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">SNP</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="va">lower</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>id <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/ranking.html">row_number</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">id</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">geom_hline</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>yintercept <span class="op">=</span> <span class="va">bivariate_lower</span><span class="op">)</span>,
               linetype <span class="op">=</span> <span class="st">"dashed"</span><span class="op">)</span> <span class="op">+</span>  
    <span class="fu">geom_hline</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>yintercept <span class="op">=</span> <span class="va">bivariate_upper</span><span class="op">)</span>,
               linetype <span class="op">=</span> <span class="st">"dashed"</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">geom_hline</span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">geom_errorbar</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>ymin <span class="op">=</span> <span class="va">lower</span>,
                      ymax <span class="op">=</span> <span class="va">upper</span>,
                      color <span class="op">=</span> <span class="va">contains_zero</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">scale_color_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"red4"</span>, <span class="st">"grey50"</span><span class="op">)</span>,
                       breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="cn">FALSE</span>, <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
    <span class="fu">lims</span><span class="op">(</span>y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
    <span class="fu">coord_fixed</span><span class="op">(</span>ratio <span class="op">=</span> <span class="fl">500</span><span class="op">/</span><span class="fl">2</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">facet_wrap</span><span class="op">(</span><span class="op">~</span><span class="va">SNP</span>, nrow <span class="op">=</span> <span class="fl">7</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Possible Trivariate Bounds from Bivariate Data assuming Monotonicity"</span>,
         subtitle <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"Exposure: High Cholesterol (id: "</span>, <span class="va">cholesterol_experiment</span><span class="op">$</span><span class="va">id</span>, <span class="st">"). "</span>,
                           <span class="st">"Outcome: Heart Attack (id: "</span>, <span class="va">heart_attack_experiment</span><span class="op">$</span><span class="va">id</span>, <span class="st">")."</span><span class="op">)</span><span class="op">)</span>

<span class="va">cholesterol_heart_attack_individual_SNPs_mono_plot</span></code></pre></div>
<p><img src="example_analysis_files/figure-html/unnamed-chunk-31-2.png" width="700"></p>
</div>
<div id="intersections-of-bounds-from-randomly-sampled-joint-distributions-1" class="section level2">
<h2 class="hasAnchor">
<a href="#intersections-of-bounds-from-randomly-sampled-joint-distributions-1" class="anchor"></a>Intersections of Bounds from Randomly Sampled Joint Distributions</h2>
<div class="sourceCode" id="cb69"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">cholesterol_heart_attack_pairs_of_snps</span> <span class="op">&lt;-</span> <span class="fu">expand_grid</span><span class="op">(</span>SNP1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">cholesterol_heart_attack_trivariate_bounds</span><span class="op">$</span><span class="va">SNP</span><span class="op">)</span>,
                                                      SNP2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">cholesterol_heart_attack_trivariate_bounds</span><span class="op">$</span><span class="va">SNP</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">SNP1</span> <span class="op">!=</span> <span class="va">SNP2</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rowwise.html">rowwise</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span><span class="op">(</span>SNPs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sort.html">sort</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">SNP1</span>, <span class="va">SNP2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/duplicated.html">duplicated</a></span><span class="op">(</span><span class="va">SNPs</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>SNPs <span class="op">=</span> <span class="fu">map</span><span class="op">(</span><span class="va">SNPs</span>, <span class="op">~</span><span class="fu">tibble_row</span><span class="op">(</span>SNP1 <span class="op">=</span> <span class="va">.x</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, SNP2 <span class="op">=</span> <span class="va">.x</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">unnest_wider</span><span class="op">(</span><span class="va">SNPs</span><span class="op">)</span></code></pre></div>
<pre><code>## `summarise()` has ungrouped output. You can override using the `.groups` argument.</code></pre>
<div class="sourceCode" id="cb71"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">cholesterol_heart_attack_pairs_of_snps</span></code></pre></div>
<pre><code>## # A tibble: 1,431 x 2
##    SNP1       SNP2      
##    &lt;chr&gt;      &lt;chr&gt;     
##  1 rs10096633 rs10260606
##  2 rs10096633 rs10410835
##  3 rs10260606 rs10410835
##  4 rs10096633 rs10504255
##  5 rs10260606 rs10504255
##  6 rs10410835 rs10504255
##  7 rs10096633 rs10804330
##  8 rs10260606 rs10804330
##  9 rs10410835 rs10804330
## 10 rs10504255 rs10804330
## # … with 1,421 more rows</code></pre>
<div class="sourceCode" id="cb73"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">493637</span><span class="op">)</span>

<span class="va">cholesterol_heart_attack_chosen_pairs</span> <span class="op">&lt;-</span> <span class="va">cholesterol_heart_attack_pairs_of_snps</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/sample_n.html">sample_n</a></span><span class="op">(</span><span class="fl">8</span><span class="op">)</span>

<span class="fu">pander</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/pander/man/pander.html">pander</a></span><span class="op">(</span><span class="va">cholesterol_heart_attack_chosen_pairs</span><span class="op">)</span></code></pre></div>
<table class="table">
<colgroup>
<col width="18%">
<col width="18%">
</colgroup>
<thead><tr class="header">
<th align="center">SNP1</th>
<th align="center">SNP2</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">rs11591147</td>
<td align="center">rs3127580</td>
</tr>
<tr class="even">
<td align="center">rs4704727</td>
<td align="center">rs58691354</td>
</tr>
<tr class="odd">
<td align="center">rs12916</td>
<td align="center">rs34042070</td>
</tr>
<tr class="even">
<td align="center">rs12916</td>
<td align="center">rs58542926</td>
</tr>
<tr class="odd">
<td align="center">rs1260326</td>
<td align="center">rs4470903</td>
</tr>
<tr class="even">
<td align="center">rs28807203</td>
<td align="center">rs73534263</td>
</tr>
<tr class="odd">
<td align="center">rs3918226</td>
<td align="center">rs7534572</td>
</tr>
<tr class="even">
<td align="center">rs28601761</td>
<td align="center">rs635634</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb74"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">cholesterol_heart_attack_both_bounds</span> <span class="op">&lt;-</span> <span class="va">cholesterol_heart_attack_chosen_pairs</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rowwise.html">rowwise</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>
    SNP1_bounds <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
      <span class="va">cholesterol_heart_attack_trivariate_bounds</span> <span class="op">%&gt;%</span> 
        <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">SNP</span> <span class="op">==</span> <span class="va">SNP1</span><span class="op">)</span> <span class="op">%&gt;%</span> 
        <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span>SNP1_bivariate_lower <span class="op">=</span> <span class="va">bivariate_lower</span>, SNP1_bivariate_upper <span class="op">=</span> <span class="va">bivariate_upper</span>, 
               SNP1_lower <span class="op">=</span> <span class="va">lower</span>, SNP1_upper <span class="op">=</span> <span class="va">upper</span><span class="op">)</span>
    <span class="op">)</span>,
    SNP2_bounds <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
      <span class="va">cholesterol_heart_attack_trivariate_bounds</span> <span class="op">%&gt;%</span> 
        <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">SNP</span> <span class="op">==</span> <span class="va">SNP2</span><span class="op">)</span> <span class="op">%&gt;%</span> 
        <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span>SNP2_bivariate_lower <span class="op">=</span> <span class="va">bivariate_lower</span>, SNP2_bivariate_upper <span class="op">=</span> <span class="va">bivariate_upper</span>,
               SNP2_lower <span class="op">=</span> <span class="va">lower</span>, SNP2_upper <span class="op">=</span> <span class="va">upper</span><span class="op">)</span>
    <span class="op">)</span>
  <span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">unnest</span><span class="op">(</span>cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">SNP1_bounds</span>, <span class="va">SNP2_bounds</span><span class="op">)</span><span class="op">)</span>

<span class="va">cholesterol_heart_attack_both_bounds</span></code></pre></div>
<pre><code>## # A tibble: 4,000 x 10
##    SNP1  SNP2  SNP1_bivariate_… SNP1_bivariate_… SNP1_lower SNP1_upper
##    &lt;chr&gt; &lt;chr&gt;            &lt;dbl&gt;            &lt;dbl&gt;      &lt;dbl&gt;      &lt;dbl&gt;
##  1 rs11… rs31…           -0.146            0.901    -0.105       0.865
##  2 rs11… rs31…           -0.146            0.901    -0.112       0.859
##  3 rs11… rs31…           -0.146            0.901    -0.0997      0.856
##  4 rs11… rs31…           -0.146            0.901    -0.113       0.883
##  5 rs11… rs31…           -0.146            0.901    -0.125       0.855
##  6 rs11… rs31…           -0.146            0.901    -0.128       0.856
##  7 rs11… rs31…           -0.146            0.901    -0.106       0.870
##  8 rs11… rs31…           -0.146            0.901    -0.119       0.854
##  9 rs11… rs31…           -0.146            0.901    -0.102       0.858
## 10 rs11… rs31…           -0.146            0.901    -0.123       0.873
## # … with 3,990 more rows, and 4 more variables: SNP2_bivariate_lower &lt;dbl&gt;,
## #   SNP2_bivariate_upper &lt;dbl&gt;, SNP2_lower &lt;dbl&gt;, SNP2_upper &lt;dbl&gt;</code></pre>
<div class="sourceCode" id="cb76"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">cholesterol_heart_attack_intersection_bounds</span> <span class="op">&lt;-</span> <span class="va">cholesterol_heart_attack_both_bounds</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rowwise.html">rowwise</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>intersection_lower <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">SNP1_lower</span>, <span class="va">SNP2_lower</span><span class="op">)</span>,
         intersection_upper <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">SNP1_upper</span>, <span class="va">SNP2_upper</span><span class="op">)</span>,
         bivariate_intersection_lower <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">SNP1_bivariate_lower</span>, <span class="va">SNP2_bivariate_lower</span><span class="op">)</span>,
         bivariate_intersection_upper <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">SNP1_bivariate_upper</span>, <span class="va">SNP2_bivariate_upper</span><span class="op">)</span>,
  <span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>contains_zero <span class="op">=</span> <span class="va">intersection_lower</span> <span class="op">&lt;</span> <span class="fl">0</span> <span class="op">&amp;</span> <span class="va">intersection_upper</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span>

<span class="va">cholesterol_heart_attack_intersection_bounds_plot</span> <span class="op">&lt;-</span> <span class="va">cholesterol_heart_attack_intersection_bounds</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">SNP1</span>, <span class="va">SNP2</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="va">intersection_lower</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>i <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/ranking.html">row_number</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>y <span class="op">=</span> <span class="va">i</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
    <span class="fu">geom_vline</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>xintercept <span class="op">=</span> <span class="va">bivariate_intersection_lower</span><span class="op">)</span>,
               linetype <span class="op">=</span> <span class="st">"dashed"</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">geom_vline</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>xintercept <span class="op">=</span> <span class="va">bivariate_intersection_upper</span><span class="op">)</span>,
               linetype <span class="op">=</span> <span class="st">"dashed"</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">geom_errorbar</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>xmin <span class="op">=</span> <span class="va">intersection_lower</span>,
                      xmax <span class="op">=</span> <span class="va">intersection_upper</span>,
                      color <span class="op">=</span> <span class="va">contains_zero</span><span class="op">)</span>,
                  alpha <span class="op">=</span> <span class="fl">0.7</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">geom_point</span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">0</span>, y <span class="op">=</span> <span class="fl">10</span>,
                                 contains_zero <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>,
               <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>, color <span class="op">=</span> <span class="va">contains_zero</span><span class="op">)</span>,
               alpha <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">scale_color_manual</span><span class="op">(</span><span class="st">""</span>,
                       values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"grey50"</span>, <span class="st">"red4"</span><span class="op">)</span>,
                       labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Overlaps Zero"</span>, <span class="st">"Does not Overlap Zero"</span><span class="op">)</span>,
                       breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"TRUE"</span>, <span class="st">"FALSE"</span><span class="op">)</span>,
                       drop <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">lims</span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
    <span class="fu">coord_fixed</span><span class="op">(</span>ratio <span class="op">=</span> <span class="fl">1</span><span class="op">/</span><span class="fl">350</span><span class="op">)</span> <span class="op">+</span> 
    <span class="fu">geom_vline</span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">facet_wrap</span><span class="op">(</span><span class="op">~</span><span class="va">SNP1</span> <span class="op">+</span> <span class="va">SNP2</span>,
               nrow <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">labs</span><span class="op">(</span>
      y <span class="op">=</span> <span class="st">""</span>, x <span class="op">=</span> <span class="st">"ATE"</span>
    <span class="op">)</span> <span class="op">+</span>
    <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">theme</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"top"</span>,
          axis.text.x <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span><span class="op">)</span>,
          axis.ticks.x <span class="op">=</span> <span class="fu">element_line</span><span class="op">(</span><span class="op">)</span>,
          axis.text.y <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,
          axis.ticks.y <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span><span class="op">)</span>

<span class="fu">ggsave</span><span class="op">(</span>
  plot <span class="op">=</span> <span class="va">cholesterol_heart_attack_intersection_bounds_plot</span>,
  filename <span class="op">=</span> <span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="st">"figures/png/example_analyses"</span>, 
                        <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"cholesterol_heart_attack_intersection_bounds_plot_"</span>, <span class="va">cholesterol_experiment</span><span class="op">$</span><span class="va">id</span>, <span class="st">"_"</span>, <span class="va">heart_attack_experiment</span><span class="op">$</span><span class="va">id</span>,<span class="st">".png"</span><span class="op">)</span><span class="op">)</span>,
  width <span class="op">=</span> <span class="fl">8</span>, height <span class="op">=</span> <span class="fl">6</span>, dpi <span class="op">=</span> <span class="fl">300</span>
<span class="op">)</span>

<span class="fu">ggsave</span><span class="op">(</span>
  plot <span class="op">=</span> <span class="va">cholesterol_heart_attack_intersection_bounds_plot</span>,
  filename <span class="op">=</span> <span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="st">"figures/tiff/example_analyses"</span>, 
                        <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"cholesterol_heart_attack_intersection_bounds_plot_"</span>, <span class="va">cholesterol_experiment</span><span class="op">$</span><span class="va">id</span>, <span class="st">"_"</span>, <span class="va">heart_attack_experiment</span><span class="op">$</span><span class="va">id</span>,<span class="st">".tiff"</span><span class="op">)</span><span class="op">)</span>,
  width <span class="op">=</span> <span class="fl">8</span>, height <span class="op">=</span> <span class="fl">6</span>, dpi <span class="op">=</span> <span class="fl">300</span>
<span class="op">)</span>



<span class="va">cholesterol_heart_attack_intersection_bounds_plot</span> <span class="op">+</span>
    <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Intersections of Possible Trivariate Bounds from Bivariate Data"</span>,
         subtitle <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"Exposure: High Cholesterol (id: "</span>, <span class="va">cholesterol_experiment</span><span class="op">$</span><span class="va">id</span>, <span class="st">"). "</span>,
                           <span class="st">"Outcome: Heart Attack (id: "</span>, <span class="va">heart_attack_experiment</span><span class="op">$</span><span class="va">id</span>, <span class="st">")."</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="example_analysis_files/figure-html/unnamed-chunk-32-1.png" width="700"></p>
</div>
</div>
<div id="save-experiment-information" class="section level1">
<h1 class="hasAnchor">
<a href="#save-experiment-information" class="anchor"></a>Save Experiment Information</h1>
<div class="sourceCode" id="cb77"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">write_csv</span><span class="op">(</span>x <span class="op">=</span> 
            <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind.html">bind_rows</a></span><span class="op">(</span>
              <span class="va">smoking_experiment</span>,
              <span class="va">lung_cancer_experiment</span>,
              <span class="va">cholesterol_experiment</span>,
              <span class="va">heart_attack_experiment</span>
            <span class="op">)</span>,
          file <span class="op">=</span> <span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="st">"vignettes_data/example_analyses/experiment_info.csv"</span><span class="op">)</span>
<span class="op">)</span></code></pre></div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Ralph Møller Trane.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
