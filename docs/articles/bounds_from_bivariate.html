<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Bounds using Two-Sample Data • Bounds in Two-Sample Mendelian Randomization With Summary Statistics</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Bounds using Two-Sample Data">
<meta property="og:description" content="Obtaining bounds on the ATE using two-sample data.">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">Bounds in Two-Sample Mendelian Randomization With Summary Statistics</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/ATEBounds.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li class="divider">
    <li class="dropdown-header">Exploration of Bounds</li>
    <li>
      <a href="../articles/bounds_from_bivariate.html">Bounds using Two-Sample Data</a>
    </li>
    <li>
      <a href="../articles/bounds_from_trivariate.html">Utilize two-sample data two get potential one-sample bounds</a>
    </li>
    <li class="divider">
    <li class="dropdown-header">"Power" analysis</li>
    <li>
      <a href="../articles/power_sims.html">"Power" Simulations</a>
    </li>
    <li>
      <a href="../articles/power_sims_figures.html">"Power" Figures</a>
    </li>
    <li class="divider">
    <li class="dropdown-header">Two-Sample Bounds using Multiple Instruments</li>
    <li>
      <a href="../articles/multiple_IVs_sims.html">Multiple IVs: Simulations</a>
    </li>
    <li>
      <a href="../articles/multiple_IVs_figures.html">Multiple IVs: Figures</a>
    </li>
    <li class="divider">
    <li class="dropdown-header">Example Analysis using `TwoSampleMR`</li>
    <li>
      <a href="../articles/example_analysis.html">Example Analysis of Data from the IEU GWAS Database</a>
    </li>
    <li class="divider">
    <li class="dropdown-header">Other</li>
    <li>
      <a href="../articles/polymake_example.html">Polymake Example</a>
    </li>
    <li>
      <a href="../articles/get_bounds.html">How to use the `get_bounds` function</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/rmtrane/ATEBounds/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="bounds_from_bivariate_files/header-attrs-2.6/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Bounds using Two-Sample Data</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/rmtrane/ATEBounds/blob/master/vignettes/bounds_from_bivariate.Rmd"><code>vignettes/bounds_from_bivariate.Rmd</code></a></small>
      <div class="hidden name"><code>bounds_from_bivariate.Rmd</code></div>

    </div>

    
    
<p>Here we will see how bounds on the ATE behaves when derived from a single IV in two-sample data. We know that the width of the bounds is bounded above by <span class="math inline">\(2\cdot (1 - ST_X)\)</span>, when monotonicity of the effect of <span class="math inline">\(Z\)</span> on both <span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span> holds. Here, we will see through simulations, that the same seems to hold without these assumptions.</p>
<div id="generate-distributions" class="section level2">
<h2 class="hasAnchor">
<a href="#generate-distributions" class="anchor"></a>Generate Distributions</h2>
<p>We will consider IVs that take three levels. To generate values of <span class="math inline">\(P(X = 1 | Z = z)\)</span> we simply choose three values from a uniform distribution. The matrices obtained from the polymake program give us some constraints on the values of <span class="math inline">\(P(Y = 1 | Z = z)\)</span>. These are included below.</p>
<div class="sourceCode" id="cb1"><pre class="downlit">
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://tidyverse.tidyverse.org">tidyverse</a></span>, quietly <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>

<span class="fu">ATEBounds</span><span class="fu">:::</span><span class="va">matrices_from_polymake</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span><span class="va">x_monotone</span>, <span class="op">!</span><span class="va">y_monotone</span>,
         <span class="va">data_format</span> <span class="op">==</span> <span class="st">"bivariate"</span>, 
         <span class="va">n_z_levels</span> <span class="op">==</span> <span class="fl">3</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html">pull</a></span><span class="op">(</span><span class="va">matrix</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="va">.</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">alpha</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="fu">where</span><span class="op">(</span><span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="va">.x</span><span class="op">)</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html">rowSums</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">1</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">pander</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/pander/man/pander.html">pander</a></span><span class="op">(</span><span class="op">)</span></pre></div>
<table class="table">
<colgroup>
<col width="13%">
<col width="13%">
<col width="13%">
<col width="13%">
<col width="13%">
<col width="13%">
<col width="13%">
</colgroup>
<thead><tr class="header">
<th align="center">gamma01</th>
<th align="center">gamma02</th>
<th align="center">gamma03</th>
<th align="center">gamma11</th>
<th align="center">theta11</th>
<th align="center">theta12</th>
<th align="center">theta13</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">1</td>
<td align="center">0</td>
<td align="center">-1</td>
<td align="center">1</td>
<td align="center">0</td>
<td align="center">0</td>
<td align="center">0</td>
</tr>
<tr class="even">
<td align="center">1</td>
<td align="center">-1</td>
<td align="center">0</td>
<td align="center">1</td>
<td align="center">0</td>
<td align="center">0</td>
<td align="center">0</td>
</tr>
<tr class="odd">
<td align="center">1</td>
<td align="center">-1</td>
<td align="center">0</td>
<td align="center">0</td>
<td align="center">1</td>
<td align="center">1</td>
<td align="center">0</td>
</tr>
<tr class="even">
<td align="center">1</td>
<td align="center">0</td>
<td align="center">-1</td>
<td align="center">0</td>
<td align="center">1</td>
<td align="center">0</td>
<td align="center">1</td>
</tr>
<tr class="odd">
<td align="center">3</td>
<td align="center">-1</td>
<td align="center">0</td>
<td align="center">2</td>
<td align="center">-1</td>
<td align="center">-1</td>
<td align="center">0</td>
</tr>
<tr class="even">
<td align="center">3</td>
<td align="center">0</td>
<td align="center">-1</td>
<td align="center">2</td>
<td align="center">-1</td>
<td align="center">0</td>
<td align="center">-1</td>
</tr>
<tr class="odd">
<td align="center">1</td>
<td align="center">0</td>
<td align="center">0</td>
<td align="center">1</td>
<td align="center">0</td>
<td align="center">-1</td>
<td align="center">0</td>
</tr>
<tr class="even">
<td align="center">1</td>
<td align="center">0</td>
<td align="center">0</td>
<td align="center">1</td>
<td align="center">0</td>
<td align="center">0</td>
<td align="center">-1</td>
</tr>
<tr class="odd">
<td align="center">2</td>
<td align="center">1</td>
<td align="center">-1</td>
<td align="center">2</td>
<td align="center">0</td>
<td align="center">-1</td>
<td align="center">-1</td>
</tr>
<tr class="even">
<td align="center">2</td>
<td align="center">-1</td>
<td align="center">1</td>
<td align="center">2</td>
<td align="center">0</td>
<td align="center">-1</td>
<td align="center">-1</td>
</tr>
<tr class="odd">
<td align="center">1</td>
<td align="center">1</td>
<td align="center">0</td>
<td align="center">2</td>
<td align="center">-1</td>
<td align="center">-1</td>
<td align="center">0</td>
</tr>
<tr class="even">
<td align="center">0</td>
<td align="center">1</td>
<td align="center">-1</td>
<td align="center">0</td>
<td align="center">0</td>
<td align="center">1</td>
<td align="center">1</td>
</tr>
<tr class="odd">
<td align="center">0</td>
<td align="center">-1</td>
<td align="center">1</td>
<td align="center">0</td>
<td align="center">0</td>
<td align="center">1</td>
<td align="center">1</td>
</tr>
<tr class="even">
<td align="center">1</td>
<td align="center">0</td>
<td align="center">0</td>
<td align="center">1</td>
<td align="center">-1</td>
<td align="center">0</td>
<td align="center">0</td>
</tr>
<tr class="odd">
<td align="center">-1</td>
<td align="center">0</td>
<td align="center">1</td>
<td align="center">0</td>
<td align="center">1</td>
<td align="center">0</td>
<td align="center">1</td>
</tr>
<tr class="even">
<td align="center">-1</td>
<td align="center">1</td>
<td align="center">0</td>
<td align="center">0</td>
<td align="center">1</td>
<td align="center">1</td>
<td align="center">0</td>
</tr>
<tr class="odd">
<td align="center">1</td>
<td align="center">0</td>
<td align="center">1</td>
<td align="center">2</td>
<td align="center">-1</td>
<td align="center">0</td>
<td align="center">-1</td>
</tr>
</tbody>
</table>
<p>The function <code>simulate_gammas_from_thetas</code> takes a vector of length 3 of values of <span class="math inline">\(P(X = 1 | Z = z)\)</span>, and returns a vector of length 3 of values of <span class="math inline">\(P(Y = 1 | Z = z)\)</span> such that no constraint is violated. The comments in the function below refer to the corresponding row in the matrix of verifiable constraints above.</p>
<div class="sourceCode" id="cb2"><pre class="downlit">
<span class="va">simulate_gammas_from_thetas</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">thetas</span><span class="op">)</span><span class="op">{</span>

  <span class="va">gammas</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html">vector</a></span><span class="op">(</span><span class="st">"numeric"</span>, length <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>

  <span class="va">gammas</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>

  <span class="va">gammas</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span><span class="fl">1</span>,
                     min <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="fl">0</span>,
                               <span class="va">gammas</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">-</span> <span class="va">thetas</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">-</span> <span class="va">thetas</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, <span class="co"># row 3</span>
                               <span class="va">gammas</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">+</span> <span class="va">thetas</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">+</span> <span class="va">thetas</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">-</span> <span class="fl">2</span><span class="op">)</span>, <span class="co"># row 5</span>
                     max <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="fl">1</span>,
                               <span class="va">gammas</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">-</span> <span class="va">thetas</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">-</span> <span class="va">thetas</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">+</span> <span class="fl">2</span>, <span class="co"># row 11</span>
                               <span class="va">gammas</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">+</span> <span class="va">thetas</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">+</span> <span class="va">thetas</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span> <span class="co"># row 16</span>
                     <span class="op">)</span>

  <span class="va">gammas</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span><span class="fl">1</span>,
                     min <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="fl">0</span>,
                               <span class="va">gammas</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">-</span> <span class="va">thetas</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">-</span> <span class="va">thetas</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span>, <span class="co"># row 4</span>
                               <span class="va">gammas</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">+</span> <span class="va">thetas</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">+</span> <span class="va">thetas</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span> <span class="op">-</span> <span class="fl">2</span>, <span class="co"># row 6</span>
                               <span class="va">gammas</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">-</span> <span class="va">thetas</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">-</span> <span class="va">thetas</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span>, <span class="co"># row 12</span>
                               <span class="va">gammas</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">+</span> <span class="va">thetas</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">+</span> <span class="va">thetas</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span> <span class="op">-</span> <span class="fl">2</span><span class="op">)</span>, <span class="co"># row 9</span>
                     max <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="fl">1</span>,
                               <span class="va">gammas</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">-</span> <span class="va">thetas</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">-</span> <span class="va">thetas</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span> <span class="op">+</span> <span class="fl">2</span>, <span class="co"># row 10</span>
                               <span class="va">gammas</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">+</span> <span class="va">thetas</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">+</span> <span class="va">thetas</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span>, <span class="co"># row 13</span>
                               <span class="va">gammas</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">-</span> <span class="va">thetas</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">-</span> <span class="va">thetas</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span> <span class="op">+</span> <span class="fl">2</span>, <span class="co"># row 17</span>
                               <span class="va">gammas</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">+</span> <span class="va">thetas</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">+</span> <span class="va">thetas</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="co"># row 15</span>
  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">gammas</span><span class="op">)</span>
<span class="op">}</span></pre></div>
<p>We generate <span class="math inline">\(10,000\)</span> sets of distributions.</p>
<div class="sourceCode" id="cb3"><pre class="downlit">
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/rmtrane/ATEBounds">ATEBounds</a></span><span class="op">)</span>


<span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">7226637</span><span class="op">)</span>
<span class="va">sim_probs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span>j <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">10000</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>thetas <span class="op">=</span> <span class="fu">map</span><span class="op">(</span><span class="va">j</span>, <span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">3</span>, min <span class="op">=</span> <span class="fl">0</span>, max <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span>, 
         gammas <span class="op">=</span> <span class="fu">map</span><span class="op">(</span><span class="va">thetas</span>, <span class="va">simulate_gammas_from_thetas</span><span class="op">)</span><span class="op">)</span></pre></div>
</div>
<div id="get-strength-and-bounds-" class="section level2">
<h2 class="hasAnchor">
<a href="#get-strength-and-bounds-" class="anchor"></a>Get Strength and Bounds.</h2>
<p>Here, we define the strength of <span class="math inline">\(Z\)</span> on <span class="math inline">\(X\)</span> as <span class="math inline">\(\max_{z_1,z_2} \left | P(X = 1 | Z = z_1) - P(X = 1 | Z = z_2) \right |\)</span>, and the strength of <span class="math inline">\(Z\)</span> on <span class="math inline">\(Y\)</span> similarly as <span class="math inline">\(\max_{z_1,z_2} \left | P(Y = 1 | Z = z_1) - P(Y = 1 | Z = z_2) \right |\)</span>.</p>
<p>We then calculate the strength of <span class="math inline">\(Z\)</span> on <span class="math inline">\(X\)</span>, <span class="math inline">\(Z\)</span> on <span class="math inline">\(Y\)</span>, and find the bounds. This is where we notice that some of the probability distributions result in bounds with an upper bound that is less than the lower bound. We generate extra random distributions such that the total number of distributions with correctly ordered bounds is <span class="math inline">\(10,000\)</span>.</p>
<div class="sourceCode" id="cb4"><pre class="downlit">
<span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/files.html">file.exists</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/here/man/here.html">here</a></span><span class="op">(</span><span class="st">"vignettes_data/bivariate_bounds.Rds"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
  <span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/DavisVaughan/furrr">furrr</a></span><span class="op">)</span>
  
  <span class="fu">plan</span><span class="op">(</span><span class="va">multisession</span>, workers <span class="op">=</span> <span class="va">n_cores</span><span class="op">)</span>
  
  <span class="va">bounds</span> <span class="op">&lt;-</span> <span class="va">sim_probs</span> <span class="op">%&gt;%</span> 
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>strength_x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/furrr/man/future_map.html">future_map_dbl</a></span><span class="op">(</span><span class="va">thetas</span>, <span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/outer.html">outer</a></span><span class="op">(</span><span class="va">.x</span>, <span class="va">.x</span>, <span class="va">`-`</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,
           strength_y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/furrr/man/future_map.html">future_map_dbl</a></span><span class="op">(</span><span class="va">gammas</span>, <span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/outer.html">outer</a></span><span class="op">(</span><span class="va">.x</span>, <span class="va">.x</span>, <span class="va">`-`</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,
           bounds <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/furrr/man/future_map2.html">future_map2</a></span><span class="op">(</span><span class="va">thetas</span>, <span class="va">gammas</span>,
                                <span class="op">~</span><span class="fu"><a href="../reference/get_bounds.html">get_bounds</a></span><span class="op">(</span>thetas <span class="op">=</span> <span class="va">.x</span>,
                                            gammas <span class="op">=</span> <span class="va">.y</span>,
                                            stop <span class="op">=</span> <span class="cn">FALSE</span>, 
                                            warning <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span>,
           violations <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/furrr/man/future_map.html">future_map_lgl</a></span><span class="op">(</span><span class="va">bounds</span>, <span class="st">"constraints_violated"</span><span class="op">)</span>,
           intervals <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/furrr/man/future_map.html">future_map</a></span><span class="op">(</span><span class="va">bounds</span>, <span class="st">"interval"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
    <span class="fu">unnest_wider</span><span class="op">(</span><span class="va">intervals</span><span class="op">)</span> <span class="op">%&gt;%</span> 
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>width <span class="op">=</span> <span class="va">upper</span> <span class="op">-</span> <span class="va">lower</span><span class="op">)</span>
  
  <span class="va">n_extras</span> <span class="op">&lt;-</span> <span class="fl">0</span>
  
  <span class="kw">while</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">bounds</span><span class="op">$</span><span class="va">width</span> <span class="op">&gt;=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">&lt;</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">sim_probs</span><span class="op">)</span> <span class="op">&amp;</span> <span class="va">n_extras</span> <span class="op">&lt;</span> <span class="fl">100</span><span class="op">)</span><span class="op">{</span>
    <span class="va">n_extras</span> <span class="op">&lt;-</span> <span class="va">n_extras</span> <span class="op">+</span> <span class="fl">1</span>
    
    <span class="fu">plan</span><span class="op">(</span><span class="va">multisession</span>, workers <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>
    
    <span class="va">bounds_extra</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span>j <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">bounds</span><span class="op">)</span> <span class="op">+</span> <span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">sim_probs</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">bounds</span><span class="op">$</span><span class="va">width</span> <span class="op">&gt;=</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>thetas <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/furrr/man/future_map.html">future_map</a></span><span class="op">(</span><span class="va">j</span>, <span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">3</span>, min <span class="op">=</span> <span class="fl">0</span>, max <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>, .options <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/furrr/man/furrr_options.html">furrr_options</a></span><span class="op">(</span>seed <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span>, 
             gammas <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/furrr/man/future_map.html">future_map</a></span><span class="op">(</span><span class="va">thetas</span>, <span class="va">simulate_gammas_from_thetas</span>, .options <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/furrr/man/furrr_options.html">furrr_options</a></span><span class="op">(</span>seed <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span>,
             strength_x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/furrr/man/future_map.html">future_map_dbl</a></span><span class="op">(</span><span class="va">thetas</span>, <span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/outer.html">outer</a></span><span class="op">(</span><span class="va">.x</span>, <span class="va">.x</span>, <span class="va">`-`</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,
             strength_y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/furrr/man/future_map.html">future_map_dbl</a></span><span class="op">(</span><span class="va">gammas</span>, <span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/outer.html">outer</a></span><span class="op">(</span><span class="va">.x</span>, <span class="va">.x</span>, <span class="va">`-`</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,
             bounds <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/furrr/man/future_map2.html">future_map2</a></span><span class="op">(</span><span class="va">thetas</span>, <span class="va">gammas</span>,
                                  <span class="op">~</span><span class="fu"><a href="../reference/get_bounds.html">get_bounds</a></span><span class="op">(</span>thetas <span class="op">=</span> <span class="va">.x</span>,
                                              gammas <span class="op">=</span> <span class="va">.y</span>,
                                              stop <span class="op">=</span> <span class="cn">FALSE</span>, 
                                              warning <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span>,
             violations <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/furrr/man/future_map.html">future_map_lgl</a></span><span class="op">(</span><span class="va">bounds</span>, <span class="st">"constraints_violated"</span><span class="op">)</span>,
             intervals <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/furrr/man/future_map.html">future_map</a></span><span class="op">(</span><span class="va">bounds</span>, <span class="st">"interval"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
      <span class="fu">unnest_wider</span><span class="op">(</span><span class="va">intervals</span><span class="op">)</span> <span class="op">%&gt;%</span> 
      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>width <span class="op">=</span> <span class="va">upper</span> <span class="op">-</span> <span class="va">lower</span><span class="op">)</span>
    
    <span class="va">bounds</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind.html">bind_rows</a></span><span class="op">(</span><span class="va">bounds</span>, <span class="va">bounds_extra</span><span class="op">)</span>
  <span class="op">}</span>
  
  <span class="fu">write_rds</span><span class="op">(</span><span class="va">bounds</span>, <span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/here/man/here.html">here</a></span><span class="op">(</span><span class="st">"vignettes_data/bivariate_bounds.Rds"</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span> <span class="kw">else</span> <span class="op">{</span>
  <span class="va">bounds</span> <span class="op">&lt;-</span> <span class="fu">read_rds</span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/here/man/here.html">here</a></span><span class="op">(</span><span class="st">"vignettes_data/bivariate_bounds.Rds"</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span></pre></div>
<p>The plot below shows the width plotted against the strength of <span class="math inline">\(Z\)</span> on both <span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span>. The black line has slope <span class="math inline">\(-2\)</span> and intercept <span class="math inline">\(2\)</span> – i.e. it represents the upper bound on the width derived under the two monotonicity assumptions.</p>
<div class="sourceCode" id="cb5"><pre class="downlit">
<span class="va">width_vs_strength</span> <span class="op">&lt;-</span> <span class="va">bounds</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span><span class="va">violations</span>, <span class="va">upper</span> <span class="op">&gt;</span> <span class="va">lower</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">strength_x</span>, y <span class="op">=</span> <span class="va">width</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
    <span class="fu">geom_point</span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span> <span class="op">+</span> 
    <span class="fu">geom_abline</span><span class="op">(</span>slope <span class="op">=</span> <span class="op">-</span><span class="fl">2</span>, intercept <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">lims</span><span class="op">(</span>
      y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">2</span><span class="op">)</span>
    <span class="op">)</span> <span class="op">+</span>
    <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Strength of IV"</span>,
         y <span class="op">=</span> <span class="st">"Width of bounds"</span><span class="op">)</span> <span class="op">+</span> 
    <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span>

<span class="va">width_vs_strength</span> <span class="op">+</span>
  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Width of Two-Sample Bounds as function of strength"</span><span class="op">)</span></pre></div>
<p><img src="bounds_from_bivariate_files/figure-html/unnamed-chunk-5-1.png" width="700"></p>
<div class="sourceCode" id="cb6"><pre class="downlit">
<span class="fu">ggsave</span><span class="op">(</span>plot <span class="op">=</span> <span class="va">width_vs_strength</span>,
       filename <span class="op">=</span> <span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/here/man/here.html">here</a></span><span class="op">(</span><span class="st">"figures"</span>, <span class="st">"bivariate_width_vs_strength.png"</span><span class="op">)</span>, 
       dpi <span class="op">=</span> <span class="fl">300</span>, width <span class="op">=</span> <span class="fl">4</span>, height <span class="op">=</span> <span class="fl">2.86</span><span class="op">)</span></pre></div>
<p>Here are all the bounds:</p>
<div class="sourceCode" id="cb7"><pre class="downlit">
<span class="va">all_bounds_plot</span> <span class="op">&lt;-</span> <span class="va">bounds</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span><span class="va">violations</span>, <span class="va">upper</span> <span class="op">&gt;</span> <span class="va">lower</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">contains</a></span><span class="op">(</span><span class="st">"strength"</span><span class="op">)</span>, <span class="va">upper</span>, <span class="va">lower</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="op">(</span><span class="va">upper</span> <span class="op">+</span> <span class="va">lower</span><span class="op">)</span><span class="op">/</span><span class="fl">2</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>id <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/ranking.html">row_number</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">id</span>, y <span class="op">=</span> <span class="op">(</span><span class="va">upper</span> <span class="op">+</span> <span class="va">lower</span><span class="op">)</span><span class="op">/</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
    <span class="fu">geom_errorbar</span><span class="op">(</span>
      <span class="fu">aes</span><span class="op">(</span>ymin <span class="op">=</span> <span class="va">lower</span>, ymax <span class="op">=</span> <span class="va">upper</span><span class="op">)</span>,
      width <span class="op">=</span> <span class="fl">0.001</span>, alpha <span class="op">=</span> <span class="fl">0.05</span>
    <span class="op">)</span> <span class="op">+</span> 
    <span class="fu">geom_line</span><span class="op">(</span>
      <span class="fu">aes</span><span class="op">(</span>color <span class="op">=</span> <span class="st">"Center of bounds"</span><span class="op">)</span>,
      alpha <span class="op">=</span> <span class="fl">0.75</span>
    <span class="op">)</span><span class="op">+</span> 
    <span class="fu">labs</span><span class="op">(</span>
      y <span class="op">=</span> <span class="st">"ATE"</span>,
      x <span class="op">=</span> <span class="st">"Simulation run"</span>,
      color <span class="op">=</span> <span class="st">""</span>
    <span class="op">)</span> <span class="op">+</span>
    <span class="fu">guides</span><span class="op">(</span>
      color <span class="op">=</span> <span class="fu">guide_legend</span><span class="op">(</span>label.position <span class="op">=</span> <span class="st">"top"</span><span class="op">)</span>
    <span class="op">)</span> <span class="op">+</span>
    <span class="fu">scale_color_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">theme</span><span class="op">(</span>
      panel.grid.major.x <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,
      panel.grid.minor.x <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,
      legend.position <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span>,
      legend.justification <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span>,
      legend.background <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,
      legend.key <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>
    <span class="op">)</span>

<span class="va">all_bounds_plot</span> <span class="op">+</span>
  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Bounds from ≈10,000 randomly generated distributions"</span>,
       caption <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"Note:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">bounds</span><span class="op">$</span><span class="va">upper</span> <span class="op">&lt;=</span> <span class="va">bounds</span><span class="op">$</span><span class="va">lower</span><span class="op">)</span>, <span class="st">"of the"</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">bounds</span><span class="op">)</span>, <span class="st">"simulated distributions resulted in upper limits smaller than the lower limits. These have been removed."</span><span class="op">)</span><span class="op">)</span></pre></div>
<p><img src="bounds_from_bivariate_files/figure-html/unnamed-chunk-6-1.png" width="700"></p>
<div class="sourceCode" id="cb8"><pre class="downlit">
<span class="fu">ggsave</span><span class="op">(</span>plot <span class="op">=</span> <span class="va">all_bounds_plot</span>,
       filename <span class="op">=</span> <span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/here/man/here.html">here</a></span><span class="op">(</span><span class="st">"figures"</span>, <span class="st">"all_bivariate_bounds.png"</span><span class="op">)</span>,
       dpi <span class="op">=</span> <span class="fl">300</span>, width <span class="op">=</span> <span class="fl">4</span>, height <span class="op">=</span> <span class="fl">2.86</span><span class="op">)</span></pre></div>
<p>Many of these randomly generated distributions result in rather wide bounds, as can be seen from the table below.</p>
<div class="sourceCode" id="cb9"><pre class="downlit">
<span class="va">proportion_of_widths_greater_than</span> <span class="op">&lt;-</span> <span class="va">bounds</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">width</span> <span class="op">&gt;=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span>Strength <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cut.html">cut</a></span><span class="op">(</span><span class="va">strength_x</span>, breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.05</span>, <span class="fl">0.1</span>, <span class="fl">0.25</span>, <span class="fl">0.5</span>, <span class="fl">1</span><span class="op">)</span>, 
                          include.lowest <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span><span class="op">(</span>
    w <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0.75</span>, <span class="fl">0.5</span><span class="op">)</span>,
    prop <span class="op">=</span> <span class="fu">map_dbl</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0.75</span>, <span class="fl">0.5</span><span class="op">)</span>, <span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">width</span> <span class="op">&gt;</span> <span class="va">.x</span><span class="op">)</span><span class="op">)</span>
  <span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>w <span class="op">=</span> <span class="fu">glue</span><span class="fu">::</span><span class="fu"><a href="https://glue.tidyverse.org/reference/glue.html">glue</a></span><span class="op">(</span><span class="st">"w = {w}"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">pivot_wider</span><span class="op">(</span>names_from <span class="op">=</span> <span class="va">w</span>, values_from <span class="op">=</span> <span class="va">prop</span><span class="op">)</span></pre></div>
<pre><code>## `summarise()` has grouped output by 'Strength'. You can override using the `.groups` argument.</code></pre>
<div class="sourceCode" id="cb11"><pre class="downlit">
<span class="fu">pander</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/pander/man/pander.html">pander</a></span><span class="op">(</span><span class="va">proportion_of_widths_greater_than</span><span class="op">)</span></pre></div>
<table class="table">
<colgroup>
<col width="18%">
<col width="12%">
<col width="15%">
<col width="15%">
</colgroup>
<thead><tr class="header">
<th align="center">Strength</th>
<th align="center">w = 1</th>
<th align="center">w = 0.75</th>
<th align="center">w = 0.5</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">[0,0.05]</td>
<td align="center">0.4699</td>
<td align="center">0.7831</td>
<td align="center">0.8916</td>
</tr>
<tr class="even">
<td align="center">(0.05,0.1]</td>
<td align="center">0.4641</td>
<td align="center">0.7238</td>
<td align="center">0.895</td>
</tr>
<tr class="odd">
<td align="center">(0.1,0.25]</td>
<td align="center">0.3262</td>
<td align="center">0.7045</td>
<td align="center">0.9233</td>
</tr>
<tr class="even">
<td align="center">(0.25,0.5]</td>
<td align="center">0.1361</td>
<td align="center">0.4974</td>
<td align="center">0.8384</td>
</tr>
<tr class="odd">
<td align="center">(0.5,1]</td>
<td align="center">0</td>
<td align="center">0.07557</td>
<td align="center">0.3797</td>
</tr>
</tbody>
</table>
<p>We save a few summaries for the manuscript.</p>
<div class="sourceCode" id="cb12"><pre class="downlit">
<span class="va">bounds</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span><span class="op">(</span>
    n <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span>,
    good <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">upper</span> <span class="op">&gt;=</span> <span class="va">lower</span><span class="op">)</span>,
    bad <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">upper</span> <span class="op">&lt;</span> <span class="va">lower</span><span class="op">)</span>
  <span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">write_csv</span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/here/man/here.html">here</a></span><span class="op">(</span><span class="st">"tables/upper_less_than_lower.csv"</span><span class="op">)</span><span class="op">)</span>

<span class="fu">write_csv</span><span class="op">(</span><span class="va">proportion_of_widths_greater_than</span>,
          file <span class="op">=</span> <span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/here/man/here.html">here</a></span><span class="op">(</span><span class="st">"tables"</span>, <span class="st">"proportion_of_biv_widths_greater_than.csv"</span><span class="op">)</span><span class="op">)</span></pre></div>
</div>
<div id="relate-to-real-world-data" class="section level2">
<h2 class="hasAnchor">
<a href="#relate-to-real-world-data" class="anchor"></a>Relate to real world data</h2>
<p>We reproduce the plot of the width vs. strength, but include bounds from three real world examples. The first chunk below essentially summarizes the process laid out in <code><a href="../articles/example_analysis.html">vignette("example_analysis")</a></code> and wraps it in a simple function.</p>
<div class="sourceCode" id="cb13"><pre class="downlit">
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">TwoSampleMR</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://magrittr.tidyverse.org">magrittr</a></span><span class="op">)</span>

<span class="va">find_intercept</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">beta1</span>, <span class="va">p_outcome</span>, <span class="va">pz</span>, <span class="va">interval</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">5</span>, <span class="fl">5</span><span class="op">)</span>, <span class="va">zs</span> <span class="op">=</span> <span class="fl">0</span><span class="op">:</span><span class="fl">2</span><span class="op">)</span><span class="op">{</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/uniroot.html">uniroot</a></span><span class="op">(</span>f <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">beta0</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="op">(</span><span class="fl">1</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="op">-</span><span class="va">beta0</span><span class="op">-</span><span class="va">beta1</span><span class="op">*</span><span class="va">zs</span><span class="op">)</span><span class="op">)</span><span class="op">^</span><span class="op">(</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span> <span class="op">*</span> <span class="va">pz</span><span class="op">)</span> <span class="op">-</span> <span class="va">p_outcome</span>,
          interval <span class="op">=</span> <span class="va">interval</span><span class="op">)</span>
<span class="op">}</span>

<span class="va">ao</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/TwoSampleMR/man/available_outcomes.html">available_outcomes</a></span><span class="op">(</span><span class="op">)</span>

<span class="va">real_bounds</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">exposure_id</span>, <span class="va">outcome_id</span>, <span class="va">ao</span> <span class="op">=</span> <span class="fu">TwoSampleMR</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/TwoSampleMR/man/available_outcomes.html">available_outcomes</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
  
  <span class="va">exposure_experiment</span> <span class="op">&lt;-</span> <span class="va">ao</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">id</span> <span class="op">==</span> <span class="va">exposure_id</span><span class="op">)</span>
  <span class="va">exposure_instruments</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/TwoSampleMR/man/extract_instruments.html">extract_instruments</a></span><span class="op">(</span>outcomes <span class="op">=</span> <span class="va">exposure_experiment</span><span class="op">$</span><span class="va">id</span><span class="op">)</span>
  
  <span class="va">outcome_experiment</span> <span class="op">&lt;-</span> <span class="va">ao</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">id</span> <span class="op">==</span> <span class="va">outcome_id</span><span class="op">)</span>
  <span class="va">outcome_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/TwoSampleMR/man/extract_outcome_data.html">extract_outcome_data</a></span><span class="op">(</span>snps <span class="op">=</span> <span class="va">exposure_instruments</span><span class="op">$</span><span class="va">SNP</span>, outcomes <span class="op">=</span> <span class="va">outcome_experiment</span><span class="op">$</span><span class="va">id</span><span class="op">)</span>
  
  <span class="va">harmonized_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/TwoSampleMR/man/harmonise_data.html">harmonise_data</a></span><span class="op">(</span><span class="va">exposure_instruments</span>, <span class="va">outcome_data</span><span class="op">)</span> <span class="co"># %&gt;% as_tibble()</span>
  
  <span class="va">pop_probs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span>regression <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"outcome"</span>, <span class="st">"exposure"</span><span class="op">)</span>,
                      p_outcome <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">outcome_experiment</span>  <span class="op">%$%</span> <span class="op">{</span> <span class="va">ncase</span> <span class="op">/</span> <span class="op">(</span><span class="va">ncase</span> <span class="op">+</span> <span class="va">ncontrol</span><span class="op">)</span> <span class="op">}</span>,
                                    <span class="va">exposure_experiment</span> <span class="op">%$%</span> <span class="op">{</span> <span class="va">ncase</span> <span class="op">/</span> <span class="op">(</span><span class="va">ncase</span> <span class="op">+</span> <span class="va">ncontrol</span><span class="op">)</span> <span class="op">}</span><span class="op">)</span><span class="op">)</span>
  
  <span class="va">prep_for_bounds</span> <span class="op">&lt;-</span> <span class="va">harmonized_data</span> <span class="op">%&gt;%</span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rowwise.html">rowwise</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>samplesize.exposure <span class="op">=</span> <span class="va">exposure_experiment</span><span class="op">$</span><span class="va">ncase</span> <span class="op">+</span> <span class="va">exposure_experiment</span><span class="op">$</span><span class="va">ncontrol</span>,
           samplesize.outcome <span class="op">=</span> <span class="va">outcome_experiment</span><span class="op">$</span><span class="va">ncase</span> <span class="op">+</span> <span class="va">outcome_experiment</span><span class="op">$</span><span class="va">ncontrol</span>,
           ave_eaf <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/weighted.mean.html">weighted.mean</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/c_across.html">c_across</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">eaf.exposure</span>, <span class="va">eaf.outcome</span><span class="op">)</span><span class="op">)</span>,
                                   w <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/c_across.html">c_across</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">samplesize.exposure</span>, <span class="va">samplesize.outcome</span><span class="op">)</span><span class="op">)</span>,
                                   na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">SNP</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">contains</a></span><span class="op">(</span><span class="st">"beta"</span><span class="op">)</span>, <span class="va">ave_eaf</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu">pivot_longer</span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">contains</a></span><span class="op">(</span><span class="st">"beta"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu">separate</span><span class="op">(</span><span class="va">name</span>, into <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"variable"</span>, <span class="st">"regression"</span><span class="op">)</span>, sep <span class="op">=</span> <span class="st">"\\."</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu">pivot_wider</span><span class="op">(</span>names_from <span class="op">=</span> <span class="va">variable</span>, values_from <span class="op">=</span> <span class="va">value</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>`P(Z = 2)` <span class="op">=</span> <span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">ave_eaf</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span>,
           `P(Z = 1)` <span class="op">=</span> <span class="fl">2</span><span class="op">*</span><span class="va">ave_eaf</span><span class="op">*</span><span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">ave_eaf</span><span class="op">)</span>,
           `P(Z = 0)` <span class="op">=</span> <span class="va">ave_eaf</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span>
  
  <span class="va">include_intercept</span> <span class="op">&lt;-</span> <span class="va">prep_for_bounds</span> <span class="op">%&gt;%</span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">pop_probs</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rowwise.html">rowwise</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>find_intercept <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="fu">find_intercept</span><span class="op">(</span>beta1 <span class="op">=</span> <span class="va">beta</span>,
                                                p_outcome <span class="op">=</span> <span class="va">p_outcome</span>,
                                                pz <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">`P(Z = 0)`</span>, <span class="va">`P(Z = 1)`</span>, <span class="va">`P(Z = 2)`</span><span class="op">)</span>,
                                                interval <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">10</span>, <span class="fl">10</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,
           beta0 <span class="op">=</span> <span class="va">find_intercept</span><span class="op">$</span><span class="va">root</span>,
           `thetas/gammas` <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="op">(</span><span class="fl">1</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="op">-</span><span class="va">beta0</span> <span class="op">-</span> <span class="fl">0</span><span class="op">:</span><span class="fl">2</span><span class="op">*</span><span class="va">beta</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
  
  <span class="va">bivariate_bounds</span> <span class="op">&lt;-</span> <span class="va">include_intercept</span> <span class="op">%&gt;%</span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">find_intercept</span>, <span class="op">-</span><span class="va">beta0</span>, <span class="op">-</span><span class="va">p_outcome</span>, <span class="op">-</span><span class="va">ave_eaf</span>, coefs <span class="op">=</span> <span class="va">beta</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>regression <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html">if_else</a></span><span class="op">(</span><span class="va">regression</span> <span class="op">==</span> <span class="st">"outcome"</span>, <span class="st">"gammas"</span>, <span class="st">"thetas"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
    <span class="fu">pivot_wider</span><span class="op">(</span>names_from <span class="op">=</span> <span class="va">regression</span>, values_from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">`thetas/gammas`</span>, <span class="va">coefs</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename_with</a></span><span class="op">(</span>.cols <span class="op">=</span> <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">starts_with</a></span><span class="op">(</span><span class="st">"thetas"</span><span class="op">)</span>, 
                <span class="op">~</span><span class="fu">str_remove_all</span><span class="op">(</span><span class="va">.x</span>, <span class="st">"thetas/gammas_"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rowwise.html">rowwise</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>bivariate_bounds <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="fu"><a href="../reference/get_bounds.html">get_bounds</a></span><span class="op">(</span>thetas <span class="op">=</span> <span class="va">thetas</span>, gammas <span class="op">=</span> <span class="va">gammas</span>,
                                              stop <span class="op">=</span> <span class="cn">FALSE</span>, warning <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span>,
           interval <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">bivariate_bounds</span><span class="op">$</span><span class="va">interval</span><span class="op">)</span>,
           constraints_violated <span class="op">=</span> <span class="va">bivariate_bounds</span><span class="op">$</span><span class="va">constraints_violated</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu">unnest_wider</span><span class="op">(</span><span class="va">interval</span><span class="op">)</span>
  
  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">bivariate_bounds</span><span class="op">)</span>
<span class="op">}</span></pre></div>
<p>We find bounds of the average treatment effect of high cholesterol on incidence of heart attack, smoking on incidence of lung cancer, and obesity on incidence of heart attack.</p>
<div class="sourceCode" id="cb14"><pre class="downlit">
<span class="va">real_data_biv_bounds</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span>exposure <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Cholesterol"</span>, <span class="st">"Smoking"</span>, <span class="st">"Obesity"</span><span class="op">)</span>, 
                               outcome <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Heart Attack"</span>, <span class="st">"Lung Cancer"</span>, <span class="st">"Heart Attack"</span><span class="op">)</span>,
                               exposure_id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"ukb-a-108"</span>, <span class="st">"ukb-d-20116_0"</span>, <span class="st">"ieu-a-90"</span><span class="op">)</span>,
                               outcome_id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"ukb-a-434"</span>, <span class="st">"ukb-d-40001_C349"</span>, <span class="st">"ukb-a-434"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rowwise.html">rowwise</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>source <span class="op">=</span> <span class="va">exposure</span>,
         bounds <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="fu">real_bounds</span><span class="op">(</span>exposure_id <span class="op">=</span> <span class="va">exposure_id</span>, outcome_id <span class="op">=</span> <span class="va">outcome_id</span>, ao <span class="op">=</span> <span class="va">ao</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">unnest</span><span class="op">(</span><span class="va">bounds</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>width <span class="op">=</span> <span class="va">upper</span> <span class="op">-</span> <span class="va">lower</span>,
         strength_x <span class="op">=</span> <span class="fu">map_dbl</span><span class="op">(</span><span class="va">thetas</span>, <span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/outer.html">outer</a></span><span class="op">(</span><span class="va">.x</span>, <span class="va">.x</span>, <span class="st">"-"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></pre></div>
<pre><code>## Extracting data for 54 SNP(s) from 1 GWAS(s)</code></pre>
<pre><code>## Harmonising Non-cancer illness code  self-reported: high cholesterol || id:ukb-a-108 (ukb-a-108) and Vascular/heart problems diagnosed by doctor: Heart attack || id:ukb-a-434 (ukb-a-434)</code></pre>
<pre><code>## Removing the following SNPs for being palindromic with intermediate allele frequencies:
## rs28601761, rs7213086</code></pre>
<pre><code>## Joining, by = "regression"</code></pre>
<pre><code>## Extracting data for 84 SNP(s) from 1 GWAS(s)</code></pre>
<pre><code>## Harmonising Smoking status: Never || id:ukb-d-20116_0 (ukb-d-20116_0) and Underlying (primary) cause of death: ICD10: C34.9 Bronchus or lung, unspecified || id:ukb-d-40001_C349 (ukb-d-40001_C349)</code></pre>
<pre><code>## Removing the following SNPs for being palindromic with intermediate allele frequencies:
## rs11693702, rs1492546, rs2240294, rs264974, rs568599</code></pre>
<pre><code>## Joining, by = "regression"</code></pre>
<pre><code>## Extracting data for 17 SNP(s) from 1 GWAS(s)</code></pre>
<pre><code>## Harmonising Obesity class 1 || id:ieu-a-90 (ieu-a-90) and Vascular/heart problems diagnosed by doctor: Heart attack || id:ukb-a-434 (ukb-a-434)</code></pre>
<pre><code>## Joining, by = "regression"</code></pre>
<p>With these in hand, we create a plot of the width of the bounds for all instruments against the strength of the instruments.</p>
<div class="sourceCode" id="cb26"><pre class="downlit">
<span class="va">customvermillion</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/rgb.html">rgb</a></span><span class="op">(</span><span class="fl">213</span><span class="op">/</span><span class="fl">255</span>,<span class="fl">94</span><span class="op">/</span><span class="fl">255</span>,<span class="fl">0</span><span class="op">/</span><span class="fl">255</span><span class="op">)</span>
<span class="va">custombluegreen</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/rgb.html">rgb</a></span><span class="op">(</span><span class="fl">0</span><span class="op">/</span><span class="fl">255</span>,<span class="fl">158</span><span class="op">/</span><span class="fl">255</span>,<span class="fl">115</span><span class="op">/</span><span class="fl">255</span><span class="op">)</span>
<span class="va">customreddishpurple</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/grDevices/rgb.html">rgb</a></span><span class="op">(</span><span class="fl">204</span><span class="op">/</span><span class="fl">255</span>,<span class="fl">121</span><span class="op">/</span><span class="fl">255</span>,<span class="fl">167</span><span class="op">/</span><span class="fl">255</span><span class="op">)</span> 
<span class="va">customblue</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/rgb.html">rgb</a></span><span class="op">(</span><span class="fl">0</span><span class="op">/</span><span class="fl">255</span>,<span class="fl">114</span><span class="op">/</span><span class="fl">255</span>,<span class="fl">178</span><span class="op">/</span><span class="fl">255</span><span class="op">)</span>

<span class="co">## Create plot-within-plot</span>
<span class="va">width_vs_strength2</span> <span class="op">&lt;-</span> <span class="va">bounds</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span><span class="va">violations</span>, <span class="va">upper</span> <span class="op">&gt;</span> <span class="va">lower</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>source <span class="op">=</span> <span class="st">"Simulated"</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind.html">bind_rows</a></span><span class="op">(</span><span class="va">real_data_biv_bounds</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">strength_x</span>, y <span class="op">=</span> <span class="va">width</span>, color <span class="op">=</span> <span class="va">source</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
    <span class="fu">geom_point</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>alpha <span class="op">=</span> <span class="va">source</span> <span class="op">==</span> <span class="st">"Simulated"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
    <span class="fu">geom_abline</span><span class="op">(</span>slope <span class="op">=</span> <span class="op">-</span><span class="fl">2</span>, intercept <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Strength of IV"</span>,
         y <span class="op">=</span> <span class="st">"Width of bounds"</span>,
         color <span class="op">=</span> <span class="st">""</span><span class="op">)</span> <span class="op">+</span> 
    <span class="fu">scale_color_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Cholesterol"</span> <span class="op">=</span> <span class="va">customvermillion</span>, 
                                  <span class="st">"Smoking"</span> <span class="op">=</span> <span class="va">custombluegreen</span>,
                                  <span class="st">"Obesity"</span> <span class="op">=</span> <span class="va">customreddishpurple</span>,
                                  <span class="st">"Simulated"</span> <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">scale_alpha_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"TRUE"</span> <span class="op">=</span> <span class="fl">0.2</span>, <span class="st">"FALSE"</span> <span class="op">=</span> <span class="fl">0.75</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">guides</span><span class="op">(</span>color <span class="op">=</span> <span class="fu">guide_legend</span><span class="op">(</span>override.aes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>, nrow <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>,
           alpha <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">theme</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"top"</span><span class="op">)</span>


<span class="va">zoomed_in</span> <span class="op">&lt;-</span> <span class="va">width_vs_strength2</span> <span class="op">+</span>
  <span class="fu">coord_fixed</span><span class="op">(</span>ratio <span class="op">=</span> <span class="fl">0.25</span>,
              xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.1</span><span class="op">)</span>, 
              ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/range.html">range</a></span><span class="op">(</span><span class="va">real_data_biv_bounds</span><span class="op">$</span><span class="va">width</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">scale_x_continuous</span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.05</span>, <span class="fl">0.1</span><span class="op">)</span>,
                     expand <span class="op">=</span> <span class="fu">expansion</span><span class="op">(</span>mult <span class="op">=</span> <span class="fl">0</span>, add <span class="op">=</span> <span class="fl">0.001</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">""</span>, y <span class="op">=</span> <span class="st">""</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">guides</span><span class="op">(</span>color <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">theme</span><span class="op">(</span>plot.background <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,
        plot.margin <span class="op">=</span> <span class="fu">unit</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.5</span>,<span class="fl">0.5</span>, <span class="op">-</span><span class="fl">0.1</span>, <span class="op">-</span><span class="fl">0.1</span><span class="op">)</span>, <span class="st">"lines"</span><span class="op">)</span>,
        axis.text.x <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">45</span>, hjust <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span>


<span class="co">## </span>
<span class="va">box_x1</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="fl">0.01</span>
<span class="va">box_x2</span> <span class="op">&lt;-</span> <span class="fl">0.1</span>
<span class="va">box_y1</span> <span class="op">&lt;-</span> <span class="fl">0.94</span>
<span class="va">box_y2</span> <span class="op">&lt;-</span> <span class="fl">1.275</span>

<span class="va">zoomed_in_x1</span> <span class="op">&lt;-</span> <span class="fl">0.455</span>
<span class="va">zoomed_in_x2</span> <span class="op">&lt;-</span> <span class="fl">1.0375</span>
<span class="va">zoomed_in_y1</span> <span class="op">&lt;-</span> <span class="fl">1.11</span>
<span class="va">zoomed_in_y2</span> <span class="op">&lt;-</span> <span class="fl">2.075</span>

<span class="op">(</span><span class="va">pip_figure</span> <span class="op">&lt;-</span> <span class="va">width_vs_strength2</span> <span class="op">+</span> 
  <span class="fu">coord_fixed</span><span class="op">(</span>ratio <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">scale_y_continuous</span><span class="op">(</span>limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">2.075</span><span class="op">)</span>,
                     expand <span class="op">=</span> <span class="fu">expansion</span><span class="op">(</span>mult <span class="op">=</span> <span class="fl">0</span>, add <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.05</span>, <span class="fl">0.01</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_rect</span><span class="op">(</span>inherit.aes <span class="op">=</span> <span class="cn">FALSE</span>,
            xmin <span class="op">=</span> <span class="va">zoomed_in_x1</span>, xmax <span class="op">=</span> <span class="va">zoomed_in_x2</span>,
            ymin <span class="op">=</span> <span class="va">zoomed_in_y1</span>, ymax <span class="op">=</span> <span class="va">zoomed_in_y2</span>,
            fill <span class="op">=</span> <span class="st">"white"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">annotation_custom</span><span class="op">(</span>grob <span class="op">=</span> <span class="fu">ggplotGrob</span><span class="op">(</span><span class="va">zoomed_in</span><span class="op">)</span>, 
                    xmin <span class="op">=</span> <span class="fl">0.43</span>, 
                    ymin <span class="op">=</span> <span class="fl">1.05</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_path</span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">box_x2</span>, <span class="va">box_x1</span>, <span class="va">box_x1</span>, <span class="va">box_x2</span>, <span class="va">box_x2</span>, <span class="va">zoomed_in_x1</span><span class="op">)</span>, 
                              y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">box_y1</span>, <span class="va">box_y1</span>, <span class="va">box_y2</span>, <span class="va">box_y2</span>, <span class="va">box_y1</span>, <span class="va">zoomed_in_y1</span><span class="op">)</span><span class="op">)</span>, 
              <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span><span class="op">)</span>,
              color <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">geom_path</span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">box_x2</span>, <span class="va">zoomed_in_x1</span><span class="op">)</span>,
                              y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">box_y2</span>, <span class="va">zoomed_in_y2</span><span class="op">)</span><span class="op">)</span>,
            <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span><span class="op">)</span>,
            color <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_rect</span><span class="op">(</span>inherit.aes <span class="op">=</span> <span class="cn">FALSE</span>,
            xmin <span class="op">=</span> <span class="va">zoomed_in_x1</span>, xmax <span class="op">=</span> <span class="va">zoomed_in_x2</span>, 
            ymin <span class="op">=</span> <span class="va">zoomed_in_y1</span>, ymax <span class="op">=</span> <span class="va">zoomed_in_y2</span>,
            fill <span class="op">=</span> <span class="cn">NA</span>, color <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span>
<span class="op">)</span></pre></div>
<p><img src="bounds_from_bivariate_files/figure-html/unnamed-chunk-11-1.png" width="700"></p>
<div class="sourceCode" id="cb27"><pre class="downlit">
<span class="fu">ggsave</span><span class="op">(</span>filename <span class="op">=</span> <span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/here/man/here.html">here</a></span><span class="op">(</span><span class="st">"figures/bivariate_width_vs_strength_pip.png"</span><span class="op">)</span>,
       plot <span class="op">=</span> <span class="va">pip_figure</span>, 
       dpi <span class="op">=</span> <span class="fl">300</span>, width <span class="op">=</span> <span class="fl">4</span>, height <span class="op">=</span> <span class="fl">4.7</span><span class="op">)</span></pre></div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Ralph Møller Trane.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
